"use strict";function e(e,t,i){this.latitude=0,this.longitude=0,this.altitude=0,this.setPosition=function(e,t,i){"number"==typeof e&&(this.latitude=e),"number"==typeof t&&(this.longitude=t),"number"==typeof i&&(this.altitude=i)},this.setPosition(e,t,i)}function t(){var e=0,t=0,i=0,n=0;this.setEastLimit=(t=>{"number"==typeof t&&t<=180&&t>=-180&&(e=t)}),this.setWestLimit=(e=>{"number"==typeof e&&e<=180&&e>=-180&&(t=e)}),this.setNorthLimit=(e=>{"number"==typeof e&&e<=90&&e>=-90&&(n=e)}),this.setSouthLimit=(e=>{"number"==typeof e&&e<=90&&e>=-90&&(i=e)}),this.getNorthLimit=(()=>n),this.getSouthLimit=(()=>i),this.getWestLimit=(()=>t),this.getEastLimit=(()=>e)}function i(e){this.c1Date=null,this.c2Date=null,this.midDate=null,this.c3Date=null,this.c4Date=null,e&&(this.c1Date=e.c1Date,this.c2Date=e.c2Date,this.midDate=e.midDate,this.c3Date=e.c3Date,this.c4Date=e.c4Date),this.setC1Date=function(e){this.c1Date=e},this.setC2Date=function(e){this.c2Date=e},this.setMidDate=function(e){this.midDate=e},this.setC3Date=function(e){this.c3Date=e},this.setC4Date=function(e){this.c4Date=e},this.getC1Date=function(){return this.c1Date},this.getC2Date=function(){return this.c2Date},this.getMidDate=function(){return this.midDate},this.getC3Date=function(){return this.c3Date},this.getC4Date=function(){return this.c4Date}}function n(e,t){var i=0,n=0,s=0,a=0,o=0,r=0;return this.setSpan=((e,t)=>(i=void 0===t&&void 0===e?0:"number"==typeof t&&"number"==typeof e?t-e:void 0===t&&"number"==typeof e?e:void 0===t.getTime&&"function"==typeof e.getTime?e.getTime():"function"==typeof t.getTime&&"function"==typeof e.getTime?t.getTime()-e.getTime():0,r=Math.abs(i/864e5),o=r>=1?24*(r-Math.floor(r)):24*r,a=o>=1?60*(o-Math.floor(o)):60*o,s=a>=1?60*(a-Math.floor(a)):60*a,n=s>=1?Math.round(1e3*(s-Math.floor(s))):Math.round(1e3*s),i)),this.getRawMilliSeconds=(()=>i),this.checkNegative=(()=>i<0),this.getDays=(()=>Math.floor(r)),this.getHours=(()=>Math.floor(o)),this.getMinutes=(()=>Math.floor(a)),this.getSeconds=(()=>Math.floor(s)),this.getMilliseconds=(()=>n),this.toTimeString=function(){var e="",t=Math.floor(this.getDays()),i=Math.floor(this.getHours()),n=Math.floor(this.getMinutes()),s=Math.floor(this.getSeconds());return this.checkNegative()&&(e+="-"),t>0&&(e+=t+":"),i>=10&&(e+=i+":"),i>0&&i<10&&(e+="0"+i+":"),0===i&&t>0&&(e+="00:"),n>=10&&(e+=n+":"),n<10&&n>0&&(e+="0"+n+":"),0===n&&(e+="00:"),s>=10&&(e+=""+s),s>0&&s<10&&(e+="0"+s),0===s&&(e+="00"),e},this.setSpan(e,t)}function s(e){var t=864e5*e,i=new Date(Date.UTC(-4713,0,1,12,0,0,0)),n=i.getTime();return i.setTime(n+t+282528e5),i}function a(e,t,i){this.latRadians=e*Math.PI/180,this.longRadians=-1*t*Math.PI/180,this.altitude=i,this.timeZone=0,this.getAltitude=function(){return this.altitude},this.getLatRadians=function(){return this.latRadians},this.getLongRadians=function(){return this.longRadians},this.getTimeZone=function(){return this.timeZone};var n=Math.atan(.99664719*Math.tan(this.getLatRadians()));this.rhoSinO=.99664719*Math.sin(n)+this.getAltitude()/6378140*Math.sin(this.getLatRadians()),this.rhoCosO=Math.cos(n)+this.getAltitude()/6378140*Math.cos(this.getLatRadians()),this.getRhoSinO=function(){return this.rhoSinO},this.getRhoCosO=function(){return this.rhoCosO}}function o(){this.eventType=new Number,this.t=new Number,this.x=new Number,this.y=new Number,this.d=new Number,this.sinDelta=new Number,this.cosDelta=new Number,this.mu=new Number,this.l1=new Number,this.l2=new Number,this.dx=new Number,this.dy=new Number,this.dd=new Number,this.dmu=new Number,this.dl1=new Number,this.dl2=new Number,this.h=new Number,this.sinH=new Number,this.cosH=new Number,this.xi=new Number,this.eta=new Number,this.zeta=new Number,this.dxi=new Number,this.deta=new Number,this.u=new Number,this.vLoc=new Number,this.a=new Number,this.b=new Number,this.l1prime=new Number,this.l2prime=new Number,this.nSquared=new Number,this.p=new Number,this.alt=new Number,this.q=new Number,this.vObs=new Number,this.azi=new Number,this.mid=new Number,this.magnitude=new Number,this.moonSun=new Number,this.localType=new Number}function r(e){this.isVisible=!1,this.eclipseType="None",this.magnitude=0,this.coverage=0,this.depth=0,this.pAngle=0,this.northOfCenter=!0,this.midAltitude=0,this.c1Altitude=0,this.c4Altitude=0,this.circDates=new i,this.firstContactBelowHorizon=!1,this.secondContactBelowHorizon=!1,this.midEclipseBelowHorizon=!1,this.thirdContactBelowHorizon=!1,this.fourthContactBelowHorizon=!1,this.c1c4TimeSpan=new n,this.c2c3TimeSpan=new n,this.set=function(e){"object"==typeof e&&null!==e&&(this.isVisible=e.isVisible,this.eclipseType=e.eclipseType,this.magnitude=e.magnitude,this.coverage=e.coverage,this.depth=e.depth,this.pAngle=e.pAngle,this.northOfCenter=e.northOfCenter,this.midAltitude=e.midAltitude,this.c1Altitude=e.c1Altitude,this.c4Altitude=e.c4Altitude,this.circDates=new i(e.circDates),this.firstContactBelowHorizon=e.firstContactBelowHorizon,this.secondContactBelowHorizon=e.secondContactBelowHorizon,this.midEclipseBelowHorizon=e.midEclipseBelowHorizon,this.thirdContactBelowHorizon=e.thirdContactBelowHorizon,this.fourthContactBelowHorizon=e.fourthContactBelowHorizon,this.c1c4TimeSpan=new n(e.c1c4TimeSpan),this.c2c3TimeSpan=new n(e.c2c3TimeSpan))},this.set(e)}function l(){this.julianDayMax=new Number,this.t0=new Number,this.tMin=new Number,this.tMax=new Number,this.dUTC=new Number,this.dT=new Number,this.x0=new Number,this.x1=new Number,this.x2=new Number,this.x3=new Number,this.y0=new Number,this.y1=new Number,this.y2=new Number,this.y3=new Number,this.d0=new Number,this.d1=new Number,this.d2=new Number,this.m0=new Number,this.m1=new Number,this.m2=new Number,this.l10=new Number,this.l11=new Number,this.l12=new Number,this.l20=new Number,this.l21=new Number,this.l22=new Number,this.tanF1=new Number,this.tanF2=new Number}function c(n){function c(e){return e>360||e<0?e-360*Math.floor(e/360):e}function u(e,t){var i=c(m(e)-t[0]);if((i/=t[1])>=t[2]-1)return 999;var n=Math.floor(i);return(t[n+4]-t[n+3])*(i-n)+t[n+3]}function h(e){var t=Math.abs(e);return t<90?T*Math.cos(d(t)):1e-8*T}function m(e){return 180*e/Math.PI}function d(e){return Math.PI*e/180}function p(e,t){var i=0;return e>0&&t>0||e<0&&t<0?((i=e-t)<0&&(i+=360),i):e>0?e+Math.abs(t):180-Math.abs(e)+180-Math.abs(t)}function g(e,t){var i=e+t;return i>180&&(i-=360),i<-180&&(i+=360),i}function f(e,t){var i=e+t;return i>90&&(i=90),i<-90&&(i=-90),i}function w(e,t){return!b(e,t)}function b(e,t){var i=p(e,t);return i<180&&i>0}function C(e,t){return e.longitude===t.longitude?0:b(e.longitude,t.longitude)?1:-1}function v(e,t){return e.longitude===t.longitude?0:w(e.longitude,t.longitude)?1:-1}function L(t,i){if(t.length>1&&i.length>1){var n=t[t.length-1].longitude,s=t[t.length-1].latitude,a=i[i.length-1].longitude,o=i[i.length-1].latitude;if((Math.abs(s)>75||Math.abs(o)>75)&&p(n,a)>120){var r=p(n,a)/5,l=g(n,-1*r);t.push(new e(-89.99,l)),l=g(n,-2*r),t.push(new e(-89.99,l)),l=g(n,-3*r),t.push(new e(-89.99,l)),l=g(n,-4*r),t.push(new e(-89.99,l))}}}var T=.1,E=!1;this.type="",this.maxEclipseDate=new Date,this.midEclipsePoint=new e,this.besselianElements=new l,this.observerConstants=null,this.c1Circumstances=new o,this.c2Circumstances=new o,this.midCircumstances=new o,this.c3Circumstances=new o,this.c4Circumstances=new o,this.northPenumbraLine=null,this.southPenumbraLine=null,this.centralLine=null,this.southUmbraLine=null,this.northUmbraLine=null,this.westLimitLine=null,this.eastLimitLine=null,this.centralLineTimes=[],this.southUmbraLineTimes=[],this.northUmbraLineTimes=[],this.westPenumbraLineTimes=[],this.eastPenumbraLineTimes=[],this.toDate=(e=>{if(e){var t=Math.floor(e),i=24*(e-t),n=Math.floor((t-122.1)/365.25),s=Math.floor(365.25*n),a=Math.floor((t-s)/30.6001);s=t-s-Math.floor(30.6001*a),n-=(a-=a<13.5?1:13)>2.5?4716:4715,a--;var o=Math.floor(i),r=60*i-60*o,l=60*r-60*Math.floor(r),c=1e3*(l-Math.floor(l));return r=Math.floor(r),l=Math.floor(l),c=Math.floor(c),new Date(Date.UTC(n,a,s,o,r,l,c))}return null}),this.destroy=function(){this.observerConstants=null,this.c1Circumstances=new o,this.c2Circumstances=new o,this.midCircumstances=new o,this.c3Circumstances=new o,this.c4Circumstances=new o,this.northPenumbraLine=null,this.southPenumbraLine=null,this.centralLine=null,this.southUmbraLine=null,this.northUmbraLine=null,this.westLimitLine=null,this.eastLimitLine=null,this.centralLineTimes=[],this.southUmbraLineTimes=[],this.northUmbraLineTimes=[],this.westPenumbraLineTimes=[],this.eastPenumbraLineTimes=[]},this.deepCopyLineTimes=(e=>{var t=[];if("object"==typeof e&&null!==e)for(var n=0;n<e.length;n++)t.push(new i(e[n]));return t}),this.set=function(e){"object"==typeof e&&null!==e&&(this.type=e.type,this.maxEclipseDate=new Date(e.maxEclipseDate),this.midEclipsePoint=e.midEclipsePoint,this.besselianElements=e.besselianElements,this.observerConstants=e.observerConstants,this.c1Circumstances=e.c1Circumstances,this.c2Circumstances=e.c2Circumstances,this.midCircumstances=e.midCircumstances,this.c3Circumstances=e.c3Circumstances,this.c4Circumstances=e.c4Circumstances,this.northPenumbraLine=e.northPenumbraLine,this.southPenumbraLine=e.southPenumbraLine,this.centralLine=e.centralLine,this.southUmbraLine=e.southUmbraLine,this.northUmbraLine=e.northUmbraLine,this.westLimitLine=e.westLimitLine,this.eastLimitLine=e.eastLimitLine,this.centralLineTimes=this.deepCopyLineTimes(e.centralLineTimes),this.southUmbraLineTimes=this.deepCopyLineTimes(e.southUmbraLineTimes),this.northUmbraLineTimes=this.deepCopyLineTimes(e.northUmbraLineTimes),this.westPenumbraLineTimes=this.deepCopyLineTimes(e.westPenumbraLineTimes),this.eastPenumbraLineTimes=this.deepCopyLineTimes(e.eastPenumbraLineTimes))},this.calculateLocalCircumstances=function(e,t,i,n){if("number"!=typeof e||"number"!=typeof t)throw"Pleae input proper latitude and longitude to calclulate local cirucumstances.";var s=0,o=t,l=new r;if(i&&(isNaN(i)||(s=i)),E=!!n,this.observerConstants=new a(e,o,s),this.getAll(),l.magnitude=100*this.midCircumstances.magnitude,l.northOfCenter=this.midCircumstances.vLoc<0,l.midAltitude=this.getAlt(this.midCircumstances),l.c1Altitude=this.getAlt(this.c1Circumstances),l.c4Altitude=this.getAlt(this.c4Circumstances),l.circDates.setC1Date(this.getDate(this.c1Circumstances)),l.circDates.setMidDate(this.getDate(this.midCircumstances)),l.circDates.setC4Date(this.getDate(this.c4Circumstances)),l.circDates.setC2Date(this.getDate(this.c2Circumstances)),l.circDates.setC3Date(this.getDate(this.c3Circumstances)),l.coverage=this.getCoverage(),l.depth=this.getDepth(),l.pAngle=this.getP(this.midCircumstances),this.midCircumstances.localType>0&&this.checkHorizons(l))switch(l.isVisible=!0,null!==l.circDates.getC1Date()&&null!==l.circDates.getC4Date()&&l.c1c4TimeSpan.setSpan(this.toDate(l.circDates.getC1Date()),this.toDate(l.circDates.getC4Date())),this.midCircumstances.localType){case 1:l.eclipseType="Partial";break;case 2:l.eclipseType="Annular",null!==l.circDates.getC2Date()&&null!==l.circDates.getC3Date()&&l.c2c3TimeSpan.setSpan(this.toDate(l.circDates.getC2Date()),this.toDate(l.circDates.getC3Date()));break;case 3:l.eclipseType="Total",null!==l.circDates.getC2Date()&&null!==l.circDates.getC3Date()&&l.c2c3TimeSpan.setSpan(this.toDate(l.circDates.getC2Date()),this.toDate(l.circDates.getC3Date()));break;default:l.eclipseType="None"}return l},this.checkHorizons=function(e){if(this.getAlt(this.c1Circumstances)<0?e.firstContactBelowHorizon=!0:e.firstContactBelowHorizon=!1,this.getAlt(this.midCircumstances)<0?e.midEclipseBelowHorizon=!0:e.midEclipseBelowHorizon=!1,this.getAlt(this.c4Circumstances)<0?e.fourthContactBelowHorizon=!0:e.fourthContactBelowHorizon=!1,this.getAlt(this.c2Circumstances)<0?e.secondContactBelowHorizon=!0:e.secondContactBelowHorizon=!1,this.getAlt(this.c3Circumstances)<0?e.thirdContactBelowHorizon=!0:e.thirdContactBelowHorizon=!1,1===this.midCircumstances.localType){if(e.fourthContactBelowHorizon&&e.midEclipseBelowHorizon&&e.firstContactBelowHorizon)return this.midCircumstances.localType=0,!1}else{if(e.fourthContactBelowHorizon&&e.midEclipseBelowHorizon&&e.firstContactBelowHorizon&&e.secondContactBelowHorizon&&e.thirdContactBelowHorizon)return this.midCircumstances.localType=0,!1;e.secondContactBelowHorizon&&e.thirdContactBelowHorizon&&(this.midCircumstances.localType=1)}return!0},this.checkCentralHorizons=((e,t)=>!e.isVisible||!!e.midEclipseBelowHorizon),this.checkPartialHorizons=((e,t)=>!(!e.firstContactBelowHorizon||!t)||!(!e.fourthContactBelowHorizon||t)),this.getCentralLine=function(){return this.centralLine},this.setCentralLine=function(e){this.centralLine=e},this.setCentralLineTimes=function(e){this.centralLineTimes=this.deepCopyLineTimes(e)},this.getCentralLineTimes=function(){return this.centralLineTimes},this.drawCentralLine=function(){if(null!==this.centralLine)return this.centralLine;if("Annular"===this.type||"Total"===this.type||"Hybrid"===this.type){this.centralLine=[],this.centralLineTimes=[],this.centralLine.push(this.midEclipsePoint);var t=h(this.midEclipsePoint.latitude),i=.1,n=0,s=0,a=0,o=1,l=new r,c=!1;l=this.calculateLocalCircumstances(this.midEclipsePoint.latitude,this.midEclipsePoint.longitude,0),this.centralLineTimes.push(l.circDates);for(var u=1;u>-2;u-=2){c=!1;for(var m=t=h(s)*u;Math.abs(m)<=180&&(t=h(s)*u,n=g(this.midEclipsePoint.longitude,m),m===t&&(s=this.midEclipsePoint.latitude),l=this.calculateLocalCircumstances(s,n,0),a=l.depth,!this.checkCentralHorizons(l,1===u)&&!c);m+=t)if(l.depth<99.9)for(o=l.northOfCenter?-1:1,s+=i=Math.abs(i)*o;Math.abs(s)<=90;s+=i){if(l=this.calculateLocalCircumstances(s,n,0),this.checkCentralHorizons(l,1===u)&&(c=!0),!(l.depth<99.9)){l=this.calculateLocalCircumstances(s,n,0),1===u?(this.centralLine.push(new e(s,n)),this.centralLineTimes.unshift(l.circDates)):(this.centralLine.unshift(new e(s,n)),this.centralLineTimes.unshift(l.circDates));break}if(l.northOfCenter&&1===o||!l.northOfCenter&&-1===o){s-=i*((100-l.depth)/(100-a+(100-l.depth))),l=this.calculateLocalCircumstances(s,n,0),1===u?(this.centralLine.push(new e(s,n)),this.centralLineTimes.push(l.circDates)):(this.centralLine.unshift(new e(s,n)),this.centralLineTimes.unshift(l.circDates));break}a=l.depth}else l=this.calculateLocalCircumstances(s,n,0),1===u?(this.centralLine.push(new e(s,n)),this.centralLineTimes.push(l.circDates)):(this.centralLine.unshift(new e(s,n)),this.centralLineTimes.unshift(l.circDates))}}return this.centralLine},this.getPenumbraStartTimeJD=function(){var e=null;if(this.westPenumbraLineTimes){var t=[];e=(t=(t=t.concat(this.westPenumbraLineTimes)).sort((e,t)=>null!==e.getMidDate()&&null!==t.getMidDate()?e.getMidDate()-t.getMidDate():0))[0].getMidDate(),e-=.03}return e},this.getPenumbraStartTime=function(){return this.toDate(this.getPenumbraStartTimeJD())},this.getPenumbraEndTimeJD=function(){var e=null;if(this.eastPenumbraLineTimes){var t=[];e=(t=(t=t.concat(this.eastPenumbraLineTimes)).sort((e,t)=>null!==t.getMidDate()&&null!==e.getMidDate()?t.getMidDate()-e.getMidDate():0))[0].getMidDate(),e+=.03}return e},this.getPenumbraEndTime=function(){return this.toDate(this.getPenumbraEndTimeJD())},this.getUmbraStartTimeJD=function(){var e=null;return this.centralLineTimes?e=this.centralLineTimes[0].getC2Date():(this.northUmbraLineTimes&&(e=this.northUmbraLineTimes[0].getMidDate()),this.southUmbraLineTimes&&(e=this.southUmbraLineTimes[0].getMidDate())),e&&(e-=.001),e},this.getUmbraStartTime=function(){return this.toDate(this.getUmbraStartTimeJD())},this.getUmbraEndTimeJD=function(){var e=null;return this.centralLineTimes?e=this.centralLineTimes[this.centralLineTimes.length-1].getC3Date():(this.northUmbraLineTimes&&(e=this.northUmbraLineTimes[this.northUmbraLineTimes.length-1].getMidDate()),this.southUmbraLineTimes&&(e=this.southUmbraLineTimes[this.northUmbraLineTimes.length-1].getMidDate())),e&&(e+=.001),e},this.getUmbraEndTime=function(){return this.toDate(this.getUmbraEndTimeJD())},this.setSouthUmbraLine=function(e){this.southUmbraLine=e},this.getSouthUmbraLine=function(){return this.southUmbraLine},this.setNorthUmbraLine=function(e){this.northUmbraLine=e},this.getNorthUmbraLine=function(){return this.northUmbraLine},this.getNorthUmbraTimes=function(){return this.northUmbraLineTimes},this.setNorthUmbraTimes=function(e){this.northUmbraLineTimes=this.deepCopyLineTimes(e)},this.getSouthUmbraTimes=function(){return this.southUmbraLineTimes},this.setSouthUmbraTimes=function(e){this.southUmbraLineTimes=this.deepCopyLineTimes(e)},this.drawUmbraLimit=function(t){if(!t&&this.southUmbraLine)return this.southUmbraLine;if(t&&this.northUmbraLine)return this.northUmbraLine;var i=null,n=null;if("Annular"===this.type||"Total"===this.type||"Hybrid"===this.type){i=[],n=[];var s=h(this.midEclipsePoint.latitude),a=.1,o=this.midEclipsePoint.longitude,l=this.midEclipsePoint.latitude,c=100,u=1,m=new r,d=!1;t||(u=-1);for(var p=1;p>=-1;p-=2){m=new r,c=100,s=h(l)*p,o=this.midEclipsePoint.longitude,l=this.midEclipsePoint.latitude,d=!1;for(var f=0;Math.abs(f)<=180;f+=s){if(s=h(l)*p,-1===p&&(f+=s,l=i[0].latitude),o=g(this.midEclipsePoint.longitude,f),f>0||-1===p){if(m=this.calculateLocalCircumstances(l,o,0),c=m.depth,this.checkCentralHorizons(m,1===p)||d)break;c<=0&&m.northOfCenter?u=-1:c>0&&m.northOfCenter?u=1:c>0&&!m.northOfCenter?u=-1:c<=0&&!m.northOfCenter&&(u=1)}for(l+=a=Math.abs(a)*u;Math.abs(l)<=90;l+=a){if(m=this.calculateLocalCircumstances(l,o,0),this.checkCentralHorizons(m,1===p)&&(d=!0),!(m.depth>.1||m.depth<-.1)){m=this.calculateLocalCircumstances(l,o,0),1===p?(i.push(new e(l,o)),n.push(m.circDates)):(i.unshift(new e(l,o)),n.unshift(m.circDates));break}if(m.depth<0&&c>0||m.depth>0&&c<0){l-=a*(Math.abs(m.depth)/(Math.abs(c)+Math.abs(m.depth))),m=this.calculateLocalCircumstances(l,o,0),1===p?(i.push(new e(l,o)),n.push(m.circDates)):(i.unshift(new e(l,o)),n.unshift(m.circDates));break}c=m.depth}}}}return n&&n.length>0&&(t?(this.northUmbraLineTimes=[],this.northUmbraLineTimes=this.northUmbraLineTimes.concat(n)):(this.southUmbraLineTimes=[],this.southUmbraLineTimes=this.southUmbraLineTimes.concat(n))),i&&i.length>0?t?(this.northUmbraLine=[],this.northUmbraLine=this.northUmbraLine.concat(i),this.northUmbraLine):(this.southUmbraLine=[],this.southUmbraLine=this.southUmbraLine.concat(i),this.southUmbraLine):this.northUmbraLine},this.getNorthPenumbraLine=function(){return this.northPenumbraLine},this.getSouthPenumbraLine=function(){return this.southPenumbraLine},this.setNorthPenumbraLine=function(e){this.northPenumbraLine=e},this.setSouthPenumbraLine=function(e){this.southPenumbraLine=e},this.drawPenumbralLimit=function(t){if(t&&this.northPenumbralLine)return this.northPenumbraLine;if(!t&&this.southPenumbraLine)return this.southPenumbraLine;for(var i=[],n=h(this.midEclipsePoint.latitude),s=.1,a=this.midEclipsePoint.longitude,o=this.midEclipsePoint.latitude,l=100,c=1,u=new r,m=!1,d=!0,p=1;p>-2;p-=2){if(m=!1,n=h(o)*p,t||(c=-1),s=Math.abs(s)*c,1===p){for(o+=s=.2*c;Math.abs(o)<=90;o+=s){if(!((u=this.calculateLocalCircumstances(o,a,0)).magnitude>0)){o-=s*Math.abs(u.magnitude)/(Math.abs(l)+Math.abs(u.magnitude)),i.push(new e(o,a)),d=!1;break}l=u.magnitude}if(d)break}else o=i[0].latitude,a=i[0].longitude;s=.1*c;for(var f=n;Math.abs(f)<=180&&(a=g(i[0].longitude,f),u=this.calculateLocalCircumstances(o,a,0),l=u.magnitude,!this.checkPartialHorizons(u,1===p)&&!m);f+=n){for(u.northOfCenter&&l<0?c=-1:!u.northOfCenter&&l<0?c=1:!u.northOfCenter&&l>0?c=-1:u.northOfCenter&&l>0&&(c=1),d=!0,o+=s=Math.abs(s)*c;Math.abs(o)<=90;o+=s){if(u=this.calculateLocalCircumstances(o,a,0),this.checkPartialHorizons(u,1===p)&&(m=!0),l>0&&u.magnitude<0||l<0&&u.magnitude>0){o-=s*Math.abs(u.magnitude)/(Math.abs(l)+Math.abs(u.magnitude)),d=!1,1===p?i.push(new e(o,a)):i.unshift(new e(o,a));break}l=u.magnitude}n=h(o)*p}}return i.length<1&&(i=null),t?(i&&(this.northPenumbraLine=i.slice(1,i.length-1)),this.northPenumbraLine):(i&&(this.southPenumbraLine=i.slice(1,i.length-1)),this.southPenumbraLine)},this.getWestLimitLine=function(){return this.westLimitLine},this.getEastLimitLine=function(){return this.eastLimitLine},this.setWestLimitLine=function(e){this.westLimitLine=e},this.setEastLimitLine=function(e){this.eastLimitLine=e},this.getWestLineTimes=function(){return this.westPenumbraLineTimes},this.getPointCount=function(){var e=0;return this.getWestLimitLine()&&(e+=this.getWestLimitLine().length),this.getEastLimitLine()&&(e+=this.getEastLimitLine().length),this.getNorthPenumbraLine()&&(e+=this.getNorthPenumbraLine().length),this.getSouthPenumbraLine()&&(e+=this.getSouthPenumbraLine().length),e},this.isEclipseOccurring=function(e){try{if(e&&this.getPenumbraEndTime()&&this.getPenumbraStartTime()&&e<=this.getPenumbraEndTime()&&e>=this.getPenumbraStartTime())return!0}catch(e){return!1}return!1},this.setWestLineTimes=function(e){this.westPenumbraLineTimes=this.deepCopyLineTimes(e)},this.getEastLineTimes=function(){return this.eastPenumbraLineTimes},this.setEastLineTimes=function(e){this.eastPenumbraLineTimes=this.deepCopyLineTimes(e)},this.drawEastWestLimit=function(t){if(t&&this.westLimitLine)return this.westLimitLine;if(!t&&this.eastLimitLine)return this.eastLimitLine;if(!this.southPenumbraLine&&!this.northPenumbraLine)throw"Can't draw east or west limit line without the north and south penumbral limits.";var i=.1,n=h(0),s=[],a=!0,o=90,l=0,c=0,u=0,m=0,d=0,p=0,f=0,w=0,b=0,C=0,v=0,L=new r,T=[];if(!this.southPenumbraLine&&this.northPenumbraLine)this.northPenumbraLine.length>0&&(a=!1,o=-89,t?(s.push(this.northPenumbraLine[0]),L=this.calculateLocalCircumstances(this.northPenumbraLine[0].latitude,this.northPenumbraLine[0].longitude,0),T.push(L.circDates)):(s.push(this.northPenumbraLine[this.northPenumbraLine.length-1]),L=this.calculateLocalCircumstances(this.northPenumbraLine[this.northPenumbraLine.length-1].latitude,this.northPenumbraLine[this.northPenumbraLine.length-1].longitude,0),T.push(L.circDates)));else if(this.southPenumbraLine.length>0)if(t)s.push(this.southPenumbraLine[0]),L=this.calculateLocalCircumstances(this.southPenumbraLine[0].latitude,this.southPenumbraLine[0].longitude,0),T.push(L.circDates);else{s.push(this.southPenumbraLine[this.southPenumbraLine.length-1]);try{L=this.calculateLocalCircumstances(this.southPenumbraLine[this.southPenumbraLine.length-1].latitude,this.southPenumbraLine[this.southPenumbraLine.length-1].longitude,0),T.push(L.circDates)}catch(e){throw"Ummmm no number here!"}}t?(c=this.midEclipsePoint.longitude,l=s.length>0?g(s[0].longitude,-90):g(this.midEclipsePoint.longitude,-90)):(l=this.midEclipsePoint.longitude,c=s.length>0?g(s[0].longitude,90):g(this.midEclipsePoint.longitude,90)),"Annular"!==this.type&&"Total"!==this.type&&"Hybrid"!==this.type||(o=a?this.northPenumbraLine?t?this.northPenumbraLine[0].latitude:this.northPenumbraLine[this.northPenumbraLine.length-1].latitude:90:this.southPenumbraLine?t?this.southPenumbraLine[0].latitude:this.southPenumbraLine[this.southPenumbraLine.length-1].latitude:-89),a||(i*=-1),s.length>0?(d=s[0].latitude,p=s[0].longitude):(d=0,p=t?g(this.midEclipsePoint.longitude,90):g(this.midEclipsePoint.longitude,-90)),b=Math.abs(o-d);var E=0;for(E=s.length>0?s[0].latitude:d,w+=i;Math.abs(w)<b;w+=i)for(n=h(d=E+w),L=this.calculateLocalCircumstances(d,p,0),t?(u=L.c4Altitude)>0?(n=-1*Math.abs(n),v=Math.abs(p-l)):(n=Math.abs(n),v=Math.abs(p-c)):(u=L.c1Altitude)<0?(n=-1*Math.abs(n),v=Math.abs(p-l)):(n=Math.abs(n),v=Math.abs(p-c)),v>180&&(v-=180),m=u,C=0,f=p,C+=n;Math.abs(C)<=Math.abs(v)&&(p=g(f,C),L=this.calculateLocalCircumstances(d,p,0),u=t?L.c4Altitude:L.c1Altitude,!isNaN(u));C+=n){if(u<0&&m>0||u>0&&m<0){p=g(p,n*Math.abs(u)/(Math.abs(u)+Math.abs(m))*-1),s.push(new e(d,p)),L=this.calculateLocalCircumstances(d,p,0),T.push(L.circDates);break}m=u}return a?!t&&this.northPenumbraLine?(s.push(this.northPenumbraLine[this.northPenumbraLine.length-1]),L=this.calculateLocalCircumstances(s[s.length-1].latitude,s[s.length-1].longitude,0),T.push(L.circDates)):this.northPenumbraLine?(s.push(this.northPenumbraLine[0]),L=this.calculateLocalCircumstances(s[s.length-1].latitude,s[s.length-1].longitude,0),T.push(L.circDates)):t&&this.eastLimitLine&&(s.push(this.eastLimitLine[this.eastLimitLine.length-1]),L=this.calculateLocalCircumstances(s[s.length-1].latitude,s[s.length-1].longitude,0),T.push(L.circDates)):!t&&this.southPenumbraLine?(s.push(this.southPenumbraLine[this.southPenumbraLine.length-1]),L=this.calculateLocalCircumstances(s[s.length-1].latitude,s[s.length-1].longitude,0),T.push(L.circDates)):this.southPenumbraLine?(s.push(this.southPenumbraLine[0]),L=this.calculateLocalCircumstances(s[s.length-1].latitude,s[s.length-1].longitude,0),T.push(L.circDates)):t&&this.eastLimitLine&&(s.push(this.eastLimitLine[this.eastLimitLine.length-1]),L=this.calculateLocalCircumstances(s[s.length-1].latitude,s[s.length-1].longitude,0),T.push(L.circDates)),s&&s.length>1&&s[0].latitude>s[s.length-1].latitude&&(s=s.reverse(),T=T.reverse()),t?(console.log("WEST COMPLETE"),this.westLimitLine=[],this.westLimitLine=this.westLimitLine.concat(s),this.westPenumbraLineTimes=[],this.westPenumbraLineTimes=this.westPenumbraLineTimes.concat(T),this.westLimitLine):(this.eastPenumbraLineTimes=[],this.eastPenumbraLineTimes=this.eastPenumbraLineTimes.concat(T),this.eastLimitLine=[],this.eastLimitLine=this.eastLimitLine.concat(s),this.eastLimitLine)},this.getPenumbraLimits=function(){var e=null;if(this.eastLimitLine&&this.westLimitLine&&(this.northPenumbraLine||this.southPenumbraLine)){var i=this.midEclipsePoint.latitude,n=this.midEclipsePoint.latitude,s=this.midEclipsePoint.longitude,a=this.midEclipsePoint.longitude,o=this.midEclipsePoint.longitude;if(e=new t,this.eastLimitLine[0].latitude>i&&(i=this.eastLimitLine[0].latitude),this.eastLimitLine[this.eastLimitLine.length-1].latitude>i&&(i=this.eastLimitLine[this.eastLimitLine.length-1].latitude),this.westLimitLine[0].latitude>i&&(i=this.westLimitLine[0].latitude),this.westLimitLine[this.westLimitLine.length-1].latitude>i&&(i=this.westLimitLine[this.westLimitLine.length-1].latitude),this.northPenumbraLine){for(r=0;r<this.northPenumbraLine.length;r++)this.northPenumbraLine[r].latitude>i&&(i=this.northPenumbraLine[r].latitude);b(s,this.northPenumbraLine[0].longitude)&&b(o,this.northPenumbraLine[0].longitude)&&(s=this.northPenumbraLine[0].longitude),b(s,this.northPenumbraLine[this.northPenumbraLine.length-1].longitude)&&b(o,this.northPenumbraLine[this.northPenumbraLine.length-1].longitude)&&(s=this.northPenumbraLine[this.northPenumbraLine.length-1].longitude),w(a,this.northPenumbraLine[0].longitude)&&w(o,this.northPenumbraLine[0].longitude)&&(a=this.northPenumbraLine[0].longitude),w(a,this.northPenumbraLine[this.northPenumbraLine.length-1].longitude)&&w(o,this.northPenumbraLine[this.northPenumbraLine.length-1].longitude)&&(a=this.northPenumbraLine[this.northPenumbraLine.length-1].longitude)}if((i+=1)>90&&(i=89),e.setNorthLimit(i),this.eastLimitLine[0].latitude<n&&(n=this.eastLimitLine[0].latitude),this.eastLimitLine[this.eastLimitLine.length-1].latitude<n&&(n=this.eastLimitLine[this.eastLimitLine.length-1].latitude),this.westLimitLine[0].latitude<n&&(n=this.westLimitLine[0].latitude),this.westLimitLine[this.westLimitLine.length-1].latitude<n&&(n=this.westLimitLine[this.westLimitLine.length-1].latitude),this.southPenumbraLine){for(r=0;r<this.southPenumbraLine.length;r++)this.southPenumbraLine[r].latitude<n&&(n=this.southPenumbraLine[r].latitude);b(s,this.southPenumbraLine[0].longitude)&&b(o,this.southPenumbraLine[0].longitudev)&&(s=this.southPenumbraLine[0].longitude),b(s,this.southPenumbraLine[this.southPenumbraLine.length-1].longitude)&&b(o,this.southPenumbraLine[this.southPenumbraLine.length-1].longitude)&&(s=this.southPenumbraLine[this.southPenumbraLine.length-1].longitude),w(a,this.southPenumbraLine[0].longitude)&&w(o,this.southPenumbraLine[0].longitude)&&(a=this.southPenumbraLine[0].longitude),w(a,this.southPenumbraLine[this.southPenumbraLine.length-1].longitude)&&w(o,this.southPenumbraLine[this.southPenumbraLine.length-1].longitude)&&(a=this.southPenumbraLine[this.southPenumbraLine.length-1].longitude)}(n-=1)<-90&&(n=-89),e.setSouthLimit(n);for(r=0;r<this.westLimitLine.length-1;r++)b(s,this.westLimitLine[r].longitude)&&b(o,this.westLimitLine[r].longitude)&&(s=this.westLimitLine[r].longitude);s=g(s,-1),e.setWestLimit(s);for(var r=0;r<this.eastLimitLine.length-1;r++)w(a,this.eastLimitLine[r].longitude)&&w(o,this.eastLimitLine[r].longitude)&&(a=this.eastLimitLine[r].longitude);a=g(a,1),e.setEastLimit(a)}return e},this.getUmbraLimits=function(e){var i=null;if(this.northUmbraLineTimes||this.southUmbraLineTimes){i=new t;var n=null,s=null,a=null,o=!1,r=!1,l=0;if(this.centralLineTimes){for(m=0;m<this.centralLineTimes.length;m++)if((a=this.centralLineTimes[m].getMidDate())&&a>=e){l=this.calculateLocalCircumstances(this.centralLine[m].latitude,this.centralLine[m].longitude,0).c2c3TimeSpan.getRawMilliSeconds();break}0===l&&(l=this.calculateLocalCircumstances(this.midEclipsePoint.latitude,this.midEclipsePoint.longitude,0).c2c3TimeSpan.getRawMilliSeconds())}0===l&&(l=751e3);var c=e-l/2/864e5,u=e+l/2/864e5;if(this.northUmbraLineTimes){for(var h=-89,m=0;m<this.northUmbraLineTimes.length;m++)if(a=this.northUmbraLineTimes[m].getMidDate()){if(a>=c&&!o){o=!0,null===n?n=this.northUmbraLine[m].longitude:w(n,this.northUmbraLine[m].longitude)&&(n=this.northUmbraLine[m].longitude),h<this.northUmbraLine[m].latitude&&(h=this.northUmbraLine[m].latitude),m>0&&(null===s?s=this.northUmbraLine[m-1].longitude:b(s,this.northUmbraLine[m-1].longitude)&&(s=this.northUmbraLine[m-1].longitude),h<this.northUmbraLine[m-1].latitude&&(h=this.northUmbraLine[m-1].latitude));continue}if(a>=u){null===n?n=this.northUmbraLine[m].longitude:w(n,this.northUmbraLine[m].longitude)&&(n=this.northUmbraLine[m].longitude),h<this.northUmbraLine[m].latitude&&(h=this.northUmbraLine[m].latitude),m>0&&(null===s?s=this.northUmbraLine[m-1].longitude:b(s,this.northUmbraLine[m-1].longitude)&&(s=this.northUmbraLine[m-1].longitude),h<this.northUmbraLine[m-1].latitude&&(h=this.northUmbraLine[m-1].latitude)),r=!0;break}}if(o&&!r&&--m>0&&(null===n?n=this.northUmbraLine[m].longitude:w(n,this.northUmbraLine[m].longitude)&&(n=this.northUmbraLine[m].longitude),h<this.northUmbraLine[m].latitude&&(h=this.northUmbraLine[m].latitude),m>0&&(null===s?s=this.northUmbraLine[m-1].longitude:b(s,this.northUmbraLine[m-1].longitude)&&(s=this.northUmbraLine[m-1].longitude),h<this.northUmbraLine[m-1].latitude&&(h=this.northUmbraLine[m-1].latitude))),-89===h)return null;h=f(h,.05),i.setNorthLimit(h)}else i.setNorthLimit(89);if(this.southUmbraLineTimes){var d=89;o=!1,r=!1;for(m=0;m<this.southUmbraLineTimes.length;m++)if(a=this.southUmbraLineTimes[m].getMidDate()){if(a>=c&&!o){o=!0,null===n?n=this.southUmbraLine[m].longitude:w(n,this.southUmbraLine[m].longitude)&&(n=this.southUmbraLine[m].longitude),d>this.southUmbraLine[m].latitude&&(d=this.southUmbraLine[m].latitude),m>0&&(null===s?s=this.southUmbraLine[m-1].longitude:b(s,this.southUmbraLine[m-1].longitude)&&(s=this.southUmbraLine[m-1].longitude),d>this.southUmbraLine[m-1].latitude&&(d=this.southUmbraLine[m-1].latitude));continue}if(a>=u){r=!0,null===n?n=this.southUmbraLine[m].longitude:w(n,this.southUmbraLine[m].longitude)&&(n=this.southUmbraLine[m].longitude),d>this.southUmbraLine[m].latitude&&(d=this.southUmbraLine[m].latitude),m>0&&(null===s?s=this.southUmbraLine[m-1].longitude:b(s,this.southUmbraLine[m-1].longitude)&&(s=this.southUmbraLine[m-1].longitude),d>this.southUmbraLine[m-1].latitude&&(d=this.southUmbraLine[m-1].latitude));break}}if(o&&!r&&--m>0&&(null===n?n=this.southUmbraLine[m].longitude:w(n,this.southUmbraLine[m].longitude)&&(n=this.southUmbraLine[m].longitude),d>this.southUmbraLine[m].latitude&&(d=this.southUmbraLine[m].latitude),m>0&&(null===s?s=this.southUmbraLine[m-1].longitude:b(s,this.southUmbraLine[m-1].longitude)&&(s=this.southUmbraLine[m-1].longitude),d>this.southUmbraLine[m-1].latitude&&(d=this.southUmbraLine[m-1].latitude))),89===d)return null;d=f(d,-.05),i.setSouthLimit(d)}else i.setSouthLimit(-89);if(this.centralLineTimes)for(var p=2;p<4;p++)for(m=0;m<this.centralLineTimes.length;m++)if(2===p){if(this.centralLineTimes[m].getC2Date()&&this.centralLineTimes[m].getC2Date()>=e){null===n?n=this.centralLine[m].longitude:w(n,this.centralLine[m].longitude)&&(n=this.centralLine[m].longitude);break}}else if(this.centralLineTimes[m].getC3Date()&&this.centralLineTimes[m].getC3Date()>=e){null===s&&(s=this.centralLine[m].longitude),b(s,this.centralLine[m].longitude)&&(s=this.centralLine[m].longitude),m>0&&b(s,this.centralLine[m-1].longitude)&&(s=this.centralLine[m-1].longitude);break}n=g(n,1),i.setEastLimit(n),s=g(s,-.2),i.setWestLimit(s)}return i},this.drawPenumbraShadow=function(t){var i=null,n=this.getPenumbraLimits();if(n){var s=new SolarCalc,a=t,o=this.toDate(t),l=0,c=p(n.getEastLimit(),n.getWestLimit()),u=0,h=0,m=0,d=0,f=!1,w=null,b=null,C=null,v=null,T=!1,E=0,S=0,A=new r;i=[];var P=[];for(c=Math.abs(c),d=n.getSouthLimit();d<n.getNorthLimit();d+=.5)if(l=0,u=g(n.getWestLimit(),l),A=this.calculateLocalCircumstances(d,u,0),b=A.circDates.getC4Date(),v=A.circDates.getC1Date(),E=s.getSolarElevation(d,u,o),T=A.isVisible,!(E<2&&E>=0&&T&&null!==w&&null!==C&&w>=a&&C<=a))for(l+=3;l<=c;l+=3){if(u=g(n.getWestLimit(),l),A=this.calculateLocalCircumstances(d,u,0),w=A.circDates.getC4Date(),C=A.circDates.getC1Date(),S=s.getSolarElevation(d,u,o),((f=A.isVisible)||T)&&(w&&b&&(E<=0&&S>0&&w>=a&&C<=a&&(h=g(u,Math.abs(S)/(Math.abs(E)+Math.abs(S))*-3),P.push(new e(d,h))),w>=a&&b<=a&&S>=0&&(h=g(u,Math.abs(a-w)/(Math.abs(a-w)+Math.abs(a-b))*-3),P.push(new e(d,h))),w<=a&&b>=a&&S>=0&&(h=g(u,Math.abs(a-w)/(Math.abs(a-w)+Math.abs(a-b))*-3),P.push(new e(d,h)))),C&&v&&(C>=a&&v<=a&&S>=0&&(m=g(u,Math.abs(a-C)/(Math.abs(a-C)+Math.abs(a-v))*-3),i.push(new e(d,m))),C<=a&&v>=a&&S>=0&&(m=g(u,Math.abs(a-C)/(Math.abs(a-C)+Math.abs(a-v))*-3),i.push(new e(d,m))),E>=0&&S<0&&b>=a&&v<=a))){m=g(u,Math.abs(S)/(Math.abs(E)+Math.abs(S))*-3),i.push(new e(d,m));break}b=w,v=C,E=S,T=f}P.length>0&&(P=this.sortShadowLine(!0,P)),i.length>0&&(i=this.sortShadowLine(!1,i)),L(i,P),P.length>0&&(i=i.concat(P.reverse())),i.length>1&&(i=i.concat(i[0])),i.length<2&&(i=null)}return i},this.sortShadowLine=((e,t)=>{for(var i=t[0].longitude,n=0,s=0;s<t.length;s++)e?b(i,t[s].longitude)&&(i=t[s].longitude,n=s):b(i,t[s].longitude)||(i=t[s].longitude,n=s);var a=[],o=[];return a=a.concat(t.slice(0,n+1)),o=o.concat(t.slice(n+1,t.length)),e?(a.sort(C),o.sort(v),o=o.concat(a)):(a.sort(v),o.sort(C),o=o.concat(a))}),this.drawUmbraShadow=function(t){var i=new SolarCalc,n=t,s=this.toDate(t),a=null,o=this.getUmbraLimits(n);if(o){var l=0,c=g(0,o.getWestLimit()-o.getEastLimit()),u=0,h=0,m=0,d=0,p=null,f=null,w=null,b=null,C=0,v=0,L=!1,T=!1,E=new r;a=[];var S=[];for(c=Math.abs(c),d=o.getSouthLimit();d<=o.getNorthLimit();d+=.025)if(l=0,u=g(o.getWestLimit(),l),E=this.calculateLocalCircumstances(d,u,0),f=E.circDates.getC3Date(),b=E.circDates.getC2Date(),C=i.getSolarElevation(d,u,s),L=E.isVisible,!(C<2&&C>=0&&L&&null!==p&&null!==w&&p>=n&&w<=n))for(l+=.05;l<=c;l+=.05)if(u=g(o.getWestLimit(),l),E=this.calculateLocalCircumstances(d,u,0),p=E.circDates.getC3Date(),w=E.circDates.getC2Date(),v=i.getSolarElevation(d,u,s),(T=E.isVisible)||L){if(p&&f&&(C<=0&&v>0&&p>=n&&w<=n&&(h=g(u,Math.abs(v)/(Math.abs(C)+Math.abs(v))*-.05),S.push(new e(d,h))),p>=n&&f<=n&&v>=0&&(h=g(u,Math.abs(n-p)/(Math.abs(n-p)+Math.abs(n-f))*-.05),S.push(new e(d,h))),p<=n&&f>=n&&v>=0&&(h=g(u,Math.abs(n-p)/(Math.abs(n-p)+Math.abs(n-f))*-.05),a.push(new e(d,h)))),w&&b)if(w>=n&&b<=n&&v>=0)m=g(u,Math.abs(n-w)/(Math.abs(n-w)+Math.abs(n-b))*-.05),a.push(new e(d,m));else if(w<=n&&b>=n&&v>=0)m=g(u,Math.abs(n-w)/(Math.abs(n-w)+Math.abs(n-b))*-.05),S.push(new e(d,m));else if(C>=0&&v<0&&f>=n&&b<=n){m=g(u,Math.abs(v)/(Math.abs(C)+Math.abs(v))*-.05),a.push(new e(d,m));break}f=p,b=w,C=v,L=T}S.length>1&&(S=S.reverse(),a=a.concat(S)),a.length>1&&(a=a.concat(a[0])),a.length<2&&(a=null)}return a},this.getJulianDay=function(e){var t=e.t+this.besselianElements.t0-(this.besselianElements.dUTC-.05)/3600;return t<0&&(t+=24),t>=24&&(t-=24),this.besselianElements.julianDayMax-t/24},this.getAlt=(e=>180*e.alt/Math.PI),this.getAzi=(e=>{var t=180*e.azi/Math.PI;return t<0&&(t+=360),t>=360&&(t-=360),t}),this.getP=(e=>{var t=180*e.p/Math.PI;return t<0&&(t+=360),t>=360&&(t-=360),t}),this.getDate=function(e){if(!isNaN(e.t)&&!isNaN(this.besselianElements.t0)&&!isNaN(this.besselianElements.dUTC)){var t=0,i=e.t+this.besselianElements.t0-this.besselianElements.dUTC/3600;return i<0&&(i+=24),i>=24&&(i-=24),t=Math.floor(this.besselianElements.julianDayMax-i/24+1538),t+=i/24}return null},this.getAll=function(){if(this.getMid(),this.observational(this.midCircumstances),this.midCircumstances.mid=Math.sqrt(this.midCircumstances.u*this.midCircumstances.u+this.midCircumstances.vLoc*this.midCircumstances.vLoc),this.midCircumstances.magnitude=(this.midCircumstances.l1prime-this.midCircumstances.mid)/(this.midCircumstances.l1prime+this.midCircumstances.l2prime),this.midCircumstances.moonSun=(this.midCircumstances.l1prime-this.midCircumstances.l2prime)/(this.midCircumstances.l1prime+this.midCircumstances.l2prime),this.getC1C4(),this.observational(this.c1Circumstances),this.observational(this.c4Circumstances),this.getC2C3(),this.observational(this.c2Circumstances),this.observational(this.c3Circumstances),this.midCircumstances.magnitude>0)if(this.midCircumstances.mid<this.midCircumstances.l2prime||this.midCircumstances.mid<-this.midCircumstances.l2prime)if(this.midCircumstances.l2prime<0?this.midCircumstances.localType=3:this.midCircumstances.localType=2,E){var e=this.getLimbData(this.getMaxEclipseDateJD());if(e){var t=c(m(this.c2Circumstances.p)),i=c(m(this.c2Circumstances.p)),n=Math.cos(this.c2Circumstances.p),s=Math.cos(this.c3Circumstances.p),a=Math.sin(this.c2Circumstances.p),o=Math.sin(this.c3Circumstances.p),r=Math.atan2(s-n,o-a);r=c(m(r)+270);var l=d(l),h=u(this.c2Circumstances.p,e),p=u(this.c3Circumstances.p,e),g=3600*(this.midCircumstances.l1prime+this.midCircumstances.l2prime)/(3600*(this.c3Circumstances.t-this.c1Circumstances.t)),f=-1*h/g*Math.cos(d(c(r-t))),w=p/g*Math.cos(d(c(r-i)));this.c2Circumstances.mid=f,this.c3Circumstances.mid=w,this.c2Circumstances.mid<990&&(this.c2Circumstances.t+=this.c2Circumstances.mid/3600),this.c3Circumstances.mid<990&&(this.c3Circumstances.t+=this.c3Circumstances.mid/3600)}}else this.c2Circumstances.mid=999.9,this.c3Circumstances.mid=999.9;else this.midCircumstances.localType=1;else this.midCircumstances.localType=0},this.getCoverage=function(){var e,t,i;return this.midCircumstances.magnitude<=0?0:this.midCircumstances.magnitude>=1?100:(2===this.midCircumstances.localType?i=this.midCircumstances.moonSun*this.midCircumstances.moonSun:(i=Math.acos((this.midCircumstances.l1prime*this.midCircumstances.l1prime+this.midCircumstances.l2prime*this.midCircumstances.l2prime-2*this.midCircumstances.mid*this.midCircumstances.mid)/(this.midCircumstances.l1prime*this.midCircumstances.l1prime-this.midCircumstances.l2prime*this.midCircumstances.l2prime)),t=Math.acos((this.midCircumstances.l1prime*this.midCircumstances.l2prime+this.midCircumstances.mid*this.midCircumstances.mid)/this.midCircumstances.mid/(this.midCircumstances.l1prime+this.midCircumstances.l2prime)),e=Math.PI-t-i,i=(this.midCircumstances.moonSun*this.midCircumstances.moonSun*e+t-this.midCircumstances.moonSun*Math.sin(i))/Math.PI),i?e=i=(1e3*i+.5)/10:0)},this.getDepth=function(){var e=0;return e=Math.abs(this.midCircumstances.mid/this.midCircumstances.l2prime),e=e<0?1+e:1-e,e*=100},this.getMid=function(){var e=0,t=1;for(this.midCircumstances.eventType=0,this.midCircumstances.t=0,this.timeLocalDependent(this.midCircumstances);(t>1e-6||t<-1e-6)&&e<y;)t=(this.midCircumstances.u*this.midCircumstances.a+this.midCircumstances.vLoc*this.midCircumstances.b)/this.midCircumstances.nSquared,this.midCircumstances.t=this.midCircumstances.t-t,e++,this.timeLocalDependent(this.midCircumstances)},this.getC1C4=function(){var e,t;t=Math.sqrt(this.midCircumstances.nSquared),e=(e=this.midCircumstances.a*this.midCircumstances.vLoc-this.midCircumstances.u*this.midCircumstances.b)/t/this.midCircumstances.l1prime,e=Math.sqrt(1-e*e)*this.midCircumstances.l1prime/t,this.c1Circumstances.eventType=-2,this.c4Circumstances.eventType=2,this.c1Circumstances.t=this.midCircumstances.t-e,this.c4Circumstances.t=this.midCircumstances.t+e,this.c1c4Iterate(this.c1Circumstances),this.c1c4Iterate(this.c4Circumstances)},this.c1c4Iterate=function(e){var t,i,n,s;for(this.timeLocalDependent(e),t=e.eventType<0?-1:1,n=1,i=0;(n>1e-6||n<-1e-6)&&i<y;)s=Math.sqrt(e.nSquared),n=(n=e.a*e.vLoc-e.u*e.b)/s/e.l1prime,n=t*Math.sqrt(1-n*n)*e.l1prime/s,n=(e.u*e.a+e.vLoc*e.b)/e.nSquared-n,e.t=e.t-n,this.timeLocalDependent(e),i++;return e},this.getC2C3=function(){var e,t;t=Math.sqrt(this.midCircumstances.nSquared),e=(e=this.midCircumstances.a*this.midCircumstances.vLoc-this.midCircumstances.u*this.midCircumstances.b)/t/this.midCircumstances.l2prime,e=Math.sqrt(1-e*e)*this.midCircumstances.l2prime/t,this.c2Circumstances.eventType=-1,this.c3Circumstances.eventType=1,this.midCircumstances.l2prime<0?(this.c2Circumstances.t=this.midCircumstances.t+e,this.c3Circumstances.t=this.midCircumstances.t-e):(this.c2Circumstances.t=this.midCircumstances.t-e,this.c3Circumstances.t=this.midCircumstances.t+e),this.c2c3Iterate(this.c2Circumstances),this.c2c3Iterate(this.c3Circumstances)},this.c2c3Iterate=function(e){var t,i,n,s;for(this.timeLocalDependent(e),t=e.eventType<0?-1:1,this.midCircumstances.l2prime<0&&(t=-t),n=1,i=0;(n>1e-6||n<-1e-6)&&i<50;)s=Math.sqrt(e.nSquared),n=(n=e.a*e.vLoc-e.u*e.b)/s/e.l2prime,n=t*Math.sqrt(1-n*n)*e.l2prime/s,n=(e.u*e.a+e.vLoc*e.b)/e.nSquared-n,e.t=e.t-n,this.timeLocalDependent(e),i++;return e},this.timeLocalDependent=function(e){var t;return this.timeDependent(e),e.h=e.mu-this.observerConstants.getLongRadians()-this.besselianElements.dT/13713.44,e.sinH=Math.sin(e.h),e.cosH=Math.cos(e.h),e.xi=this.observerConstants.getRhoCosO()*e.sinH,e.eta=this.observerConstants.getRhoSinO()*e.cosDelta-this.observerConstants.getRhoCosO()*e.cosH*e.sinDelta,e.zeta=this.observerConstants.getRhoSinO()*e.sinDelta+this.observerConstants.getRhoCosO()*e.cosH*e.cosDelta,e.dxi=e.dmu*this.observerConstants.getRhoCosO()*e.cosH,e.deta=e.dmu*e.xi*e.sinDelta-e.zeta*e.dd,e.u=e.x-e.xi,e.vLoc=e.y-e.eta,e.a=e.dx-e.dxi,e.b=e.dy-e.deta,-2!==(t=e.eventType)&&0!==t&&2!==t||(e.l1prime=e.l1-e.zeta*this.besselianElements.tanF1),-1!==t&&0!==t&&1!==t||(e.l2prime=e.l2-e.zeta*this.besselianElements.tanF2),e.nSquared=e.a*e.a+e.b*e.b,e},this.timeDependent=function(e){var t,i,n;return i=e.t,n=this.besselianElements.x3*i+this.besselianElements.x2,n=n*i+this.besselianElements.x1,n=n*i+this.besselianElements.x0,e.x=n,n=3*this.besselianElements.x3*i+2*this.besselianElements.x2,n=n*i+this.besselianElements.x1,e.dx=n,n=this.besselianElements.y3*i+this.besselianElements.y2,n=n*i+this.besselianElements.y1,n=n*i+this.besselianElements.y0,e.y=n,n=3*this.besselianElements.y3*i+2*this.besselianElements.y2,n=n*i+this.besselianElements.y1,e.dy=n,n=this.besselianElements.d2*i+this.besselianElements.d1,n=n*i+this.besselianElements.d0,n=n*Math.PI/180,e.d=n,e.sinDelta=Math.sin(n),e.cosDelta=Math.cos(n),n=2*this.besselianElements.d2*i+this.besselianElements.d1,n=n*Math.PI/180,e.dd=n,n=this.besselianElements.m2*i+this.besselianElements.m1,(n=n*i+this.besselianElements.m0)>=360&&(n-=360),n=n*Math.PI/180,e.mu=n,n=2*this.besselianElements.m2*i+this.besselianElements.m1,n=n*Math.PI/180,e.dmu=n,-2!==(t=e.eventType)&&0!==t&&2!==t||(n=(n=this.besselianElements.l12*i+this.besselianElements.l11)*i+this.besselianElements.l10,e.l1=n,e.dl1=2*this.besselianElements.l12*i+this.besselianElements.l11),-1!==t&&0!==t&&1!==t||(n=(n=this.besselianElements.l22*i+this.besselianElements.l21)*i+this.besselianElements.l20,e.l2=n,e.dl2=2*this.besselianElements.l22*i+this.besselianElements.l21),e},this.observational=function(e){var t,i,n;t=0===e.eventType?1:3!==this.midCircumstances.localType||-1!==e.eventType&&1!==e.eventType?1:-1,e.p=Math.atan2(t*e.u,t*e.vLoc),n=Math.sin(this.observerConstants.getLatRadians()),i=Math.cos(this.observerConstants.getLatRadians()),e.alt=Math.asin(e.sinDelta*n+e.cosDelta*i*e.cosH),e.q=Math.asin(i*e.sinH/Math.cos(e.alt)),e.eta<0&&(e.q=Math.PI-e.q),e.vObs=e.p-e.q,e.azi=Math.atan2(-1*e.sinH*e.cosDelta,e.sinDelta*i-e.cosH*n*e.cosDelta)},this.setMaxJulianDay=function(e){this.besselianElements.julianDayMax=e,this.maxEclipseDate=s(this.besselianElements.julianDayMax)},this.getMaxEclipseDate=function(){return this.maxEclipseDate},this.getMaxEclipseDateJD=function(){return this.besselianElements.julianDayMax},this.isTotalOrAnnular=function(){return"Annular"===this.type||"Total"===this.type||"Hybrid"===this.type},this.set(n)}jQuery.fn.extend({mdlUpgraded:function(e){return $(this).on("mdl-componentupgraded",e)},animationEndOne:function(e){return $(this).one("animationend",e)},animationEnd:function(e){return $(this).on("animationend",e)},animationStart:function(e){return $(this).on("animationstart",e)},clickOff:function(e){return $(this).off("click",e)},clickOne:function(e){return $(this).one("click",e)},longPress:function(e){var t=null,i=e,n=0,s=0,a=0,o=0,r=0,l=0;$(this).on("touchend mouseup",e=>{t&&(window.clearTimeout(t),t=null)}),$(this).on("touchstart mousedown",function(e){"mousedown"===e.type?(n=e.pageX,s=e.pageY):(n=e.changedTouches[0].pageX,s=e.changedTouches[0].pageY),$(this).on("touchmove mousemove",function(e){"mousemove"===e.type?(r=e.pageX,l=e.pageY):(r=e.changedTouches[0].pageX,l=e.changedTouches[0].pageY),a=r-n,o=l-s,(Math.abs(a)>20||Math.abs(o)>20)&&($(this).off("touchmove mousemove"),t&&(window.clearTimeout(t),t=null))}),$(this).one("touchend mouseup",function(e){$(this).off("touchmove mousemove"),t&&(window.clearTimeout(t),t=null)}),t&&(window.clearTimeout(t),t=null),t=window.setTimeout(function(){$(this).off("touchmove mousemove"),console.log("Long press fired."),i(e)},750)})},longPressOff:function(e){return $(this).off("touchmove mousemove"),$(this).off("touchend mouseup",e),$(this).off("touchstart mousedown",e)},transitionEndOne:function(e){return $(this).one("transitionend",e)},transitionEnd:function(e){return $(this).on("transitionend",e)},transitionEndOff:function(e){return $(this).off("transitionend",e)},transitionOrAnimation:function(e){return $(this).on("transitionend animationend",e)},transitionOrAnimationOff:function(e){return $(this).off("transitionend animationend",e)},transitionOrAnimationOne:function(e){return $(this).one("transitionend animationend",e)},touchStart:function(e){return $(this).on("touchstart mousedown",e)},touchEnd:function(e){return $(this).on("touchend mouseup",e)},touchEndOff:function(e){return $(this).off("touchend mouseup",e)},touchEndOne:function(e){return $(this).one("touchend mouseup",e)},touchMove:function(e){var t=e;return $(this).on("touchmove",t),$(this).mousedown(function(e){1===e.which&&$(this).mousemove(t)}),$(this).mouseup(function(e){$(this).off("mousemove")}),$(this)},swipe:function(e){var t=e,i=0,n=0,s=0,a=0,o=0,r=0,l="none";return $(this).touchStart(e=>{"mousedown"===e.type?(i=e.pageX,n=e.pageY):(i=e.changedTouches[0].pageX,n=e.changedTouches[0].pageY)}),$(this).touchMove(e=>{"mousemove"===e.type?(o=e.pageX,r=e.pageY):(o=e.changedTouches[0].pageX,r=e.changedTouches[0].pageY),s=o-i,a=r-n,l=Math.abs(a)>Math.abs(s)?a>0?"down":"up":s>0?"right":"left",(Math.abs(a)>50||Math.abs(s)>50)&&(e.swipeType=l,e.distX=s,e.distY=a,e.swipeX=o,e.swipeY=r,e.startX=i,e.startY=n,t(e))}),$(this)},swipeOff:function(e){return $(this).off("touchstart mousedown mouseup mousemove touchmove",e)}});class u{constructor(){function e(){return $("section.is-active").index()}function t(){return $("section").toArray().length}function i(e){var t=$(this).index();if(console.log("Tab click fired."),t!==_&&!O){n(e);var i=window.setTimeout(()=>{E.transitionOrAnimationOff(),_=t,s(),H&&(e.currentPageIdx=t,H(e)),console.log("No page change animation called.")},500);E.transitionOrAnimationOne(()=>{window.clearTimeout(i),E.transitionOrAnimationOff(),_=t,s(),H&&(e.currentPageIdx=t,H(e)),console.log("Section transistion or animation called.")})}O=!1}function n(e){z&&z(e)}function s(){D&&a();for(var e=0;e<U.length;e++)U[e]===_&&o()}function a(){C.swipe(l),C.touchEnd(c),D=!1}function o(){C.swipeOff(),C.touchEndOff(),D=!0,c()}function r(e){"left"===e.swipeType&&(A.swipeOff(),b.MaterialLayout.toggleDrawer(),console.log("Drawer swipe left."),A.transitionEndOne(e=>{A.swipe(r),console.log("Drawer swipe listener back on.")}))}function l(t){if("right"===t.swipeType){if(t.startX<f*y)M||(C.swipeOff(),M=!0,console.log("Calling drawer trigger"),C.touchEndOne(e=>{console.log("Drawer trigger"),b.MaterialLayout.toggleDrawer(),M=!1,C.swipe(l)}));else if(_>0&&($(E[_]).offset({left:t.distX}),Math.abs(t.distX)>y*w&&!k)){C.swipeOff(),k=!0;var i=$(E[_]).children("div.page-content"),a=$(E[_-1]).children("div.page-content");i.addClass("eclipse-content-swipe-out-right"),i.animationEndOne(t=>{i.removeClass("eclipse-content-swipe-out-right"),a.addClass("eclipse-content-swipe-in-right"),O=!0,S[_-1].click(),$(E[_]).css("left",""),n(t),a.animationEndOne(t=>{a.removeClass("eclipse-content-swipe-in-right"),C.swipe(l),_=t.currentPageIdx=e(),s(),H&&H(t)})})}}else if("left"===t.swipeType&&_<E.length-1&&($(E[_]).offset({left:t.distX}),Math.abs(t.distX)>y*w&&!k)){C.swipeOff(),k=!0;var i=$(E[_]).children("div.page-content"),a=$(E[_+1]).children("div.page-content");i.addClass("eclipse-content-swipe-out-left"),i.animationEndOne(t=>{i.removeClass("eclipse-content-swipe-out-left"),a.addClass("eclipse-content-swipe-in-left"),O=!0,S[_+1].click(),$(E[_]).css("left",""),z(t),a.animationEndOne(t=>{a.removeClass("eclipse-content-swipe-in-left"),C.swipe(l),_=t.currentPageIdx=e(),s(),H&&H(t)})})}}function c(){E.css({position:""}),M=!1,k=!1}function u(e){console.log("Material window resize called."),y=h(),B&&B(e)}function h(){return $(window).width()}function m(){T.show(),v.hasClass("eclipse-header-transition")||v.addClass("eclipse-header-transition"),T.hasClass("eclipse-footer-transition")||T.addClass("eclipse-footer-transition"),T.transitionEndOff(),R=!1,N&&T.transitionEndOne(N)}function d(){R=!0,N&&N(),T.transitionEndOff(),T.transitionEndOne(e=>{console.log("Footer change."),T.hide()}),v.removeClass("eclipse-header-transition"),T.removeClass("eclipse-footer-transition")}function p(){(g=$("#main-header").children("div.mdl-layout__drawer-button")).addClass("eclipse-drawer-button")}var g,f=.15,w=.5,b=document.querySelector("#main-content"),C=$("#app-content"),v=$("header"),L=$("#table-bar"),T=$("footer"),E=$("section"),S=$("header a"),A=$(".mdl-layout__drawer"),P=$(".mdl-spinner"),M=!1,y=h(),_=e(),k=!1,D=!1,O=!1,N=null,I=null,x=!1,R=!1,U=[],B=null,H=null,z=null;!function(){if(b.classList.contains("is-upgraded"))console.log("MDL already upgraded."),p(),I?(console.log("Callback to MDL complete."),window.setTimeout(I,1)):x=!0;else{var e=!1,t=b,i=new MutationObserver(t=>{i.disconnect(),console.log("MDL mutations found: "+t.length),t.length>0&&(e||(e=!0,p(),I?I():x=!0))}),n={attributes:!0};i.observe(t,n)}}(),function(){var e=navigator.userAgent.toLowerCase();e.indexOf("windows")>-1||e.indexOf("macintosh")>-1||e.indexOf("linux")>-1&&-1===e.indexOf("android")?(console.log("Running on desktop browser."),$("head").append("<style>::-webkit-scrollbar{ width: 9px; height: 9px;} ::-webkit-scrollbar-thumb { background: #ccc;}</style>")):console.log("Running on mobile browser.")}(),console.log("Binding material addon events."),$(window).resize(u),a(),S.click(i),A.swipe(r),this.changePage=(i=>{if(!i)throw"Must provide page index to change to.";if("number"!=typeof i)throw"Page index must be numberic.";a=e();if(i!==a&&i>0&&i<t()){if(i>a){C.swipeOff(),k=!0;var a=$(E[a]).children("div.page-content"),o=$(E[i]).children("div.page-content");a.addClass("eclipse-content-swipe-out-left"),a.animationEndOne(t=>{a.removeClass("eclipse-content-swipe-out-left"),o.addClass("eclipse-content-swipe-in-left"),O=!0,S[i].click(),n(t),o.animationEndOne(t=>{o.removeClass("eclipse-content-swipe-in-left"),C.swipe(l),_=t.currentPageIdx=e(),s(),k=!1,H&&H(t)})})}else{C.swipeOff(),k=!0;var a=$(E[a]).children("div.page-content"),o=$(E[i]).children("div.page-content");a.addClass("eclipse-content-swipe-out-right"),a.animationEndOne(t=>{a.removeClass("eclipse-content-swipe-out-right"),o.addClass("eclipse-content-swipe-in-right"),O=!0,S[i].click(),n(t),o.animationEndOne(t=>{o.removeClass("eclipse-content-swipe-in-right"),C.swipe(l),_=t.currentPageIdx=e(),s(),k=!1,H&&H(t)})})}return!0}return!1}),this.focusDrawer=(()=>{A.focus()}),this.disableYScroll=(()=>{C.css("overflow-y","hidden")}),this.enableYScroll=(()=>{C.css("overflow-y","")}),this.onHeaderChange=(e=>{"function"==typeof e&&(N=e)}),this.onMDLComplete=(e=>{"function"==typeof e&&(I=e,x&&(x=!1,I()))}),this.getCurrentPageIndex=(()=>e()),this.getHeaderHeight=(()=>{if(R)return 0;var e=L.outerHeight(!0)/2;return v.outerHeight(!0)+e}),this.getFooterHeight=(()=>R?0:T.outerHeight(!0)),this.getPages=(()=>E),this.disableSwipe=(e=>{void 0===e?o():"number"==typeof e?U.push(e):"object"==typeof e&&Array.isArray(e)&&(e[0],!0)?U=U.concat(e):o()}),this.enableSwipe=(()=>{U.length=0,setSwipeOn()}),this.getPageIndex=(()=>e()),this.onPageChange=(e=>{if(!e)throw"Invalid input to onPageChange.";"function"==typeof e&&(H=e)}),this.onBeforePageChange=(e=>{if(!e)throw"Invalid input to onPageChange.";"function"==typeof e&&(z=e)}),this.toggleHeaderFooter=(e=>void 0!==e?e?(m(),!0):(d(),!1):v.hasClass("eclipse-header-transition")?(d(),!1):(m(),!0)),this.showSpinner=(()=>{P.removeClass("is-active"),P.addClass("is-active")}),this.hideSpinner=(()=>{P.removeClass("is-active"),P.addClass("zero-height")}),this.isHeaderFooterShown=(()=>!R),this.isDrawerOpen=(()=>A.hasClass("is-visible")),this.onDrawerOpen=function(e){A.transitionEnd(function(t){this.isDrawerOpen()&&e(t)}.bind(this))},this.onDrawerClosed=function(e){A.transitionEnd(function(t){this.isDrawerOpen()||e(t)}.bind(this))},this.onWindowResize=(e=>{B=e}),this.toggleDrawer=(()=>{b.MaterialLayout.toggleDrawer()}),this.spinBackDrawerButton=(()=>{g&&(g.hasClass("eclipse-rotate-drawer-button")?(g.removeClass("eclipse-rotate-drawer-button"),g.transitionEndOne(()=>{g.clickOff(),g.children("i").html("menu")})):(g.addClass("eclipse-rotate-drawer-button"),g.clickOne(()=>{b.MaterialLayout.toggleDrawer(),console.log("Drawer open prevented."),g.removeClass("eclipse-rotate-drawer-button"),g.transitionEndOne(()=>{g.children("i").html("menu")})}),g.transitionEndOne(()=>{g.children("i").html("arrow_forward")})))}),this.unSpinDrawerButton=(()=>{g.hasClass("eclipse-rotate-drawer-button")&&(g.removeClass("eclipse-rotate-drawer-button"),g.transitionEndOne(()=>{g.clickOff(),g.children("i").html("menu")}))}),this.isDrawerButtonSpun=(()=>!!g.hasClass("eclipse-rotate-drawer-button"))}}class h{constructor(e,t,i,n){function s(){try{a[0].close(),document.querySelector(".mdl-list").style.overflowY="auto",document.querySelector(".mdl-list").style.overflowY="",o.clickOff(),r.clickOff()}catch(e){console.log("Dialog box already closed.")}}var a=$("#diag"),o=$("#ok_button"),r=$("#close_button"),l=$("#diag_title"),c=$("#diag_description"),u=null,h=null;componentHandler.upgradeElement(a[0]),a[0].showModal||dialogPolyfill.registerDialog(a[0]),a.css("background-color","white"),l.html("Error"),c.html("An error occured."),o.html("OK"),r.html("Close"),o.show(),r.show(),e&&l.html(e),t&&c.html(t),i&&o.html(i),n&&r.html(n),o.click(e=>{if(console.log("OK close called."),s(),u)return u(e)}),r.click(e=>{if(console.log("CLOSE close called."),s(),h)return h(e)}),this.close=(()=>{s()}),this.hideOKButton=(()=>{o.hide()}),this.hideCloseButton=(()=>{r.hide()}),this.show=(()=>{try{a[0].show(),window.setTimeout(()=>{o.focus()},1e3)}catch(e){console.log("Show dialog already called.")}}),this.showModal=(()=>{try{a[0].showModal()}catch(e){console.log("Dialog already open.")}}),this.setTitleText=(e=>{l.html(e)}),this.setDescriptionText=(e=>{c.html(e)}),this.setOKCallBack=(e=>{u=e}),this.setOKText=(e=>{o.html(e)}),this.setCloseCallBack=(e=>{h=e}),this.setCloseText=(e=>{r.html(e)})}}var m=Math.PI/180,d=180/Math.PI,p=function(e,t){this.lon=e,this.lat=t,this.x=m*e,this.y=m*t};p.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},p.prototype.antipode=function(){var e=-1*this.lat,t=this.lon<0?180+this.lon:-1*(180-this.lon);return new p(t,e)};var g=function(){this.coords=[],this.length=0};g.prototype.move_to=function(e){this.length++,this.coords.push(e)};var f=function(e){this.properties=e||{},this.geometries=[]};f.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1==this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var e=[],t=0;t<this.geometries.length;t++)e.push(this.geometries[t].coords);return{geometry:{type:"MultiLineString",coordinates:e},type:"Feature",properties:this.properties}},f.prototype.wkt=function(){for(var e="",t="LINESTRING(",i=0;i<this.geometries.length;i++){if(0===this.geometries[i].coords.length)return"LINESTRING(empty)";this.geometries[i].coords.forEach(e=>{t+=e[0]+" "+e[1]+","}),e+=t.substring(0,t.length-1)+")"}return e};var w=function(e,t,i){if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new p(e.x,e.y),this.end=new p(t.x,t.y),this.properties=i||{};var n=this.start.x-this.end.x,s=this.start.y-this.end.y,a=Math.pow(Math.sin(s/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(n/2),2);if(this.g=2*Math.asin(Math.sqrt(a)),this.g==Math.PI)throw new Error("it appears "+e.view()+" and "+t.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+e+" and "+t)};if(w.prototype.interpolate=function(e){var t=Math.sin((1-e)*this.g)/Math.sin(this.g),i=Math.sin(e*this.g)/Math.sin(this.g),n=t*Math.cos(this.start.y)*Math.cos(this.start.x)+i*Math.cos(this.end.y)*Math.cos(this.end.x),s=t*Math.cos(this.start.y)*Math.sin(this.start.x)+i*Math.cos(this.end.y)*Math.sin(this.end.x),a=t*Math.sin(this.start.y)+i*Math.sin(this.end.y),o=d*Math.atan2(a,Math.sqrt(Math.pow(n,2)+Math.pow(s,2)));return[d*Math.atan2(s,n),o]},w.prototype.Arc=function(e,t){var i=[];if(!e||e<=2)i.push([this.start.lon,this.start.lat]),i.push([this.end.lon,this.end.lat]);else for(var n=1/(e-1),s=0;s<e;++s){var a=n*s,o=this.interpolate(a);i.push(o)}for(var r=!1,l=0,c=t&&t.offset?t.offset:10,u=180-c,h=-180+c,m=360-c,d=1;d<i.length;++d){var p=i[d-1][0],w=i[d][0],b=Math.abs(w-p);b>m&&(w>u&&p<h||p>u&&w<h)?r=!0:b>l&&(l=b)}var C=[];if(r&&l<c){var v=[];C.push(v);for(var L=0;L<i.length;++L){var T=parseFloat(i[L][0]);if(L>0&&Math.abs(T-i[L-1][0])>m){var E=parseFloat(i[L-1][0]),S=parseFloat(i[L-1][1]),A=parseFloat(i[L][0]),P=parseFloat(i[L][1]);if(E>-180&&E<h&&180==A&&L+1<i.length&&i[L-1][0]>-180&&i[L-1][0]<h){v.push([-180,i[L][1]]),L++,v.push([i[L][0],i[L][1]]);continue}if(E>u&&E<180&&-180==A&&L+1<i.length&&i[L-1][0]>u&&i[L-1][0]<180){v.push([180,i[L][1]]),L++,v.push([i[L][0],i[L][1]]);continue}if(E<h&&A>u){var M=E;E=A,A=M;var y=S;S=P,P=y}if(E>u&&A<h&&(A+=360),E<=180&&A>=180&&E<A){var _=(180-E)/(A-E),k=_*P+(1-_)*S;v.push([i[L-1][0]>u?180:-180,k]),(v=[]).push([i[L-1][0]>u?-180:180,k]),C.push(v)}else v=[],C.push(v);v.push([T,i[L][1]])}else v.push([i[L][0],i[L][1]])}}else{var D=[];C.push(D);for(var O=0;O<i.length;++O)D.push([i[O][0],i[O][1]])}for(var N=new f(this.properties),I=0;I<C.length;++I){var x=new g;N.geometries.push(x);for(var $=C[I],R=0;R<$.length;++R)x.move_to($[R])}return N},"undefined"!=typeof module&&void 0!==module.exports)module.exports.Coord=p,module.exports.Arc=f,module.exports.GreatCircle=w;else{var b={};b.Coord=p,b.Arc=f,b.GreatCircle=w}class C{constructor(){var e=null,t=["Africa/Abidjan","Africa/Accra","Africa/Addis_Ababa","Africa/Algiers","Africa/Asmara","Africa/Bamako","Africa/Bangui","Africa/Banjul","Africa/Bissau","Africa/Blantyre","Africa/Brazzaville","Africa/Bujumbura","Africa/Cairo","Africa/Casablanca","Africa/Ceuta","Africa/Conakry","Africa/Dakar","Africa/Dar_es_Salaam","Africa/Djibouti","Africa/Douala","Africa/El_Aaiun","Africa/Freetown","Africa/Gaborone","Africa/Harare","Africa/Johannesburg","Africa/Juba","Africa/Kampala","Africa/Khartoum","Africa/Kigali","Africa/Kinshasa","Africa/Lagos","Africa/Libreville","Africa/Lome","Africa/Luanda","Africa/Lubumbashi","Africa/Lusaka","Africa/Malabo","Africa/Maputo","Africa/Maseru","Africa/Mbabane","Africa/Mogadishu","Africa/Monrovia","Africa/Nairobi","Africa/Ndjamena","Africa/Niamey","Africa/Nouakchott","Africa/Ouagadougou","Africa/Porto-Novo","Africa/Sao_Tome","Africa/Tripoli","Africa/Tunis","Africa/Windhoek","America/Adak","America/Anchorage","America/Anguilla","America/Antigua","America/Araguaina","America/Argentina/Buenos_Aires","America/Argentina/Catamarca","America/Argentina/Cordoba","America/Argentina/Jujuy","America/Argentina/La_Rioja","America/Argentina/Mendoza","America/Argentina/Rio_Gallegos","America/Argentina/Salta","America/Argentina/San_Juan","America/Argentina/San_Luis","America/Argentina/Tucuman","America/Argentina/Ushuaia","America/Aruba","America/Asuncion","America/Atikokan","America/Bahia","America/Bahia_Banderas","America/Barbados","America/Belem","America/Belize","America/Blanc-Sablon","America/Boa_Vista","America/Bogota","America/Boise","America/Cambridge_Bay","America/Campo_Grande","America/Cancun","America/Caracas","America/Cayenne","America/Cayman","America/Chicago","America/Chihuahua","America/Coral_Harbour","America/Costa_Rica","America/Creston","America/Cuiaba","America/Curacao","America/Danmarkshavn","America/Dawson","America/Dawson_Creek","America/Denver","America/Detroit","America/Dominica","America/Edmonton","America/Eirunepe","America/El_Salvador","America/Fort_Nelson","America/Fortaleza","America/Glace_Bay","America/Godthab","America/Goose_Bay","America/Grand_Turk","America/Grenada","America/Guadeloupe","America/Guatemala","America/Guayaquil","America/Guyana","America/Halifax","America/Havana","America/Hermosillo","America/Indiana/Indianapolis","America/Indiana/Knox","America/Indiana/Marengo","America/Indiana/Petersburg","America/Indiana/Tell_City","America/Indiana/Vevay","America/Indiana/Vincennes","America/Indiana/Winamac","America/Inuvik","America/Iqaluit","America/Jamaica","America/Juneau","America/Kentucky/Louisville","America/Kentucky/Monticello","America/Kralendijk","America/La_Paz","America/Lima","America/Los_Angeles","America/Lower_Princes","America/Maceio","America/Managua","America/Manaus","America/Marigot","America/Martinique","America/Matamoros","America/Mazatlan","America/Menominee","America/Merida","America/Metlakatla","America/Mexico_City","America/Miquelon","America/Moncton","America/Monterrey","America/Montevideo","America/Montreal","America/Montserrat","America/Nassau","America/New_York","America/Nipigon","America/Nome","America/Noronha","America/North_Dakota/Beulah","America/North_Dakota/Center","America/North_Dakota/New_Salem","America/Ojinaga","America/Panama","America/Pangnirtung","America/Paramaribo","America/Phoenix","America/Port_of_Spain","America/Port-au-Prince","America/Porto_Velho","America/Puerto_Rico","America/Punta_Arenas","America/Rainy_River","America/Rankin_Inlet","America/Recife","America/Regina","America/Resolute","America/Rio_Branco","America/Santarem","America/Santiago","America/Santo_Domingo","America/Sao_Paulo","America/Scoresbysund","America/Sitka","America/St_Barthelemy","America/St_Johns","America/St_Kitts","America/St_Lucia","America/St_Thomas","America/St_Vincent","America/Swift_Current","America/Tegucigalpa","America/Thule","America/Thunder_Bay","America/Tijuana","America/Toronto","America/Tortola","America/Vancouver","America/Whitehorse","America/Winnipeg","America/Yakutat","America/Yellowknife","Antarctica/Macquarie","Arctic/Longyearbyen","Asia/Aden","Asia/Almaty","Asia/Amman","Asia/Anadyr","Asia/Aqtau","Asia/Aqtobe","Asia/Ashgabat","Asia/Atyrau","Asia/Baghdad","Asia/Bahrain","Asia/Baku","Asia/Bangkok","Asia/Barnaul","Asia/Beirut","Asia/Bishkek","Asia/Brunei","Asia/Chita","Asia/Choibalsan","Asia/Chongqing","Asia/Colombo","Asia/Damascus","Asia/Dhaka","Asia/Dili","Asia/Dubai","Asia/Dushanbe","Asia/Famagusta","Asia/Gaza","Asia/Harbin","Asia/Hebron","Asia/Ho_Chi_Minh","Asia/Hong_Kong","Asia/Hovd","Asia/Irkutsk","Asia/Jakarta","Asia/Jayapura","Asia/Jerusalem","Asia/Kabul","Asia/Kamchatka","Asia/Karachi","Asia/Kashgar","Asia/Kathmandu","Asia/Khandyga","Asia/Kolkata","Asia/Krasnoyarsk","Asia/Kuala_Lumpur","Asia/Kuching","Asia/Kuwait","Asia/Macau","Asia/Magadan","Asia/Makassar","Asia/Manila","Asia/Muscat","Asia/Nicosia","Asia/Novokuznetsk","Asia/Novosibirsk","Asia/Omsk","Asia/Oral","Asia/Phnom_Penh","Asia/Pontianak","Asia/Pyongyang","Asia/Qatar","Asia/Qyzylorda","Asia/Rangoon","Asia/Riyadh","Asia/Sakhalin","Asia/Samarkand","Asia/Seoul","Asia/Shanghai","Asia/Singapore","Asia/Srednekolymsk","Asia/Taipei","Asia/Tashkent","Asia/Tbilisi","Asia/Tehran","Asia/Thimphu","Asia/Tokyo","Asia/Tomsk","Asia/Ulaanbaatar","Asia/Urumqi","Asia/Ust-Nera","Asia/Vientiane","Asia/Vladivostok","Asia/Yakutsk","Asia/Yekaterinburg","Asia/Yerevan","Atlantic/Azores","Atlantic/Bermuda","Atlantic/Canary","Atlantic/Cape_Verde","Atlantic/Faroe","Atlantic/Madeira","Atlantic/Reykjavik","Atlantic/South_Georgia","Atlantic/St_Helena","Atlantic/Stanley","Australia/Adelaide","Australia/Brisbane","Australia/Broken_Hill","Australia/Currie","Australia/Darwin","Australia/Eucla","Australia/Hobart","Australia/Lindeman","Australia/Lord_Howe","Australia/Melbourne","Australia/Perth","Australia/Sydney","Europe/Amsterdam","Europe/Andorra","Europe/Astrakhan","Europe/Athens","Europe/Belgrade","Europe/Berlin","Europe/Bratislava","Europe/Brussels","Europe/Bucharest","Europe/Budapest","Europe/Busingen","Europe/Chisinau","Europe/Copenhagen","Europe/Dublin","Europe/Gibraltar","Europe/Guernsey","Europe/Helsinki","Europe/Isle_of_Man","Europe/Istanbul","Europe/Jersey","Europe/Kaliningrad","Europe/Kiev","Europe/Kirov","Europe/Lisbon","Europe/Ljubljana","Europe/London","Europe/Luxembourg","Europe/Madrid","Europe/Malta","Europe/Mariehamn","Europe/Minsk","Europe/Monaco","Europe/Moscow","Europe/Oslo","Europe/Paris","Europe/Podgorica","Europe/Prague","Europe/Riga","Europe/Rome","Europe/Samara","Europe/San_Marino","Europe/Sarajevo","Europe/Saratov","Europe/Simferopol","Europe/Skopje","Europe/Sofia","Europe/Stockholm","Europe/Tallinn","Europe/Tirane","Europe/Ulyanovsk","Europe/Uzhgorod","Europe/Vaduz","Europe/Vatican","Europe/Vienna","Europe/Vilnius","Europe/Volgograd","Europe/Warsaw","Europe/Zagreb","Europe/Zaporozhye","Europe/Zurich","Indian/Antananarivo","Indian/Chagos","Indian/Christmas","Indian/Cocos","Indian/Comoro","Indian/Kerguelen","Indian/Mahe","Indian/Maldives","Indian/Mauritius","Indian/Mayotte","Indian/Reunion","Pacific/Apia","Pacific/Auckland","Pacific/Bougainville","Pacific/Chatham","Pacific/Chuuk","Pacific/Easter","Pacific/Efate","Pacific/Enderbury","Pacific/Fakaofo","Pacific/Fiji","Pacific/Funafuti","Pacific/Galapagos","Pacific/Gambier","Pacific/Guadalcanal","Pacific/Guam","Pacific/Honolulu","Pacific/Johnston","Pacific/Kiritimati","Pacific/Kosrae","Pacific/Kwajalein","Pacific/Majuro","Pacific/Marquesas","Pacific/Midway","Pacific/Nauru","Pacific/Niue","Pacific/Norfolk","Pacific/Noumea","Pacific/Pago_Pago","Pacific/Palau","Pacific/Pitcairn","Pacific/Pohnpei","Pacific/Port_Moresby","Pacific/Rarotonga","Pacific/Saipan","Pacific/Tahiti","Pacific/Tarawa","Pacific/Tongatapu","Pacific/Wake","Pacific/Wallis","Pacific/Yap","Etc/GMT+12","Etc/GMT+11","Etc/GMT+10","Etc/GMT+9","Etc/GMT+8","Etc/GMT+7","Etc/GMT+6","Etc/GMT+5","Etc/GMT+4","Etc/GMT+3","Etc/GMT+2","Etc/GMT+1","Etc/GMT","Etc/GMT-1","Etc/GMT-2","Etc/GMT-3","Etc/GMT-4","Etc/GMT-5","Etc/GMT-6","Etc/GMT-7","Etc/GMT-8","Etc/GMT-9","Etc/GMT-10","Etc/GMT-11","Etc/GMT-12"],i=new XMLHttpRequest;i.open("GET","tz.bin",!0),i.responseType="arraybuffer",i.onload=(t=>{var n=i.response;n&&(e=new DataView(n),console.log("Array buff loaded."))}),i.send(null),this.lookup=((i,n)=>{if(!e)throw new Error("Time zone data file not yet loaded.");var s,a,o,r,l,c;if(i=+i,n=+n,!(i>=-90&&i<=90&&n>=-180&&n<=180))throw new RangeError("invalid coordinates");for(a=0|(s=48*(180+n)/360.00000000000006),r=0|(o=24*(90-i)/180.00000000000003),l=-1,c=e.getUint16(2*(48*r+a),!1);c<65536-t.length;)a=0|(s=(s-a)%1*2),r=0|(o=(o-r)%1*2),l=l+c+1,c=e.getUint16(2*(1152+2*(2*l+r)+a),!1);return t[c-(65536-t.length)]})}}var v=115,L=13,T=81,E=4,S=87,A=5,P=21,M=56,y=50;n.prototype.toString=function(){return""+this.getRawMilliSeconds()},n.prototype.toJSON=function(){return this.getRawMilliSeconds()},c.prototype.getLimbData=function(e){return 2457987.267725===e?this.tse2017LimbData():null},c.prototype.tse2017LimbData=(()=>[0,.25,1439,-.36,-.2,-.5,-.73,-.47,-.54,-.3,-.3,-.29,-.33,-.08,-.03,-.08,-.09,-.13,-.33,-.28,-.21,-.19,-.18,.06,.26,.13,.13,.09,.42,.1,-.26,.21,.03,.11,.24,.22,-.06,-.26,-.56,-.43,-.01,-.09,-.04,.11,0,.03,-.14,-.3,-.07,-.05,-.16,-.08,.04,.1,-.03,.02,.2,.22,.32,.31,.42,.34,.13,.22,.2,.25,.29,.31,.35,.17,.49,.49,.5,.44,.22,-.03,-.3,-.36,-.35,-.01,-.25,-.23,-.27,-.49,-.37,-.49,-.5,-.29,-.24,-.26,-.36,-.23,-.43,-.35,-.22,-.25,-.43,-.51,-.56,-.4,-.5,-.53,-.65,-.5,-.49,-.52,-.57,-.43,-.47,-.54,-.26,-.25,-.48,-.6,-.6,-.54,-.44,-.48,-.32,-.36,-.28,-.27,-.34,-.17,-.1,-.17,-.28,-.48,-.58,-.61,-.66,-.91,-.75,-.86,-.71,-.56,-.46,-.16,-.14,.11,-.1,-.31,-.53,-.59,-.71,-.62,-.41,-.14,-.43,-.45,-.33,-.37,-.55,-.13,-.17,-.06,-.15,-.23,.11,-.1,.07,-.29,-.1,-.05,-.27,-.35,-.52,-.64,-.84,-.6,-.13,-.32,-.79,-.95,-1.05,-1.12,-1.05,-.95,-1.11,-1.09,-.93,-1.24,-.83,-.79,-.76,-.45,-.25,-.33,-.51,-.53,-.42,-.63,-.82,-.57,-.59,-.81,-.84,-.81,-.9,-.81,-.57,-.81,-.85,-.84,-1,-.9,-1.12,-1.02,-1.01,-1.1,-1.15,-1,-.79,-.7,-.6,-.82,-1.07,-1.15,-1.01,-.93,-1.02,-.4,-.51,-.84,-.87,-.69,-.61,-.84,-.91,-.78,-.84,-.84,-.56,-.54,-.41,-.58,-.72,-.77,-.85,-.51,-.34,-.34,-.18,-.04,-.23,-.37,-.28,-.28,-.48,-.27,-.22,-.25,-.43,-.45,-.42,-.65,-.59,-.59,-.79,-.8,-.44,-.36,-.3,-.46,-.58,-.23,-.18,-.1,-.11,.15,.13,-.1,-.37,-.8,-.34,-.42,-.31,-.31,-.28,-.11,-.21,-.13,-.08,.04,.14,.1,.14,.26,.24,-.1,-.22,-.1,.12,.14,.27,.38,.57,.51,.38,.24,.13,.26,.43,.7,.86,.92,.76,.67,.55,.35,.07,.38,.42,-.1,-.18,-.2,.16,-.01,-.15,-.16,-.3,-.32,-.5,-.38,-.46,-.51,-.46,-.41,-.33,-.27,.17,-.13,-.08,-.05,-.17,-.23,-.3,-.01,.39,.22,.5,.57,.56,.14,.3,.1,.07,.19,.71,.8,.63,.2,.21,.22,.19,.44,.02,.18,.41,.35,.27,.86,.76,.36,.49,.44,.57,.16,.37,.71,.33,.35,.19,.4,.14,.23,.25,.47,.66,.71,.83,.88,.99,.96,.98,1.19,1.26,1.05,1.4,1.24,1.11,1.35,1.15,.85,.89,.46,-.04,.02,-.05,.11,-.23,-.06,.34,.4,.18,.2,.33,.72,1.12,.92,1.19,.58,.8,.63,.63,.6,.39,.57,1.26,1.19,1.39,1.69,1.71,1.67,1.57,1.79,1.35,.59,.43,.63,.44,.28,.99,1.08,1.2,1.07,.97,.41,.26,.26,.21,.87,.81,.77,.66,.8,.59,.09,.4,.68,.28,.07,.23,.63,.05,.65,.38,.91,1.01,.88,.27,.28,.06,-.03,.02,.49,.5,.76,.55,.95,1.54,1.35,1.14,.72,.78,.77,.65,.33,.09,.18,.17,.07,.15,.05,.04,.07,.09,.17,.25,.14,.2,.54,1.22,1.22,1.48,1.51,1.78,1.66,1.42,1.5,1.81,1.8,1.43,1.52,1.85,1.41,1.17,1.14,1.09,.78,1.06,.78,1.15,1.63,1.97,2.53,2.8,2.84,2.9,2.89,2.79,2.83,2.75,2.57,2.47,2.78,2.54,2.36,2.35,2.42,2.22,2.41,1.84,1.2,1.09,1.22,1.01,.97,1.12,1,1.3,1.27,1.18,1.18,1.28,1.36,1.39,.94,.84,.94,.93,.91,.68,.62,.67,.42,.48,.38,.31,.69,.39,.45,.58,.96,1.05,.82,.84,.78,.36,.22,.28,.4,.7,.86,1.1,1.72,1.51,.97,1.3,.76,.67,.42,.01,-.06,-.1,-.08,.32,.37,.29,.42,.44,.68,.68,.7,.99,1.13,1.81,2.33,2.2,2.48,2.47,2.57,2.56,2.19,2.3,1.8,1.8,1.73,1.65,1.62,1.43,1.68,2.19,2.3,1.97,2.17,2.12,1.79,2,2.25,2.36,2.38,2.37,2.23,2.41,2.34,2.22,2.09,2.14,2.37,2.51,2.51,2.58,2.31,2.22,2.51,2.6,2.07,2.04,1.65,1.84,1.72,1.76,1.83,1.57,1.2,.91,1.22,1.02,.64,.81,.66,.18,-.14,-.27,-.67,-.69,-.1,.45,.07,.54,.71,.74,1.18,1.71,1.25,.93,1.2,1.83,1.03,.73,.77,.92,.93,.09,-.3,-.39,-.39,-.58,-.41,-.72,-.46,-.72,-.56,-.91,-1.27,-1.35,-1.29,-1.38,-1.39,-1.09,-.45,.03,-.1,.16,.31,-.14,.38,1.57,1.36,.1,-.2,-.23,-.69,-.96,-.58,.36,.61,.38,.14,-1.09,-1.21,-.47,-.31,-.51,-.13,-.06,.49,.61,.48,.39,.41,.57,.42,.35,.26,.2,.45,-.31,-.25,.34,.84,.64,1.19,.92,.84,.45,.42,.3,-.07,-.74,-.79,-.63,-.74,-.9,-.85,-.85,-.89,-.49,.28,1.4,1.22,1.03,.63,.03,.03,.13,-.04,.25,.25,.8,1.26,1.46,1.27,1.31,1.42,1.87,2.16,2.19,2.08,1.89,1.5,1.41,1.55,2.02,2.21,2.42,2.4,2.19,1.68,1.18,.74,.24,-.13,-.51,-.52,-.37,-.4,-.26,-.13,-.12,-.32,-.5,-.45,-.35,.35,1.03,.76,.5,.22,.24,.35,.48,.72,.65,.85,1.04,.59,.69,.77,.85,.57,.51,.23,.26,.06,-.12,-.17,-.24,-.41,-.39,-.27,-.46,-.72,-.9,-.87,-.78,-.57,-.11,-.33,.16,-.03,.06,.14,.11,.3,.54,.63,.73,.56,.65,.35,.02,.02,.01,.11,-.02,.11,0,-.37,-.29,-.06,-.13,-.04,.3,.77,.55,.71,.23,-.21,0,-.12,-.32,-.16,-.06,.01,-.27,-.28,-.35,-.36,-.51,-.54,-.18,-.24,-.26,-.26,-.14,-.27,-.1,.04,-.28,-.19,-.28,-.35,-.27,.16,.42,.02,.42,.38,.08,.1,.16,.17,.1,-.27,-.5,-.44,-.71,-.57,-.56,-.45,-.65,-.61,-.58,-.88,-.84,-.69,-.6,-.24,-.2,-.33,-.06,-.33,-.21,-.53,-.48,-.58,-.53,-.54,-.49,-.74,-.93,-.86,-.78,-.69,-.35,-.62,-.59,-1.03,-1.08,-1.22,-1.22,-1.02,-.8,-.75,-.83,-.83,-1.09,-1.33,-1.37,-1.25,-1.13,-1.13,-1.18,-1.29,-1.29,-1.37,-1.28,-1.38,-1.33,-1.29,-1.44,-1.26,-.9,-.64,-.68,-.88,-.73,-.64,-.65,-.38,-.4,-.34,-.26,-.23,-.2,-.22,.03,-.15,-.31,-.07,-.14,-.38,-.23,-.25,.14,-.23,-.17,-.13,-.11,.24,.1,.26,.37,.47,.01,-.44,-.63,-.78,-.66,-.24,.19,.21,.3,-.15,-.54,-.38,.09,.24,.11,-.02,.01,.13,.19,.41,.39,.36,.06,-.16,-.16,.01,.05,.11,.23,.28,.08,.37,.69,.96,.91,.9,.8,1.13,1.32,1.44,1.16,.85,.86,.64,.49,.56,.26,.49,.31,.32,.3,.42,.45,.3,.32,.49,.32,.2,.69,.91,1.23,1.08,1.32,1.17,.68,.18,.55,.42,.4,.35,.11,-.22,-.08,-.11,-.11,-.1,.05,.27,.21,.16,.34,.68,.93,1.05,.66,.74,.49,.78,-.44,-.56,-.03,.1,.33,-.03,.1,.13,.28,.15,-.41,-.73,-.81,-.6,-.58,-1.14,-1.03,-.95,-.58,-.52,-.24,-.14,-.16,-.24,-.29,-.66,-.53,-.58,-.68,-.62,-.71,-.73,-.71,-.7,-.67,-.92,-.76,-.9,-.76,-.79,-1.04,-1.14,-1.17,-1.02,-1.11,-1.23,-1.35,-1.37,-1.43,-1.36,-1.19,-1.19,-.96,-1.1,-.96,-.76,-1.01,-1.32,-1.43,-1.57,-1.54,-1.49,-1.37,-1.25,-1.37,-1,-1.01,-1,-1.08,-1.23,-.99,-1,-.79,-.74,-.94,-.95,-.5,-.61,-.73,-.74,-.73,-.66,-.69,-.52,-.61,-.54,-.4,-.62,-.68,-.72,-.79,-.69,-.19,-.5,-.49,-.61,-.41,-.31,-.44,-.45,-.29,.03,-.03,.01,-.23,-.48,-.49,-.69,-.84,-.93,-1.01,-.81,-.72,-.69,-.61,-.42,-.33,-.18,-.09,-.2,-.22,-.36,-.21,-.18,-.17,-.16,-.41,-.33,-.3,-.33,-.44,-.39,-.24,-.29,-.13,-.15,-.13,-.12,-.04,-.23,-.12,-.21,-.05,.09,.15,.29,.06,.28,.09,.07,.28,.41,.54,.5,.44,.17,.09,.17,.1,.13,.22,.2,.11,-.08,-.33,-.15,.18,.07,.15,-.09,-.09,-.13,-.06,.08,.19,.24,.38,.56,.24,.13,.29,.47,.55,.53,.66,.57,.59,.54,.16,.07,.23,.19,.1,.13,0,.31,.31,.33,.3,.42,.33,.49,1.05,.97,.52,.19,.33,.18,-.12,.04,.19,.32,-.08,-.78,-.97,-1.04,-1.15,-1.12,-1.5,-1.41,-1.45,-1.15,-1.15,-.93,-1.48,-1.61,-1.44,-1.2,-1.71,-1.42,-1.57,-1.71,-1.5,-.81,-.84,-.7,-1.03,-1.25,-1.18,-1.21,-1.14,-1.24,-1.15,-.94,-1.26,-1.05,-.86,-.93,-.9,-1.2,-1.66,-1.81,-1.93,-1.89,-1.7,-1.85,-1.68,-1.65,-1.35,-1.26,-1.27,-1.35,-1.41,-1.16,-1.11,-1.1,-.88,-.73,-.7,-.6,-.69,-.02,-.43,-.44,-.31,-.09,-.45,-.25,-.24,-.04,-.09,-.19,-.11,-.08,-.42,-.39,-.46,-.59,-.6,-.17,.03,-.05,-.14,-.28,.35,.08,-.04,-.37,-.37,-.3,-.41,-.5,-.54,-.34,-.43,-.48,-.37,-.49,.18,-.27,-.22,-.53,-.79,-.76,-.76,-.61,-.47,-.56,-.67,-.77,-.94,-.88,-.86,-.72,-.42,-.05,-.01,-.22,-.27,-.34,-.35,-.45,-.47,-.42,-.53,-.31,-.51,-.58,-.64,-.47,-.33,-.02,-.06,-.05,-.34,-.28,-.42,-.35,-.42,-.52,-.54,-.41,-.53,-.73,-.74,-.82,-.82,-.72,-.63,-.62,-.37,-.45,-.44,-.36,-.46,-.3,-.6,-.3,-.27]);class _{constructor(e){function t(){w=!0,console.log("Eclipse load error called."),"function"==typeof f&&f()}function i(){w||(console.log("Load complete called."),"function"==typeof g&&g())}function n(){return p.length}function s(e){return p[e]}function a(e,i){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=(e=>{if(200===n.status)i(n.response);else if(0===n.status){if(void 0!==n.response&&""!==n.response)return void i(n.response);console.log("Empty eclipse load response."),t()}else console.log("Eclipse load XHR status error: "+n.status),t()}),n.onerror=(e=>{console.log("Other request error."),t()}),n.send()}function o(){p.sort((e,t)=>e.maxEclipseDate.getTime()-t.maxEclipseDate.getTime())}function r(e,t,i){var n=36e5;if(isNaN(i)||(n=i),isNaN(e.getTime()))return!1;if(isNaN(t.getTime()))return!1;var s=e.getTime()-t.getTime();return s<=n&&s>=-1*n}function l(){console.log("Loading Besselian elements.");var e=SE1901();if(!(e=e.concat(SE2001())))return console.log("No eclipse elements found in javascript file."),!1;for(var t,i=0;i<e.length-27;i++)(t=new c).setMaxJulianDay(Number(e[i])),i++,t.besselianElements.t0=Number(e[i]),i++,t.besselianElements.tMin=Number(e[i]),i++,t.besselianElements.tMax=Number(e[i]),i++,t.besselianElements.dUTC=Number(e[i]),i++,t.besselianElements.dT=Number(e[i]),i++,t.besselianElements.x0=Number(e[i]),i++,t.besselianElements.x1=Number(e[i]),i++,t.besselianElements.x2=Number(e[i]),i++,t.besselianElements.x3=Number(e[i]),i++,t.besselianElements.y0=Number(e[i]),i++,t.besselianElements.y1=Number(e[i]),i++,t.besselianElements.y2=Number(e[i]),i++,t.besselianElements.y3=Number(e[i]),i++,t.besselianElements.d0=Number(e[i]),i++,t.besselianElements.d1=Number(e[i]),i++,t.besselianElements.d2=Number(e[i]),i++,t.besselianElements.m0=Number(e[i]),i++,t.besselianElements.m1=Number(e[i]),i++,t.besselianElements.m2=Number(e[i]),i++,t.besselianElements.l10=Number(e[i]),i++,t.besselianElements.l11=Number(e[i]),i++,t.besselianElements.l12=Number(e[i]),i++,t.besselianElements.l20=Number(e[i]),i++,t.besselianElements.l21=Number(e[i]),i++,t.besselianElements.l22=Number(e[i]),i++,t.besselianElements.tanF1=Number(e[i]),i++,t.besselianElements.tanF2=Number(e[i]),p.push(t);return e.length=0,o(),!0}function u(e){var t="",i="",n="";t=e.substr(0,4);var s=(i=e.substr(5,6))+", "+t+" "+(n=e.substr(13,9))+" GMT";return new Date(s)}function h(e){console.log("Loading cat");var a=e.match(/[^\r\n]+/g),o=0;if(0===n())return console.log("No eclipse loaded from catalog."),void t();for(var l=0;l<n();l++){for(var c=o;c<a.length;c++)if(a[c].length===v){var h=u(a[c].substr(L,P));if(isNaN(h.getTime()))console.log("Unable to parse date catalog line: "+c);else if("-"===a[c][L]&&h.setUTCFullYear(-1*h.getUTCFullYear()),r(h,s(l).maxEclipseDate)){m(a[c],l),d(a[c],l);break}}o=c}console.log("Load complete, TODO: remove data responded."),i()}function m(e,t){if(t>=0&&t<n()){var i=parseFloat(e.substr(T,E)),a=parseFloat(e.substr(S,A));"S"===e[T+E]&&(i*=-1),"W"===e[S+A]&&(a*=-1),s(t).midEclipsePoint.setPosition(i,a)}}function d(e,t){if(t>=0&&t<n())switch(e[M]){case"P":s(t).type="Partial";break;case"A":s(t).type="Annular";break;case"T":s(t).type="Total";break;case"H":s(t).type="Hybrid";break;default:console.log("No eclipse type found.")}}var p=[],g=null,f=null,w=!1;this.loadEclipseElements=((e,i,n,s)=>{g=n,f=s,importScripts(i),l()?a(e,h):t()}),this.deleteEclipses=(()=>{p.length=0}),this.addEclipse=(e=>{p.push(new c(e))}),this.getEclipse=function(e){return!isNaN(e)&&e<this.getEclipseCount()?p[e]:null},this.getEclipseCount=(()=>p.length),this.getNextEclipseIdx=function(){var e=new Date;e.setUTCDate(e.getUTCDate()-2);for(var t=0;t<this.getEclipseCount()&&!(e<p[t].maxEclipseDate);t++);return t>=this.getEclipseCount()&&(t=this.getEclipseCount()-1)<0&&(t=0),t},this.getNextEclipse=function(){return p[this.getNextEclipseIdx()]},this.eclipseToJSON=(()=>JSON.stringify(p)),this.copyEclipsesIn=function(e){if(void 0!==e&&Array.isArray(e))for(var t=0;t<e.length;t++)this.addEclipse(e[t])},this.copyEclipsesIn(e)}}class k{constructor(){function e(e){var t=e.getUTCMonth()+1,i=e.getUTCDate(),n=e.getUTCFullYear(),s=e.getUTCHours(),a=e.getUTCMinutes(),o=e.getUTCSeconds(),r=e.getUTCMilliseconds();t<=2&&(n-=1,t+=12);var l=Math.floor(n/100),c=2-l+Math.floor(l/4),u=Math.floor(365.25*(n+4716))+Math.floor(30.6001*(t+1))+i+c-1524.5;return u+=s/24,u+=a/1440,u+=o/86400,u+=r/864e5,u+=1537.5}function t(){if(k){var t=new Date;t.setTime(t.getTime()+_+u),b=e(t)}else{if(E>0){var i=((new Date).getTime()-E)/864e5*c;S+=i}(b=C+S)>v?(b=C,E=0,S=0):E=(new Date).getTime()}y&&b>=L&&b<=T?o(b):(A++,P=null),l(b),r(b)}function i(e){var t=JSON.parse(e.data.moon_pos),i=JSON.parse(e.data.sun_pos);f&&f({moon_pos:t,sun_pos:i})}function n(e){M=JSON.parse(e.data.pen_shadow),2===++A&&(A=0,g&&g({pen_shadow:M,umb_shadow:P,date:h.toDate(b),umb_speed:O}),t())}function s(e){P=JSON.parse(e.data.umb_shadow),O=e.data.umb_speed,2===++A&&(A=0,g&&g({pen_shadow:M,umb_shadow:P,date:h.toDate(b),umb_speed:O}),t())}function a(){b=S=E=C=v=L=T=0}function o(e){d.postMessage({cmd:"shadow",time:e.toString()})}function r(e){var t=h.toDate(e),i=e-1537.5;p.postMessage({cmd:"real",jd:i.toString(),time:t.getTime().toString()})}function l(e){m.postMessage({cmd:"shadow",time:e.toString()})}var c=300;const u=2e3;var h=null,m=null,d=null,p=null,g=null,f=null,w=!1,b=0,C=0,v=0,L=0,T=0,E=0,S=0,A=0,P=null,M=null,y=!1,_=0,k=!1,D={},O="";this.getMoonPosition=((t,n,s)=>{var a=0;n.altitude&&(a=n.altitude);var o={latitude:n.latitude,longitude:n.longitude,altitude:a};f=s,p||((p=new Worker("workers/moonWorker.js")).onmessage=i);var r=e(t)-1537.5;p.postMessage({cmd:"location",coords:JSON.stringify(o)}),p.postMessage({cmd:"real",jd:r.toString(),time:t.getTime().toString()})}),this.isAnimating=(()=>w),this.isRealTime=(()=>!!w&&k),this.reset=function(){h=null,g=null,this.stop()},this.setEclipse=(e=>{h=e}),this.start=function(e,a,o){if(this.stop(),o&&o.realTime&&(k=!0,o.dateOffset&&(_=o.dateOffset)),!h)throw new Error("Must set eclipse before starting animation.");w=!0,y=h.isTotalOrAnnular(),g=e,f=a,p||(p=new Worker("workers/moonWorker.js")),p.onmessage=i,p.postMessage({cmd:"eclipse",eclipse:JSON.stringify(h)}),p.postMessage({cmd:"location",coords:JSON.stringify(D)}),(m=new Worker("workers/animateWorker.js")).onmessage=n,C=h.getPenumbraStartTimeJD(),v=h.getPenumbraEndTimeJD(),m.postMessage({cmd:"eclipse",eclipse:JSON.stringify(h)}),y&&((d=new Worker("workers/umbraWorker.js")).onmessage=s,L=h.getUmbraStartTimeJD(),T=h.getUmbraEndTimeJD(),d.postMessage({cmd:"eclipse",eclipse:JSON.stringify(h)})),t()},this.setCoords=(e=>{D.latitude=e.latitude,D.longitude=e.longitude,e.altitude?D.altitude=e.altitude:D.altitude=0}),this.stop=(()=>{w=!1,a(),m&&(m.terminate(),m=null),d&&(d.terminate(),d=null),P=null,M=null,A=0,y=!1,k=!1,_=0})}}class D{constructor(e,t){function i(e){var t=e.data;switch(t.cmd){case"eclipse_central_line_update":g.isRunning=!1,o++,c({type:"central_line",line:JSON.parse(t.line),times:JSON.parse(t.times)});break;case"eclipse_north_umbra_line_update":f.isRunning=!1,o++,c({type:"north_umbra_line",line:JSON.parse(t.line),times:JSON.parse(t.times)});break;case"eclipse_south_umbra_line_update":w.isRunning=!1,o++,c({type:"south_umbra_line",line:JSON.parse(t.line),times:JSON.parse(t.times)});break;case"eclipse_south_penumbra_line_update":console.log("SOUTH ACTUALLY DONE."),b.isRunning=!1,o++,d=t.line,m=!0,h&&(m=!1,h=!1,v.isRunning=!0,v.postMessage({cmd:"east_penumbra_line",eclipse:l,south_pen_line:d,north_pen_line:p}),L.isRunning=!0,L.postMessage({cmd:"west_penumbra_line",eclipse:l,south_pen_line:d,north_pen_line:p})),c({type:"south_penumbra_line",line:JSON.parse(d)});break;case"eclipse_north_penumbra_line_update":console.log("NORTH ACTUALLLY DONE"),C.isRunning=!1,o++,p=t.line,h=!0,m&&(m=!1,h=!1,v.isRunning=!0,v.postMessage({cmd:"east_penumbra_line",eclipse:l,south_pen_line:d,north_pen_line:p}),L.isRunning=!0,L.postMessage({cmd:"west_penumbra_line",eclipse:l,south_pen_line:d,north_pen_line:p})),c({type:"north_penumbra_line",line:JSON.parse(p)});break;case"eclipse_east_penumbra_line_update":v.isRunning=!1,o++,c({type:"east_penumbra_line",line:JSON.parse(t.line),times:JSON.parse(t.times)});break;case"eclipse_west_penumbra_line_update":L.isRunning=!1,o++,c({type:"west_penumbra_line",line:JSON.parse(t.line),times:JSON.parse(t.times)});break;case"eclipse_central_line_error":g.isRunning=!1,r++,console.log("LINE WORKER: Central line error.");break;case"eclipse_north_umbra_line_error":f.isRunning=!1,r++,console.log("LINE WORKER: North umbra line error.");break;case"eclipse_south_umbra_line_error":w.isRunning=!1,r++,console.log("LINE WORKER: South ubmra line error.");break;case"eclipse_south_penumbra_line_error":b.isRunning=!1,r++,console.log("LINE WORKER: South penumbra line error.");break;case"eclipse_north_penumbra_line_error":C.isRunning=!1,r++,console.log("LINE WORKER: North penumbra line error.");break;case"eclipse_east_penumbra_line_error":v.isRunning=!1,r++,console.log("LINE WORKER: East penumbra line error.");break;case"eclipse_west_penumbra_line_error":L.isRunning=!1,r++,console.log("LINE WORKER: West penumbra line error.");break;default:r++,console.log("LINE WORKER: Invalid line command.")}o+r===s&&(a&&(window.clearTimeout(a),a=null),o-r==0&&console.log("LINE ERROR: No lines drawn."),u(o),o=0,r=0)}function n(e){a&&(window.clearTimeout(a),a=null),g.isRunning&&(g.terminate(),(g=new Worker("workers/calculateWorker.js")).onmessage=i,g.isRunning=!1),f.isRunning&&(f.terminate(),(f=new Worker("workers/calculateWorker.js")).onmessage=i,f.isRunning=!1),w.isRunning&&(w.terminate(),(w=new Worker("workers/calculateWorker.js")).onmessage=i,w.isRunning=!1),b.isRunning&&(b.terminate(),(b=new Worker("workers/calculateWorker.js")).onmessage=i,b.isRunning=!1),C.isRunning&&(C.terminate(),(C=new Worker("workers/calculateWorker.js")).onmessage=i,C.isRunning=!1),v.isRunning&&(v.terminate(),(v=new Worker("workers/calculateWorker.js")).onmessage=i,v.isRunning=!1),L.isRunning&&(L.terminate(),(L=new Worker("workers/calculateWorker.js")).onmessage=i,L.isRunning=!1),e&&(u(o),o=0,r=0)}if(console.log("Initing line workers"),"function"!=typeof e)throw new Error("Must use callback function for single line complete updaterr.");if("function"!=typeof t)throw new Error("Must use callback function for all lines complete fucntion.");const s=7;var a=null,o=0,r=0,l=null,c=e,u=t,h=!1,m=!1,d="null",p="null",g=new Worker("workers/calculateWorker.js"),f=new Worker("workers/calculateWorker.js"),w=new Worker("workers/calculateWorker.js"),b=new Worker("workers/calculateWorker.js"),C=new Worker("workers/calculateWorker.js"),v=new Worker("workers/calculateWorker.js"),L=new Worker("workers/calculateWorker.js");g.onmessage=i,g.isRunning=!1,f.onmessage=i,f.isRunning=!1,w.onmessage=i,w.isRunning=!1,b.onmessage=i,b.isRunning=!1,C.onmessage=i,C.isRunning=!1,v.onmessage=i,v.isRunning=!1,L.onmessage=i,L.isRunning=!1,this.updateLines=(e=>{l=e,d="null",p="null",h=!1,m=!1,o=0,r=0,n(!1),g.isRunning=!0,g.postMessage({cmd:"central_line",eclipse:e}),f.isRunning=!0,f.postMessage({cmd:"north_umbra_line",eclipse:e}),w.isRunning=!0,w.postMessage({cmd:"south_umbra_line",eclipse:e}),b.isRunning=!0,b.postMessage({cmd:"south_penumbra_line",eclipse:e}),C.isRunning=!0,C.postMessage({cmd:"north_penumbra_line",eclipse:e}),a=window.setTimeout(()=>{console.log("Line worker thread timeout."),n(!0)},1e4)})}}class O{static get RUN_BEFORE(){return"run_before"}static get ECLIPSE_IDX(){return"eclipse_idx"}static get ECLIPSE_DATA(){return"eclipse_data"}static get OPEN_PAGE(){return"page_idx"}static get SHOW_EXTRAS(){return"show_extras"}static get SHOW_RADAR(){return"show_radar"}static get SHOW_VIS(){return"show_vis"}static get SHOW_IR(){return"show_ir"}static get LAST_POSITION(){return"postion"}static get GPS_ON(){return"gps"}static get MAP_LOCEKD(){return"map_lock"}static get MAP_CENTER(){return"map_center"}static get MAP_ZOOM(){return"map_zoom"}static get DATE_OFFSET(){return"date_offset"}static get EVENT_WARNING(){return"event_warning"}static get AUDIO_ON(){return"audio"}static get ECLIPSE_TIP(){return"eclipse_tip"}static get LOCATION_TIP(){return"location_tip"}static get LONG_PRESS_TIP(){return"long_press_tip"}static get SIM_TIP(){return"sim_tip"}static get MAP_TIP(){return"map_tip"}static get TIME_TIP(){return"time_tip"}}class N{constructor(){this.timer=null,this.interval=null}}class I{constructor(){function e(e){return e&&(window.clearTimeout(e),e=null),e}function t(e){return e.timer&&(window.clearTimeout(e.timer),e.timer=null),e.interval&&(window.clearInterval(e.interval),e.interval=null),e}function i(e){var t=e.parent();e[0].scrollIntoView();var i=Math.round(t.scrollTop()),n=t[0].scrollHeight,s=Math.round(t.height()/2),a=n-Math.round(t.height())-Math.round(e.height()),o=Math.round(e.position().top);i<s?t.scrollTop(0):i>s&&i<a?t.scrollTop(i-s):o<s?t.scrollTop(i-s+(i-a)):t.scrollTop(n)}function n(t,i,n,s){if(null===n){if(t<o+i&&t>i){var a=t-i,r=window.setTimeout(()=>{r=null,console.log("Playing: "+s.id),C&&s.play()},a);return console.log("Audio "+s.id+" timer set."),r}}else if(t<=i-4e3||t>o+i)return console.log("Audio "+s.id+" timer cleared."),e(n);return n}function s(e){return window.setInterval(()=>{e.css("background-color",l),window.setTimeout(()=>{e.css("background-color","")},c)},2*c)}function a(e,n,a,l){if(null===a.timer&&null===a.interval){if(e<o+n&&e>n){var c=e-n;return a.timer=window.setTimeout(()=>{a.timer=null,console.log("Flashing: "+l.attr("id")),i(l),a.interval=s(l)},c),console.log("Flash "+l.attr("id")+" timer set."),a}}else if(e<=n-r||e>o+n)return console.log("Flashing "+l.attr("id")+" stopped."),t(a);return a}const o=11e3,r=2e4,l="lightblue",c=500;var u=document.getElementById("threebeeps"),h=document.getElementById("firstcontact-voice"),m=document.getElementById("secondcontact-voice"),d=document.getElementById("mid-voice"),p=document.getElementById("thirdcontact-voice"),g=document.getElementById("fourthcontact-voice"),f=document.getElementById("shadowbands-voice"),w=document.getElementById("bailysbeads-voice"),b=document.getElementById("diamond-voice"),C=!0,v=null,L=null,T=null,E=null,S=null,A=null,P=null,M=null,y=null,_=null,k=null,D=null,O=null,I=new N,x=new N,$=new N,R=new N,U=new N;u.play().then(()=>{window.setTimeout(()=>{u.pause(),u.currentTime=0},100)}),this.checkPartialTimers=((e,t,i)=>{if(!t)throw new Error("Must input Object of times in this function.");if(!i)throw new Error("Must input Object of cells to flash in this function.");if(!e)throw new Error("Must input current datetime in this function.");var s=0;t.c1Time&&(s=t.c1Time.getTime()-e.getTime(),v=n(s,2890,v,u),L=n(s,7e3,L,h),i.c1Cell&&(I=a(s,1e4,I,i.c1Cell))),t.midTime&&(s=t.midTime.getTime()-e.getTime(),S=n(s,2890,S,u),A=n(s,7e3,A,d),i.midCell&&($=a(s,1e4,$,i.midCell))),t.c4Time&&(s=t.c4Time.getTime()-e.getTime(),y=n(s,2890,y,u),_=n(s,7e3,_,g),i.c4Cell&&(U=a(s,1e4,U,i.c4Cell)))}),this.checkTotalTimers=((e,t,i,s)=>{if(!e)throw new Error("Must include current time in this function.");if(!i)throw new Error("Must provide object of central times in this function.");if(!s)throw new Error("Must provide object of cells to flash in this function.");var o=0;i.c2Time&&(o=i.c2Time.getTime()-e.getTime(),t&&(k=n(o,45e3,k,f),D=n(o,2e4,D,w),O=n(o,5e3,O,b)),E=n(o,7e3,E,m),T=n(o,2890,T,u),s.c2Cell&&(x=a(o,1e4,x,s.c2Cell))),i.c3Time&&(o=i.c3Time.getTime()-e.getTime(),P=n(o,2890,P,u),M=n(o,7e3,M,p),s.c3Cell&&(R=a(o,1e4,R,s.c3Cell)))}),this.off=(()=>{C=!1}),this.on=(()=>{C=!0}),this.playCueBeeps=(()=>{u.play()}),this.restTotal=(()=>{T=e(T),E=e(E),P=e(P),M=e(M),k=e(k),D=e(D),O=e(O),x=t(x),R=t(R)}),this.reset=function(){this.restTotal(),v=e(v),L=e(L),S=e(S),A=e(A),y=e(y),_=e(_),I=t(I),$=t($),U=t(U),console.log("Audio timers reset.")}}}class x{constructor(){function e(){return!!(u&&m&&d)}function t(){g||(S=window.setTimeout(()=>{console.log("Showing map tip."),S=null;var e=$("#map-tip");e.css("top","25%"),e.css("left","calc(75% - 90px)"),e.addClass("material-tip-active"),window.setTimeout(()=>{console.log("Removing map tip."),e.hasClass("material-tip-active")&&(p=!0,g=!0,window.localStorage.setItem(O.MAP_TIP,!0),e.removeClass("material-tip-active"))},s)},l))}function i(){w||(P=window.setTimeout(()=>{console.log("Showing sim tip."),P=null;var e=$("#sim-tip");e.css("top","25%"),e.css("left","calc(75% - 90px)"),e.addClass("material-tip-active"),window.setTimeout(()=>{console.log("Removing sim tip."),e.hasClass("material-tip-active")&&(f=!0,w=!0,window.localStorage.setItem(O.SIM_TIP,!0),e.removeClass("material-tip-active"))},s)},l))}function n(){d||(L=window.setTimeout(()=>{L=null,console.log("Showing location tip 2.");var e=$("#location-tip2"),t="calc(100% - "+(10+e.outerHeight())+"px)";e.css("top",t),e.css("left",".2em"),e.addClass("material-tip-active"),window.setTimeout(()=>{console.log("Removing location tip 2."),e.hasClass("material-tip-active")&&(m=!0,d=!0,window.localStorage.setItem(O.LOCATION_TIP,!0),e.removeClass("material-tip-active"))},s)},l))}const s=7e3,a=s-1e3,o=3e3+a,r=o+a,l=200,c=r+2*a+1e3;var u=!1,h=!1,m=!1,d=!1,p=!1,g=!1,f=!1,w=!1,b=!1,C=null,v=null,L=null,T=null,E=null,S=null,A=null,P=null,M=null;window.localStorage.getItem(O.ECLIPSE_TIP)&&(u=!0),window.localStorage.getItem(O.LONG_PRESS_TIP)&&(h=!0),window.localStorage.getItem(O.LOCATION_TIP)&&(m=!0,d=!0),window.localStorage.getItem(O.MAP_TIP)&&(p=!0,g=!0),window.localStorage.getItem(O.SIM_TIP)&&(f=!0,w=!0),window.localStorage.getItem(O.TIME_TIP)&&(b=!0),this.showEclipseTip=(()=>{u||(C=window.setTimeout(()=>{C=null,console.log("Showing eclispe tip.");var e=$("#eclipse-tip");e.css("top","1em"),e.css("left",".2em"),e.addClass("material-tip-active"),window.setTimeout(()=>{console.log("Removing eclipse tip."),e.hasClass("material-tip-active")&&(u=!0,window.localStorage.setItem(O.ECLIPSE_TIP,!0),e.removeClass("material-tip-active"))},s)},3e3))}),this.showLongPressTip=(()=>{var t=o;e()&&(t=p?3e3:o),h||(T=window.setTimeout(()=>{console.log("Showing long press tip."),T=null;var e=$("#time-travel-tip");e.css("top","60%"),e.css("left","25%"),e.addClass("material-tip-active"),window.setTimeout(()=>{console.log("Removing long press tip."),e.hasClass("material-tip-active")&&(h=!0,window.localStorage.setItem(O.LONG_PRESS_TIP,!0),e.removeClass("material-tip-active"))},s)},t))}),this.showLocationTips=(()=>{m||(v=window.setTimeout(()=>{v=null,console.log("Showing location tip 1.");var e=$("#location-tip"),t="calc(100% - "+(10+e.outerHeight())+"px)";e.css("top",t),e.css("left","1em"),e.addClass("material-tip-active"),window.setTimeout(()=>{console.log("Removing location tip 1."),e.hasClass("material-tip-active")&&(e.removeClass("material-tip-active"),n())},s)},r))}),this.showTimeTip=(()=>{b||(M=window.setTimeout(()=>{M=null,console.log("Showing time tip.");var e=$("#time-tip"),t="calc(100% - "+(10+e.outerHeight())+"px)",i="calc(100% - "+e.outerWidth()+"px)";e.css("top",t),e.css("left",i),e.addClass("material-tip-active"),window.setTimeout(()=>{console.log("Removing time tip."),e.hasClass("material-tip-active")&&(b=!0,window.localStorage.setItem(O.TIME_TIP,b),e.removeClass("material-tip-active"))},s)},3e3))}),this.showMapMenuTip=(()=>{if(!p){var i=c;e()&&(i=3e3),E=window.setTimeout(()=>{console.log("Showing map menu tip."),E=null;var e=$("#map-menu-tip");e.css("top","1em"),e.css("left","calc(100% - 175px)"),e.addClass("material-tip-active"),window.setTimeout(()=>{console.log("Removing map menu tip."),e.hasClass("material-tip-active")&&(e.removeClass("material-tip-active"),t())},s)},i)}}),this.showSimMenuTip=(()=>{if(!f){var t=c;e()&&(t=3e3),A=window.setTimeout(()=>{console.log("Showing sim menu tip."),A=null;var e=$("#sim-menu-tip");e.css("top","1em"),e.css("left","calc(100% - 175px)"),e.addClass("material-tip-active"),window.setTimeout(()=>{console.log("Removing sim menu tip."),e.hasClass("material-tip-active")&&(e.removeClass("material-tip-active"),i())},s)},t)}}),this.killPageSpecificTips=(()=>{$("#time-travel-tip").removeClass("material-tip-active"),T&&(console.log("Killing long press tip"),window.clearTimeout(T),T=null),$("#map-menu-tip").removeClass("material-tip-active"),E&&(window.clearTimeout(E),E=null),$("#map-tip").removeClass("material-tip-active"),S&&(window.clearTimeout(S),S=null),$("#sim-menu-tip").removeClass("material-tip-active"),A&&(window.clearTimeout(A),A=null),$("#sim-tip").removeClass("material-tip-active"),S&&(window.clearTimeout(P),P=null)}),this.killAllTips=function(){this.killPageSpecificTips(),$("#eclipse-tip").removeClass("material-tip-active"),C&&(window.clearTimeout(C),C=null),$("#location-tip").removeClass("material-tip-active"),v&&(window.clearTimeout(v),v=null),$("#location-tip2").removeClass("material-tip-active"),L&&(window.clearTimeout(L),L=null),$("#time-tip").removeClass("material-tip-active"),window.clearTimeout(M),M=null},this.resetTips=function(){this.killAllTips(),window.localStorage.removeItem(O.ECLIPSE_TIP),u=!1,window.localStorage.removeItem(O.LONG_PRESS_TIP),h=!1,window.localStorage.removeItem(O.LOCATION_TIP),m=!1,d=!1,window.localStorage.removeItem(O.MAP_TIP),p=!1,g=!1,window.localStorage.removeItem(O.SIM_TIP),f=!1,w=!1,window.localStorage.removeItem(O.TIME_TIP),b=!1}}}class R{constructor(){function t(){return window.setInterval(()=>{$t.getCurrentPageIndex()!==ht&&(ea.isAnimating()?ea.isRealTime()&&(console.log("Checking if eclipse has stopped."),Se(!0)||nt()):(console.log("Checking if eclipse has started."),Se(!1)))},Dt)}function i(){window.setTimeout(()=>{fn=!0},500)}function s(){return $(window).height()}function a(){return $(window).width()}function o(){var e=$t.getHeaderHeight(),t=$t.getFooterHeight();return s()-e-t}function l(){vi.css("flex-direction","row"),Nn.css("flex","1"),In.css("flex","1"),Hn.css("top","1.5em"),Bn.addClass("eclipse-time-block-shift")}function m(){vi.css("flex-direction",""),Nn.css("flex",""),In.css("flex",""),Hn.css("top",""),Bn.removeClass("eclipse-time-block-shift")}function d(){var e=o(),t=s(),i=a();vi.height(e),vi.css("min-height",e+"px"),T(e),$t.getCurrentPageIndex()===ht&&i>t&&t<500?l():m(),cn.is(":checked")&&$t.getCurrentPageIndex()===mt?(ri=.2,G()):(ri=1,Ci.height(e),Ut.updateSize()),console.log("Updated content sizes.")}function p(){if(window.localStorage.getItem(O.EVENT_WARNING))ut();else{window.localStorage.setItem(O.EVENT_WARNING,"true");var e=new h("New!","Eclipse Explorer now includes audio cues for eclipse events. Audio cues, event clocks, countdowns, animations, simulations, etc. are NEVER to be used as an indication it is safe to remove eye protection. This app estimates eclipse events and may include innaccuaricies due to various phenomenon.");e.hideCloseButton(),$t.hideSpinner(),e.setOKCallBack(()=>{ut()}),e.showModal()}}function g(){if(window.localStorage.getItem(O.RUN_BEFORE))p();else{window.localStorage.setItem(O.RUN_BEFORE,"true");var e=new h("Welcome!","Welcome to the Eclipse Explorer App, may your skies be clear! Never look at the Sun, eclipsed or not, without proper and certified eye protection. ");e.hideCloseButton(),$t.hideSpinner(),e.setOKCallBack(()=>{var e=new h("Location Information Request","This app requires the use of location information, please enable this feature when prompted.");e.hideCloseButton(),e.setOKCallBack(()=>{p()}),e.showModal()}),e.showModal()}}function f(){Ut.getZoom()>=Ut.getMaxZoom()?Oi.prop("disabled",!0):Oi.prop("disabled",!1),Ut.getZoom()<=Ut.getMinZoom()?Ni.prop("disabled",!0):Ni.prop("disabled",!1)}function w(){Tn.hasClass("eclipse-realtime-shadow-trans")||Tn.addClass("eclipse-realtime-shadow-trans")}function b(){Tn.removeClass("eclipse-realtime-shadow-trans")}function v(){console.log("Page change to map."),$t.disableYScroll(),Ut.updateSize(),Ut.isMapOnline()&&(yn.show(),Z()),Xi.show(),Se()&&w(),cn.is(":checked")&&G(),Ys||(Ys=t()),Ti.hasClass("eclipse-sun-corona")&&(Ti.removeClass("eclipse-sun-corona"),Ti.addClass("eclipse-sun-corona-map"))}function L(){return yn.width()/$(document).width()>.6}function T(e){var t=$(document).width();Ti.height(e),e<t&&(t=e),Si.width("100%"),Si.height("100%"),Ei.width(.5*t),Ei.height(.5*t)}function E(){xt=Intl.DateTimeFormat().resolvedOptions().timeZone}function S(){rn.hide(),ln.hide(),tn.show(),sn.show(),on.show()}function A(){nn.show(),an.show()}function P(){nn.hide(),an.hide()}function M(){ln.show(),rn.show(),tn.hide(),sn.hide(),on.hide(),P()}function y(){ea.isAnimating()||(ei?(S(),N()):Pe())}function N(){if($t.getPageIndex()===dt)if(Qt)switch(A(),_t){case Lt:_e();break;case Tt:Me();break;case Et:ye();break;case St:ke();break;case At:De();break;default:goMidConactPoint()}else switch(P(),_t){case Lt:_e();break;case Tt:Me();break;case At:De();break;default:_e()}else M()}function R(){Ut.setOfflineMap(),j(),mt===$t.getCurrentPageIndex()&&yn.hide(),Ri.hasClass("eclipse-offline-button-placement-transition")||Ri.addClass("eclipse-offline-button-placement-transition"),Ke("Connection lost. Going to offline mode.")}function H(){Ut.setOnlineMap(),Z(),mt===$t.getCurrentPageIndex()&&yn.show(),Ri.removeClass("eclipse-offline-button-placement-transition")}function z(){Os.removeClass("eclipse-card-text-show"),Is.removeClass("eclipse-card-text-show"),$s.removeClass("eclipse-card-text-show")}function G(){var e=a(),t=o(),i=t,n=s(),r=t,l=!1;console.log("Map extras shown."),yt.showLongPressTip(),Fi.hasClass("eclipse-show-circumstances-vertical")||Fi.hasClass("eclipse-show-circumstances-horizontal")||Fi.hasClass("eclipse-show-circumstances-vertical-clean")||Wi.css("visibility","hidden"),n>e?(l=!0,$t.isHeaderFooterShown()?(Fi.removeClass("eclipse-show-circumstances-vertical-clean"),Fi.addClass("eclipse-show-circumstances-vertical"),i*=.75):(Fi.removeClass("eclipse-show-circumstances-vertical"),Fi.addClass("eclipse-show-circumstances-vertical-clean"),i*=.6),Fi.removeClass("eclipse-show-circumstances-horizontal"),Ci.removeClass("eclipse-map-circumstances-horizontal"),vi.height(i),vi.css("min-height",i+"px"),Ti.removeClass("eclipse-simulation-map-show-horizontal"),Ti.removeClass("eclipse-simulation-map-show-horizontal-tablet"),Ti.addClass("eclipse-simulation-map-show"),bn.css("left",""),Tn.css("left",""),Tn.css("transform","")):(Fi.addClass("eclipse-show-circumstances-horizontal"),Fi.removeClass("eclipse-show-circumstances-vertical"),Fi.removeClass("eclipse-show-circumstances-vertical-clean"),Ci.addClass("eclipse-map-circumstances-horizontal"),vi.height("calc("+i+"px + 5em)"),vi.css("min-height","calc("+i+"px + 5em)"),Ti.removeClass("eclipse-simulation-map-show"),e<1024?(Ti.removeClass("eclipse-simulation-map-show-horizontal-tablet"),Ti.addClass("eclipse-simulation-map-show-horizontal")):(Ti.removeClass("eclipse-simulation-map-show-horizontal"),Ti.addClass("eclipse-simulation-map-show-horizontal-tablet"))),Wi.addClass("eclipse-move-eclipse-type"),Fn.hide(),Wn.hide();var c=0;Un.is(":visible")?(c=Un.offset().top,Wi.css("float",""),Wi.css("transform","")):(c=Wi.offset().top,Wi.css("float","none"),Wi.css("transform","translateX(0)")),l?(r=c-$t.getHeaderHeight()-6,xi.css("bottom","calc("+(n-r)+"px - 2em)")):(r=t,xi.css("bottom","5em")),Ci.height(r),Ut.updateSize(),Ei.css("box-shadow","4px 4px 4px 4px #888888"),at(),Fi.transitionEndOff(),Fi.transitionEndOne(()=>{var e=0,i=0;if(Un.is(":visible")?(e=Un.offset().top,Wi.css("float",""),Wi.css("transform","")):(e=Wi.offset().top,Wi.css("float","none"),Wi.css("transform","translateX(0)")),i=e-24,l)Cn.css("top","calc("+i+"px - 1.2em"),bn.css("top","calc("+i+"px - 1.2em"),r=e-$t.getHeaderHeight()-6,xi.css("bottom","calc("+(n-r)+"px - 2em)");else{var s=Un.width();0===s&&(s=Wi.width()),Cn.css("top",""),bn.css("top",""),bn.css("left","calc("+s+"px + 3em"),r=t,xi.css("bottom","5em"),Tn.css("left","calc("+s+"px + 25%"),Tn.css("transform","translateX(0%)")}Ci.height(r),Ut.updateSize(),Wi.css("visibility",""),console.log("Delayed map resize: "+r)})}function F(){Fi.removeClass("eclipse-show-circumstances-vertical"),Fi.removeClass("eclipse-show-circumstances-vertical-clean"),Fi.removeClass("eclipse-show-circumstances-horizontal"),Ci.removeClass("eclipse-map-circumstances-horizontal"),Wi.removeClass("eclipse-move-eclipse-type"),Ti.removeClass("eclipse-simulation-map-show"),Ti.removeClass("eclipse-simulation-map-show-horizontal"),Ti.removeClass("eclipse-simulation-map-show-horizontal-tablet"),Cn.css("top",""),bn.css("top",""),bn.css("left",""),Tn.css("left",""),Tn.css("transform",""),Wi.css("float",""),Wi.css("transform",""),Fn.show(),Wn.show(),Ei.css("box-shadow","")}function W(){zi.removeClass("material-other-page-show"),zi.transitionEndOne(()=>{zi.height("0"),z()})}function J(){"undefined"!=typeof cordova&&$(document).off("backbutton")}function j(){un.hide(),mn.hide(),pn.hide()}function Z(){un.show(),mn.show(),pn.show(),q()}function q(){hn.is(":checked")?Ut.wxRadarOn():Ut.wxRadarOff(),dn.is(":checked")?Ut.wxVisSatOn():Ut.wxVisSatOff(),gn.is(":checked")?Ut.wxIRSatOn():Ut.wxIRSatOff()}function V(e){return(e>360||e<0)&&(e-=360*Math.floor(e/360)),e>180&&(e-=360),e}function K(e){return e>90?e=90-(e-90):e<-90&&(e=-90+(e+90)),e}function Y(){vt&&window.clearTimeout(vt),vt=window.setTimeout(()=>{vt=null,ji.removeClass("is-active"),Zi.removeClass("is-active"),qi.removeClass("is-active"),Vi.removeClass("is-active"),Ki.removeClass("is-active"),Yi.removeClass("is-active")},Ct)}function X(){Pn.clickOff(),Je(!1),Ut.clickOff(),pi=!0,Pn.css("color","cyan"),console.log("Location frozen."),Ke("Location freeze.")}function Q(){We(),pi=!1,Pn.click(te),Pn.css("color",""),console.log("Location selectable."),Ke("Location unfrozen.")}function ee(){function t(){o=parseFloat(i.val()),r=parseFloat(n.val()),l=parseFloat(s.val()),c=!1,console.log("checking input"),Number.isNaN(o)?c=!1:o<=90&&o>=-90?o!==Jt.latitude&&(c=!0):c=!1,Number.isNaN(r)?c=!1:r<=180&&r>=-180?r!==Jt.longitude&&(c=!0):c=!1,Number.isNaN(l)?c=!1:l<=5e4&&l>=-2e3?l!==Jt.altitude&&(c=!0):c=!1,c?(a.removeAttr("disabled"),si=new e(o,r,l)):(si=null,a.attr("disabled","true"))}console.log("Location bar click.");var i=$("#lat-input"),n=$("#long-input"),s=$("#alt-input"),a=$("#loc-ok-button"),o=0,r=0,l=0,c=!1;i.longPressOff(),n.longPressOff(),s.longPressOff(),i.longPress(()=>{i.val(""),t()}),n.longPress(()=>{n.val(""),t()}),s.longPress(()=>{s.val("0"),t()}),i.val(Jt.latitude),n.val(Jt.longitude),s.val(Jt.altitude),i.on("input",t),s.on("input",t),n.on("input",t),t(),bi.showModal()}function te(){Je(Ft.isOn()?!1:!0)}function ie(){console.log("Binding Eclipse UI events."),window.setInterval(E,3e4),_s.click(z),ks.click(z),$("#loc-ok-button").click(()=>{si&&(X(),ze(si)),bi.close()}),$("#loc-close-button").click(()=>{bi.close()}),$("#lat-button").click(ee),$("#long-button").click(ee),$("#alt-button").click(ee),$("#coverage-header").click(Y),$("#mag-header").click(Y),$("#distance-header").click(Y),$("#depth-header").click(Y),$("#duration-tip").click(Y),$("#total-duration-tip").click(Y),$("#replay-hints").click(()=>{console.log("Replaying hints."),window.setTimeout(()=>{$t.toggleDrawer()},400),yt.resetTips(),yt.showEclipseTip(),yt.showLocationTips(),$t.getCurrentPageIndex()===ht?yt.showLongPressTip():$t.getCurrentPageIndex()===mt?(yt.showMapMenuTip(),cn.is(":checked")&&yt.showLongPressTip()):yt.showSimMenuTip()}),Hi.click(()=>{Hi.is(":checked")?(Mt.on(),window.localStorage.setItem(O.AUDIO_ON,!0),Mt.playCueBeeps(),console.log("Audio on.")):(Mt.off(),window.localStorage.setItem(O.AUDIO_ON,!1),console.log("Audio off."))}),hn.click(function(){console.log("Radar click"),$(this).is(":checked")?(console.log("Showing Wx Radar."),window.localStorage.setItem(O.SHOW_RADAR,!0),Ut.wxRadarOn()):(window.localStorage.setItem(O.SHOW_RADAR,!1),Ut.wxRadarOff())}),dn.click(function(){console.log("Sat Vis click"),$(this).is(":checked")?(console.log("Showing Sat Vis."),window.localStorage.setItem(O.SHOW_VIS,!0),Ut.wxVisSatOn()):(window.localStorage.setItem(O.SHOW_VIS,!1),Ut.wxVisSatOff())}),gn.click(function(){console.log("Sat IR click."),$(this).is(":checked")?(console.log("Showing Sat IR."),window.localStorage.setItem(O.SHOW_IR,!0),Ut.wxIRSatOn()):(window.localStorage.setItem(O.SHOW_IR,!1),Ut.wxIRSatOff())}),cn.click(function(){$(this).is(":checked")?(console.log("Box is checked."),window.localStorage.setItem(O.SHOW_EXTRAS,!0)):(window.localStorage.setItem(O.SHOW_EXTRAS,!1),console.log("Box is not checked."),F(),xi.css("bottom",""),ri=1),d()}),Ds.click(()=>{$s.removeClass("eclipse-card-text-show"),Is.removeClass("eclipse-card-text-show"),Os.hasClass("eclipse-card-text-show")?Os.removeClass("eclipse-card-text-show"):Os.addClass("eclipse-card-text-show")}),Ns.click(()=>{Os.removeClass("eclipse-card-text-show"),$s.removeClass("eclipse-card-text-show"),Is.hasClass("eclipse-card-text-show")?Is.removeClass("eclipse-card-text-show"):Is.addClass("eclipse-card-text-show")}),xs.click(()=>{Os.removeClass("eclipse-card-text-show"),Is.removeClass("eclipse-card-text-show"),$s.hasClass("eclipse-card-text-show")?$s.removeClass("eclipse-card-text-show"):$s.addClass("eclipse-card-text-show")}),Bi.click(()=>{zi.height("100vh"),zi.addClass("material-other-page-show"),"undefined"!=typeof cordova&&$(document).one("backbutton",e=>($(window).off("keydown"),e.preventDefault(),e.stopPropagation(),W(),!1)),$(window).one("keydown",e=>{if(27===e.which)return e.preventDefault(),e.stopPropagation(),J(),W(),!1})}),Gi.click(()=>{$(window).off("keydown"),J(),W()}),rn.click(()=>{wn?(wn=!1,rn.html("3D Globe (Experimental)"),Ut.disableGlobe()):(wn=!0,rn.html("2D Map"),Ut.enableGlobe())}),Ri.click(()=>{console.log("Attempt to restart online map."),di=!0,H(),window.setTimeout(()=>{di=!1},500)}),Ut.onTileLoadError(()=>{!di&&Ut.isMapOnline()&&(di=!0,console.log("Map possibly gone offline."),R(),window.setTimeout(()=>{di=!1},1e3))}),$t.onBeforePageChange(e=>{console.log("Before page change.")}),$t.onPageChange(e=>{console.log("Page change fired."),yt.killPageSpecificTips(),F(),M(),j(),Xi.hide(),yn.hide(),$t.enableYScroll(),d(),console.log("Removing contact point."),Sn.css("visibility","hidden"),window.localStorage.setItem(O.OPEN_PAGE,e.currentPageIdx),mt===e.currentPageIdx?(console.log("Map page displayed."),v(),yt.showMapMenuTip()):dt===e.currentPageIdx?(console.log("Simulation page displayed."),$t.disableYScroll(),Xi.show(),y(),at(),Se(!1)||Sn.css("visibility",""),yt.showSimMenuTip(),Ti.hasClass("eclipse-sun-corona-map")&&(Ti.removeClass("eclipse-sun-corona-map"),Ti.addClass("eclipse-sun-corona"))):(b(),console.log("Circumstances page displayed."),nt(),yt.showLongPressTip())}),tn.click(()=>{fn&&(fn=!1,nt(),Me(),i())}),nn.click(()=>{fn&&(fn=!1,nt(),ye(),i())}),sn.click(()=>{fn&&(fn=!1,nt(),_e(),i())}),an.click(()=>{fn&&(fn=!1,nt(),ke(),i())}),on.click(()=>{fn&&(fn=!1,nt(),De(),i())}),Qs.onmessage=de,Ft.setPositionCall(He),Ft.setErrorCall(je),Pn.click(te),Ci.longPress(be),window.oncontextmenu=(e=>(e.preventDefault(),e.stopPropagation(),!1)),en.click(e=>{fn&&(fn=!1,An.transitionEndOne(e=>{it()}),i())}),$t.onHeaderChange(e=>{console.log("Header change."),d()}),$t.onWindowResize(e=>{console.log("UI: Window height change."),d(),at(),_n.is(":focus")?L()?(Pi.hasClass("eclipse-hide-header-text")||Pi.addClass("eclipse-hide-header-text"),Mi.hasClass("eclipse-hide-header-text")||Mi.addClass("eclipse-hide-header-text"),$t.isDrawerButtonSpun()||$t.spinBackDrawerButton(),On.parent("label").hide()):(Pi.removeClass("eclipse-hide-header-text"),Mi.removeClass("eclipse-hide-header-text"),On.parent("label").show(),$t.unSpinDrawerButton()):(Pi.removeClass("eclipse-hide-header-text"),Mi.removeClass("eclipse-hide-header-text"),$t.unSpinDrawerButton(),On.parent("label").show())}),$t.onDrawerOpen(e=>{console.log("Drawer opened."),qe($(Ai.children("li")[li]))}),$t.onDrawerClosed(e=>{console.log("Drawer closed.")}),yi.click(e=>{he()}),Ui.click(e=>{0!==Zt&&(Zt=0,window.localStorage.setItem(O.DATE_OFFSET,Zt),Mt.reset(),Ms.removeClass("eclipse-time-travel-font"),Ke("Returning to present time!"),nt()),Se(),Ys||(Ys=t())}),ws.longPress(e=>{Xt&&(Zt=0,nt(),Zt=Xt.getTime()-((new Date).getTime()+qt)-bt,window.localStorage.setItem(O.DATE_OFFSET,Zt),Ms.addClass("eclipse-time-travel-font"),$t.changePage(1),Mt.reset(),Ke("Time traveling to partial eclipse begins!"),Se(),yt.showTimeTip(),Ys||(Ys=t()))}),bs.longPress(e=>{Qt&&(Zt=0,nt(),Zt=Qt.getTime()-((new Date).getTime()+qt)-bt-5e4,window.localStorage.setItem(O.DATE_OFFSET,Zt),Ms.addClass("eclipse-time-travel-font"),$t.changePage(1),Mt.reset(),Ke("Time traveling to "+Ht.type+" eclipse begins!"),Se(),yt.showTimeTip(),Ys||(Ys=t()))}),Cs.longPress(e=>{ei&&(Zt=0,nt(),Zt=ei.getTime()-((new Date).getTime()+qt)-bt,window.localStorage.setItem(O.DATE_OFFSET,Zt),Ms.addClass("eclipse-time-travel-font"),$t.changePage(1),Mt.reset(),Ke("Time traveling to mid eclipse!"),Se(),yt.showTimeTip(),Ys||(Ys=t()))}),vs.longPress(e=>{ti&&(Zt=0,nt(),Zt=ti.getTime()-((new Date).getTime()+qt)-bt,window.localStorage.setItem(O.DATE_OFFSET,Zt),Ms.addClass("eclipse-time-travel-font"),$t.changePage(1),Mt.reset(),Ke("Time traveling to "+Ht.type+" eclipse ends!"),Se(),yt.showTimeTip(),Ys||(Ys=t()))}),Ls.longPress(e=>{ii&&(Zt=0,nt(),Zt=ii.getTime()-((new Date).getTime()+qt)-bt,window.localStorage.setItem(O.DATE_OFFSET,Zt),Ms.addClass("eclipse-time-travel-font"),$t.changePage(1),Mt.reset(),Ke("Time traveling to end of eclipse!"),Se(),yt.showTimeTip(),Ys||(Ys=t()))}),_i.click(e=>{le()}),Di.click(e=>{se()}),Oi.click(e=>{console.log("Zoom in button click."),Ut.zoomIn()}),Ni.click(e=>{Ut.zoomOut()}),Ut.onDragStart(e=>{mi||(mi=!0,window.setTimeout(()=>{mi=!1},4e3))}),Ut.onDragEnd(e=>{ae(),mi=!1,window.localStorage.setItem(O.MAP_CENTER,JSON.stringify(Ut.getCenter()))}),Ci.keydown(e=>{e.keyCode<=40&&e.keyCode>=37&&(ae(),console.log("Map arrow key event."))}),Ut.onZoomEnd(e=>{var t=Ut.getZoom();f(),hi&&Ut.setCenter(Jt),wi||(wi=window.setTimeout(()=>{wi=null,window.localStorage.setItem(O.MAP_ZOOM,t)},250))}),Ut.onRedrawCall(e=>{Rs&&Rs.reDraw(),Us&&Us.reDraw(),Bs&&Bs.reDraw(),Hs&&Hs.reDraw(),zs&&zs.reDraw(),Gs&&Gs.reDraw(),Fs&&Fs.reDraw(),Js&&Js.reDraw(),Ws&&Ws.reDraw();for(var t=0;t<js.length;t++)js[t].reDraw()}),$t.onMDLComplete(()=>{console.log("MDL Complete callback."),$t.toggleHeaderFooter(!0),g()}),_n.focus(t=>{bn.hide(),Cn.hide(),Tn.hide(),L()&&(Pi.addClass("eclipse-hide-header-text"),Mi.addClass("eclipse-hide-header-text"),$t.spinBackDrawerButton(),On.parent("label").hide()),zt=null,kn.addClass("eclipse-map-search-list-show"),_n.val(""),ne(),"undefined"!=typeof cordova&&$(document).one("backbutton",e=>($(window).off("keydown"),e.preventDefault(),e.stopPropagation(),_n.blur(),Ci.focus(),!1)),$(window).on("keydown",t=>{if(console.log("KEY: "+t.which),27===t.which)return $(window).off("keydown"),J(),t.preventDefault(),t.stopPropagation(),_n.blur(),Ci.focus(),!1;if(13===t.which||14===t.which){if($(window).off("keydown"),J(),t.preventDefault(),t.stopPropagation(),zt){if(zt.length>0){var i=new e(parseFloat(zt[0].lat),parseFloat(zt[0].lon));i.altitude=1,X(),oe(),window.setTimeout(()=>{ze(i),Ft.getOnlineElevation(i,e=>{console.log("Updating position with elevation data."),ze(e)}),zt=null},400)}}else Ke("No valid location selected.");return _n.blur(),Ci.focus(),!1}})}),_n.focusout(e=>{$(window).off("keydown"),J(),bn.show(),Cn.show(),Tn.show(),_n.val(""),yn.removeClass("is-dirty"),kn.removeClass("eclipse-map-search-list-show"),Pi.removeClass("eclipse-hide-header-text"),Mi.removeClass("eclipse-hide-header-text"),$t.unSpinDrawerButton(),On.parent("label").show()}),Dn.click(function(t){if(console.log("Map search click fired."),zt){var i=$(this).index();if(i<zt.length){console.log("Item: "+i);var n=new e(parseFloat(zt[i].lat),parseFloat(zt[i].lon));n.altitude=1,X(),oe(),window.setTimeout(()=>{ze(n),Ft.getOnlineElevation(n,e=>{console.log("Updating position with elevation data."),ze(e)}),zt=null},400)}}else Ke("No valid location selected.")}),_n.on("input",e=>{var t=encodeURIComponent(_n.val());console.log("Search box value: "+t);var i="https://nominatim.openstreetmap.org/search?q=QUERY&format=json&limit=3";i=i.replace("QUERY",t),$.getJSON(i,()=>{console.log("Initial JSON success.")}).done(e=>{zt=e,Dn.eq(0).removeClass("eclipse-disabled-text");for(var t=0;t<e.length;t++)Dn.eq(t).children("span").html(e[t].display_name);for(var i=Dn.length;i>e.length&&i>0;i--)Dn.eq(i-1).children("span").html("");console.log("Second JSON success.")}).fail(()=>{console.log("JSON error.")}).always(()=>{console.log("JSON complete.")})})}function ne(){Dn.eq(0).addClass("eclipse-disabled-text"),Dn.eq(0).children("span").html("Searching locations...");for(var e=1;e<Dn.length;e++)Dn.eq(e).children("span").html("")}function se(){hi?ae():oe()}function ae(){hi=!1,window.localStorage.setItem(O.MAP_LOCEKD,hi),Di.children("i").html("location_searching")}function oe(){Di.children("i").html("my_location"),hi=!0,window.localStorage.setItem(O.MAP_LOCEKD,hi),Ut.setCenter(Jt)}function re(){Ai.children("li").click(function(e){ce(parseInt($(this).attr("eclipse-index"),10)),$t.toggleDrawer(),console.log("Selected eclipse: "+li)})}function le(){ci>-1&&ce(ci)}function ce(e){if(e!==li){ge(),en.hide(),Qi.clickOff(),Qi.attr("disabled",!0),li>-1&&($(Ai.children("li")[li]).removeClass("eclipse-selected"),Ht&&Ht.destroy()),li=e,(Ht=Rt.getEclipse(li)).destroy();var t=JSON.stringify(Ht);window.localStorage.setItem(O.ECLIPSE_IDX,li),window.localStorage.setItem(O.ECLIPSE_DATA,t),nt(),ea.reset(),we(),Qs.postMessage({cmd:"eclipse",eclipse:t}),Wt=!0,console.time("DrawLines"),ta.updateLines(t),Ve(Ht),Mt.reset()}var i=$(Ai.children("li")[li]);i.addClass("eclipse-selected"),qe(i)}function ue(e){Qs.postMessage({cmd:"eclipse",eclipse:e}),console.time("DrawLines"),ta.updateLines(e),Ve(Ht)}function he(){ce(Rt.getNextEclipseIdx()),console.log("Found next eclipse: "+li)}function me(e){console.log("Spawning eclipse loader thread."),e&&$t.showSpinner(),null===Bt&&((Bt=new Worker("workers/EclipseLoader.js")).onmessage=Ie)}function de(e){var t=e.data;switch(t.cmd){case"eclipse_stats_update":Le(t);break;case"visible_index_update":Ce(t);break;case"central_coords_data":ve(t);break;default:console.log("Unknow calculate message command.")}}function pe(){Vn.removeClass("eclipse-no-show")}function ge(){Vn.hasClass("eclipse-no-show")||Vn.addClass("eclipse-no-show")}function fe(){var e=Ht.getNorthUmbraLine(),t=Ht.getSouthUmbraLine(),i=Ht.getNorthPenumbraLine(),n=Ht.getSouthPenumbraLine(),s=Ht.getEastLimitLine(),a=Ht.getWestLimitLine(),o=null,r={stroke_color:"red"};e&&t&&(Ws=Ut.addGreatCircle(e[0],t[0],r),Js=Ut.addGreatCircle(e[e.length-1],t[t.length-1],r)),n&&a&&(o=Ut.addGreatCircle(a[0],n[0],r))&&js.push(o),n&&s&&(o=Ut.addGreatCircle(n[n.length-1],s[0],r))&&js.push(o),s&&i&&(o=Ut.addGreatCircle(s[s.length-1],i[i.length-1],r))&&js.push(o),i&&a&&(o=Ut.addGreatCircle(i[0],a[a.length-1],r))&&js.push(o),!i&&a&&s&&(o=Ut.addGreatCircle(a[a.length-1],s[s.length-1],r))&&js.push(o),!n&&a&&s&&(o=Ut.addGreatCircle(a[0],s[0],r))&&js.push(o)}function we(){Rs=Ut.removeFeature(Rs),Us=Ut.removeFeature(Us),Bs=Ut.removeFeature(Bs),Hs=Ut.removeFeature(Hs),zs=Ut.removeFeature(zs),Gs=Ut.removeFeature(Gs),Fs=Ut.removeFeature(Fs),Ws=Ut.removeFeature(Ws),Js=Ut.removeFeature(Js);for(var e=0;e<js.length;e++)Ut.removeFeature(js[e]);js.length=0,console.log("Eclipse lines removed.")}function be(){console.log("Toggle click fired."),ui=!0,window.setTimeout(()=>{ui=!1},2e3),$t.toggleHeaderFooter()?(Li.removeClass("eclipse-main-expand"),Ii.removeClass("eclipse-section-expand"),xi.addClass("eclipse-map-button-placement-transition"),$i.addClass("eclipse-zoom-button-placement-transition"),Ti.css("top",""),bn.css("bottom",""),Cn.css("bottom",""),Tn.css("top",""),cn.is(":checked")&&G()):(Li.addClass("eclipse-main-expand"),xi.removeClass("eclipse-map-button-placement-transition"),$i.removeClass("eclipse-zoom-button-placement-transition"),Ii.addClass("eclipse-section-expand"),cn.is(":checked")&&G(),Ti.css("top","calc(0px - 90vh)"),bn.css("bottom","0.2em"),Cn.css("bottom","0.25em"),Tn.css("top","1em"))}function Ce(e){ni=JSON.parse(e.visible_array),ci=parseInt(e.next_visible,10),xn&&Re()}function ve(e){var t=Ee(new r(JSON.parse(e.eclipse_stats)));fs.html(t.toTimeString())}function Le(e){var t=new r(JSON.parse(e.eclipse_stats));qt=Ft.getGPSTimeCorrect();var i=new Date;if(i.setTime(i.getTime()+Zt+qt),t.isVisible){Pt=!0;var n={year:"numeric",month:"long",day:"numeric"};Xt=Ht.toDate(t.circDates.getC1Date()),ei=Ht.toDate(t.circDates.getMidDate()),ii=Ht.toDate(t.circDates.getC4Date());var s={};It&&("Etc"===It.substr(0,3)&&(It="UTC"),s={timeZone:It,timeZoneName:"short"});var a=parseFloat(e.solar_elevation),o="",l="";null===JSON.parse(e.sunrise)?(Kt=null,o=a>=0?"Sun is Up":"Sun is Down"):o=(Kt=new Date(JSON.parse(e.sunrise))).toLocaleTimeString(gt,s),null===JSON.parse(e.sunset)?(Yt=null,l=a>=0?"Sun is Up":"Sun is Down"):l=(Yt=new Date(JSON.parse(e.sunset))).toLocaleTimeString(gt,s),$n.html(o),Rn.html(l),Un.show(0),Bn.show(0),Hn.show(0),zn.hide(0),Gn.css({background:"url('"+kt+t.eclipseType.toLowerCase()+".png')","background-size":"contain"}),Fn.html(t.eclipseType+" Eclipse Occurs"),Wn.html(ei.toLocaleDateString(gt,n)),Jn.html(t.coverage.toFixed(1)+"%"),jn.html(t.magnitude.toFixed(1)+"%"),Yn.html(Xt.toLocaleTimeString(gt,s)),Qn.html(ei.toLocaleTimeString(gt,s)),ts.html(ii.toLocaleTimeString(gt,s));var c=Te(t,Kt,Yt);if(ps.html(c.toTimeString()),t.firstContactBelowHorizon?is.show(0):is.hide(0),t.midEclipseBelowHorizon?ss.show(0):ss.hide(0),t.fourthContactBelowHorizon?os.show(0):os.hide(0),"Annular"===t.eclipseType||"Total"===t.eclipseType){gi="Total"===t.eclipseType,Qt=Ht.toDate(t.circDates.getC2Date()),ti=Ht.toDate(t.circDates.getC3Date());var u=t.depth.toFixed(1)+"%";t.northOfCenter?u+=" N":u+=" S",bs.show(0),vs.show(0),Zn.show(0),qn.show(0),Zn.html(u),Ts.html(t.eclipseType+" Phase Begins"),Es.html(t.eclipseType+" Phase Ends"),Xn.html(Qt.toLocaleTimeString(gt,s)),es.html(ti.toLocaleTimeString(gt,s));var h=Ee(t,Kt,Yt);gs.html(h.toTimeString()),t.secondContactBelowHorizon?ns.show(0):ns.hide(0),t.thirdContactBelowHorizon?as.show(0):as.hide(0),$t.getPageIndex()===dt?A():P()}else gi=!1,P(),Qt=null,ti=null,cs.html(""),hs.html(""),Zn.hide(0),qn.hide(0),bs.hide(0),vs.hide(0),Mt.restTotal();Oe(),ea.isAnimating()||N(),$t.getPageIndex()===dt&&S()}else Pt=!1;Gt!==t.eclipseType&&(Gt=t.eclipseType,console.log("Eclipse type change."),t.isVisible?ot():(rt(),M(),Pe(),Xt=null,ei=null,ii=null,rs.html(""),ls.html(""),us.html(""),ms.html(""),ds.html(""),Ne(),Mt.reset()),d())}function Te(e,t,i){return e.firstContactBelowHorizon&&e.fourthContactBelowHorizon?new n(t,i):e.firstContactBelowHorizon&&!e.fourthContactBelowHorizon?new n(t,Ht.toDate(e.circDates.getC4Date())):!e.firstContactBelowHorizon&&e.fourthContactBelowHorizon?new n(Ht.toDate(e.circDates.getC1Date()),i):e.c1c4TimeSpan}function Ee(e,t,i){return e.secondContactBelowHorizon&&e.thirdContactBelowHorizon?new n:e.secondContactBelowHorizon&&!e.thirdContactBelowHorizon&&t?new n(t,e.circDates.getC3Date()):!e.secondContactBelowHorizon&&e.thirdContactBelowHorizon&&i?new n(e.circDates.getC2Date(),i):e.c2c3TimeSpan}function Se(e){console.log("Checking if eclipse is occuring.");var i=!1;if(Ht){var n=new Date;n.setTime(n.getTime()+Zt+qt),(i=Ht.isEclipseOccurring(n))&&!ea.isAnimating()?(en.show(),e||ea.isAnimating()||(it(),Ys||(Ys=t()))):(e||ea.isAnimating()||nt(),en.hide(),i?$t.getPageIndex()===dt&&(w(),Xe()):(b(),_e()))}return i}function Ae(){Sn.removeClass("eclipse-sim-info-trans")}function Pe(){M(),Sn.hasClass("eclipse-sim-info-trans")||Sn.addClass("eclipse-sim-info-trans"),Sn.children("span").html("Eclipse Not Visible"),rt()}function Me(){_t=Tt,Ti.removeClass("eclipse-sun-corona"),Ti.removeClass("eclipse-sun-corona-map"),Xt&&(ea.getMoonPosition(Xt,Jt,st),Sn.hasClass("eclipse-sim-info-trans")||Sn.addClass("eclipse-sim-info-trans"),Sn.children("span").html("First Contact"))}function ye(){_t=Et,Ti.removeClass("eclipse-sun-corona"),Qt&&(ea.getMoonPosition(Qt,Jt,st),Sn.hasClass("eclipse-sim-info-trans")||Sn.addClass("eclipse-sim-info-trans"),Sn.children("span").html("Second Contact"),gi&&($t.getCurrentPageIndex()===mt?(Ti.removeClass("eclipse-sun-corona"),Ti.hasClass("eclipse-sun-corona-map")||Ti.addClass("eclipse-sun-corona-map")):(Ti.removeClass("eclipse-sun-corona-map"),Ti.hasClass("eclipse-sun-corona")||Ti.addClass("eclipse-sun-corona"))))}function _e(){console.log("Mid contact point simulation."),_t=Lt,Ti.removeClass("eclipse-sun-corona"),Ti.removeClass("eclipse-sun-corona-map"),ei&&(ea.getMoonPosition(ei,Jt,st),Sn.hasClass("eclipse-sim-info-trans")||Sn.addClass("eclipse-sim-info-trans"),Sn.children("span").html("Mid Eclipse"),gi&&($t.getCurrentPageIndex()===mt?(Ti.removeClass("eclipse-sun-corona"),Ti.hasClass("eclipse-sun-corona-map")||Ti.addClass("eclipse-sun-corona-map")):(Ti.removeClass("eclipse-sun-corona-map"),Ti.hasClass("eclipse-sun-corona")||Ti.addClass("eclipse-sun-corona"))))}function ke(){_t=St,Ti.removeClass("eclipse-sun-corona"),Ti.removeClass("eclipse-sun-corona-map"),Xt&&(ea.getMoonPosition(ti,Jt,st),Sn.hasClass("eclipse-sim-info-trans")||Sn.addClass("eclipse-sim-info-trans"),Sn.children("span").html("Third Contact"),gi&&($t.getCurrentPageIndex()===mt?(Ti.removeClass("eclipse-sun-corona"),Ti.hasClass("eclipse-sun-corona-map")||Ti.addClass("eclipse-sun-corona-map")):(Ti.removeClass("eclipse-sun-corona-map"),Ti.hasClass("eclipse-sun-corona")||Ti.addClass("eclipse-sun-corona"))))}function De(){_t=At,Ti.removeClass("eclipse-sun-corona"),Ti.removeClass("eclipse-sun-corona-map"),ii&&(ea.getMoonPosition(ii,Jt,st),Sn.hasClass("eclipse-sim-info-trans")||Sn.addClass("eclipse-sim-info-trans"),Sn.children("span").html("Fourth Contact"))}function Oe(e){qt=Ft.getGPSTimeCorrect();var t=new Date;t.setTime(t.getTime()+Zt+qt),qt>0?Vt||(Ms.addClass("eclipse-time-gps-font"),Vt=!0):Vt&&(Ms.removeClass("eclipse-time-gps-font"),Vt=!1);var i={timeZone:xt,timeZoneName:"short"};It&&("Etc"===It.substr(0,3)&&(It="UTC"),i={timeZone:It,timeZoneName:"short"});var s="";try{s=(a=t.toLocaleTimeString(gt,i)).slice(-3),a=a.slice(0,-4)}catch(e){var a=t.toLocaleTimeString(gt);s=i.timeZone.slice(4)}Ms.html(a),ys.html(s);var o="--:--:--",r="--:--:--";if(Kt&&(o=new n(Kt,t).toTimeString()),Yt&&(r=new n(Yt,t).toTimeString()),rs.html(o),ds.html(r),Xt){e&&Mt.checkPartialTimers(t,{c1Time:Xt,midTime:ei,c4Time:ii},{c1Cell:ws,midCell:Cs,c4Cell:Ls});var l=new n(Xt,t);ls.html(l.toTimeString())}if(ei){var c=new n(ei,t);us.html(c.toTimeString())}if(ii){var u=new n(ii,t);ms.html(u.toTimeString())}if(Qt){e&&Mt.checkTotalTimers(t,"Total"===Ht.type,{c2Time:Qt,c3Time:ti},{c2Cell:bs,c3Cell:vs});var h=new n(Qt,t);cs.html(h.toTimeString())}if(ti){var m=new n(ti,t);hs.html(m.toTimeString()),ea.isAnimating()&&(!h.checkNegative()&&m.checkNegative()?gi&&($t.getCurrentPageIndex()===mt?(Ti.removeClass("eclipse-sun-corona"),Ti.hasClass("eclipse-sun-corona-map")||Ti.addClass("eclipse-sun-corona-map")):(Ti.removeClass("eclipse-sun-corona-map"),Ti.hasClass("eclipse-sun-corona")||Ti.addClass("eclipse-sun-corona"))):(Ti.removeClass("eclipse-sun-corona"),Ti.removeClass("eclipse-sun-corona-map")))}}function Ne(){Un.hide(0),Bn.hide(0),Hn.hide(0),Fn.html("No Eclipse Occurs"),zn.show(0),Jn.html("0.0%"),jn.html("0.0%"),Zn.hide(0),qn.hide(0),Wn.html(""),Gn.css({background:"url('images/no-eclipse.png')","background-size":"contain"})}function Ie(e){var t=e.data;switch(t.cmd){case"eclipse_load_complete":Ue(t);break;case"eclipse_html_complete":$e(t);break;case"eclipse_load_error":Be(t)}}function xe(){$t.hideSpinner(),Ci.show(),Ti.css("visibility","")}function $e(e){Ai.html(e.eclipse_data),null!==Bt&&(Bt.terminate(),Bt=null,console.log("Terminated eclipse loader thread.")),xe(),xn=$(".visible-class"),console.log("Icon count: "+xn.length),re(),ni&&Re(),void 0===(li=window.localStorage.getItem(O.ECLIPSE_IDX))&&(li=null),Number.isNaN(li)||null===li?(li=-1,he()):ce(li)}function Re(){xn.hide();for(var e=0;e<ni.length;e++)$(xn[ni[e]]).show()}function Ue(e){Rt.copyEclipsesIn(JSON.parse(e.eclipse_data)),Qs.postMessage({cmd:"update_catalog",catalog:Rt.eclipseToJSON()}),console.log("Eclipse UI load complete: "+Rt.getEclipseCount()+" eclipses loaded.")}function Be(e){null!==Bt&&(Bt.terminate(),Bt=null),console.log("Eclipse loader error: "+e.status),$t.hideSpinner()}function He(e){Wt||ze(e)}function ze(e,t){Jt.longitude=V(e.longitude),Jt.latitude=K(e.latitude),Jt.altitude=e.altitude,jt=void 0!==Jt.altitude?Number.isNaN(Jt.altitude)?0:1===Jt.altitude?0:Jt.altitude:0;var i={latitude:Jt.latitude,longitude:Jt.longitude,altitude:jt};if(Ss.html(Jt.latitude.toFixed(2)),As.html(Jt.longitude.toFixed(2)),Ps.html((jt*Ot).toFixed(0)),ea.setCoords(i),Qs.postMessage({cmd:"coords",coords:JSON.stringify(i)}),ia.setLocation(Jt),hi&&!mi&&Ut.setCenter(Jt),Ft.isOn())E(),It&&(It=""),fi||(t||window.localStorage.setItem(O.LAST_POSITION,JSON.stringify(Jt)),fi=window.setInterval(()=>{t||window.localStorage.setItem(O.LAST_POSITION,JSON.stringify(Jt))},1e4));else{t||window.localStorage.setItem(O.LAST_POSITION,JSON.stringify(Jt));try{It=Nt.lookup(Jt.latitude,Jt.longitude),console.log("New timezone: "+It)}catch(e){console.log("Time zone DB not ready... trying again in 1 second."),window.setTimeout(()=>{It=Nt.lookup(Jt.latitude,Jt.longitude),console.log("New timezone: "+It)},1e3)}}Ge(),Fe(),console.log("Position updated!")}function Ge(){if(Pt)if(Xs.distancePosted){Xs.nextUmbraCoords=null;var e=[];if(Us)for(var t=0;t<Us.length;t++)e=e.concat(Us[t].getCoords());if(Bs)for(t=0;t<Bs.length;t++)e=e.concat(Bs[t].getCoords());e.length>0&&(Xs.distancePosted=!1,Xs.postMessage({cmd:"umbra_lines",coord:JSON.stringify(Jt),array:JSON.stringify(e)}))}else Xs.nextUmbraCoords=Jt}function Fe(){if(Pt)if(console.log("Checking total lines"),Xs.totalDistancePosted){Xs.nextTotalCoords=null;var e=[];if(Rs)for(var t=0;t<Rs.length;t++)e=e.concat(Rs[t].getCoords());e.length>0&&(Xs.totalDistancePosted=!1,Xs.postMessage({cmd:"central_line",coord:JSON.stringify(Jt),array:JSON.stringify(e)}))}else Xs.nextTotalCoords=Jt}function We(){Ut.clickOff(),Ut.onClick(e=>{console.log("Map click fired."),mi=!1,ui?(console.log("Map ignoring long click."),ui=!1):(console.log("Clicked at: "+e.latitude+", "+e.longitude),e.altitude=1,ze(e),Ft.getOnlineElevation(Jt,e=>{console.log("Updating position with elevation data."),ze(e)}))})}function Je(e){e?(window.localStorage.setItem(O.GPS_ON,!0),pi=!1,Pn.css("color",""),Ft.isOn()||(Mn.html("location_on"),Pn.css("color","orange"),Ke("Aquiring GPS position..."),console.log("Aquiring GPS position..."),Ut.clickOff(),Ft.onFirstPostion(e=>{Pn.css("color","green"),Ke("GPS Mode On."),console.log("GPS Mode on."),e.altitude||Ft.getOnlineElevation(e,e=>{ze(e)})}),Ft.startWatch())):(Pn.css("color",""),fi&&(window.clearInterval(fi),fi=null),window.localStorage.setItem(O.GPS_ON,!1),Ft.isOn()&&Ft.clearWatch(),We(),Pn.longPressOff(),Pn.longPress(()=>{pi?Q():X(),Pn.blur()}),Mn.html("location_off"),Ke("Position in manual mode."),console.log("Position in manual mode."))}function je(e){Ft.clearWatch(),console.log("Position UI error:"+e.code);var t=new h("Location Error");t.setOKText("Retry"),t.setCloseText("Cancel"),e.code===e.PERMISSION_DENIED?(t.setDescriptionText("This app requires the use of location information, please enable this feature in the app's permission settings. Click Retry to try again. Otherwise click Cancel."),t.setOKCallBack(()=>{Je(!0),Ze()}),t.setCloseCallBack(()=>{Je(!1),Ze()})):e.code===e.POSITION_UNAVAILABLE?(t.setDescriptionText("Location services are unavailable. Press Cancel to run location in manual mode.  Press retry to try again."),t.setOKCallBack(()=>{Je(!0),Ze()}),t.setCloseCallBack(()=>{Je(!1),Ze()})):e.code===e.TIMEOUT&&(t.setDescriptionText("Location services timed out. Press Cancel to run location in manual mode.  Press retry to try again."),t.setOKCallBack(()=>{Je(!0),Ze()}),t.setCloseCallBack(()=>{Je(!1),Ze()})),yt.killAllTips(),$t.hideSpinner(),t.showModal()}function Ze(){yt.showEclipseTip(),yt.showLocationTips(),$t.getCurrentPageIndex()===ht?yt.showLongPressTip():$t.getCurrentPageIndex()===mt?(yt.showMapMenuTip(),cn.is(":checked")&&yt.showLongPressTip()):yt.showSimMenuTip()}function qe(e){var t=e.parent();e[0].scrollIntoView();var i=Math.round(t.scrollTop()),n=t[0].scrollHeight,s=Math.round(t.height()/2),a=n-Math.round(t.height())-Math.round(e.height()),o=Math.round(e.position().top);i<s?t.scrollTop(0):i>s&&i<a?t.scrollTop(i-s):o<s?t.scrollTop(i-s+(i-a)):t.scrollTop(n)}function Ve(e){Pi.html(e.type+" Solar Eclipse"),Mi.html(e.maxEclipseDate.toLocaleDateString(gt,ft))}function Ke(e){try{var t=()=>{ki.classList.remove("mdl-snackbar--active")};ki.MaterialSnackbar.showSnackbar({message:e,timeout:pt,actionText:"Dismiss",actionHandler:t})}catch(t){console.log("Toast: "+e),console.log("Unable to show toast, MDL probably not yet ready.")}}function Ye(){ea.stop()}function Xe(){bn.addClass("eclipse-map-times-local-trans"),Cn.addClass("eclipse-map-times-zulu-trans")}function Qe(){bn.removeClass("eclipse-map-times-local-trans"),Cn.removeClass("eclipse-map-times-zulu-trans")}function et(e){if(It)try{vn.html(e.toLocaleTimeString("en-US",{timeZone:It,timeZoneName:"short"}))}catch(t){vn.html(e.toLocaleTimeString())}else vn.html(e.toLocaleTimeString());var t=e.toLocaleTimeString("en-US",{timeZone:"UTC",timeZoneName:"short"});t=t.replace(" GMT",""),Ln.html(t)}function tt(){Wt=!0,Ae(),ae(),Qi.html("Stop Animation"),et(Ht.getPenumbraStartTime()),Xe(),ea.start(lt,st);var e={latitude:Ht.midEclipsePoint.latitude,longitude:Ht.midEclipsePoint.longitude};e.latitude>45&&(e.latitude=45),e.latitude<-45&&(e.latitude=-45),Ut.setCenter(e),Ut.setZoom(3)}function it(){Ae(),en.hide(),w(),Qi.html("Stop Animation"),et(Ht.getPenumbraStartTime()),Xe();var e=Zt+qt;ea.start(lt,st,{realTime:!0,dateOffset:e}),$t.getPageIndex()===dt&&(Ae(),w())}function nt(){Wt=!1,Se(!0),b(),Qe(),Qi.html("Animate Shadow"),Ye(),qs=Ut.removeFeature(qs),Zs=Ut.removeFeature(Zs),$t.getCurrentPageIndex()===dt&&(y(),Sn.css("visibility","")),console.log("Animation stopped.")}function st(e){ai=e.moon_pos,oi=e.sun_pos,at()}function at(){var e=Ei.width(),t=Ei.offset(),i=e;i=ai.diameter/oi.diameter*100;var n=e/oi.diameter,s=ai.decl-oi.decl,a=ai.ra-oi.ra;t.top=s*n*-1/e*100+"%",t.left=a*n*-1/e*100+"%",Si.width(i+"%"),Si.height(i+"%"),Si.css("top",t.top),Si.css("left",t.left);var o=(100-i)/2+"%";Si.css("transform","translate("+o+", "+o+")")}function ot(){Si.removeClass("eclipse-moon-invisible")}function rt(){Ti.removeClass("eclipse-sun-corona"),Ti.removeClass("eclipse-sun-corona-map"),Si.hasClass("eclipse-moon-invisible")||Si.addClass("eclipse-moon-invisible")}function lt(e){if(null!==e.umb_shadow)if(Zs)if(Zs.setCoordinates(e.umb_shadow),e.umb_speed){var t=parseInt(e.umb_speed);isNaN(t)?(Ji.html(""),En.html("Realtime"),ea.isRealTime()||b()):t>0?(Ji.html("<b>&nbsp;&nbsp;"+t+" MPH</b>"),ea.isRealTime()||(En.html("Shadow speed:"),w())):(Ji.html(""),En.html("Realtime"),ea.isRealTime()||b())}else Ji.html(""),En.html("Realtime"),ea.isRealTime()||b();else Zs=Ut.addPolygon(e.umb_shadow,{fill_color:"rgba(0, 0, 0, 0.75)"});else Zs=Ut.removeFeature(Zs),Vs=null,Ks=null,Ji.html(""),En.html("Realtime"),ea.isRealTime()||b();null!==e.pen_shadow?qs?qs.setCoordinates(e.pen_shadow):qs=Ut.addPolygon(e.pen_shadow,{fill_color:"rgba(0, 0, 0, 0.2)"}):qs=Ut.removeFeature(qs),et(e.date)}function ct(e){if(e){if("string"==typeof e&&"true"===e.toLowerCase())return!0;if("boolean"==typeof e)return e;if("number"==typeof e&&0!==e)return!0}return!1}function ut(){var e=window.localStorage.getItem(O.DATE_OFFSET);null!==e&&(Zt=parseInt(e))>0&&(Ms.addClass("eclipse-time-travel-font"),yt.showTimeTip());var t=window.localStorage.getItem(O.AUDIO_ON),i=!0;null!==t&&(i=ct(t),Hi.prop("checked",i),i?(Mt.on(),Hi.parent().hasClass("is-checked")||Hi.parent().addClass("is-checked")):(Mt.off(),Hi.parent().removeClass("is-checked")));var n=window.localStorage.getItem(O.ECLIPSE_DATA),s=!0;n&&((Ht=new c(JSON.parse(n))).destroy(),ue(n),s=!1,xe()),me(s);var a=JSON.parse(window.localStorage.getItem(O.LAST_POSITION));a&&ze(a);var o=!0,r=window.localStorage.getItem(O.GPS_ON);null!==r&&(o=ct(r)),Je(o);var l=window.localStorage.getItem(O.MAP_LOCEKD);if(null!==l)if(ct(l))oe();else{ae();var u=JSON.parse(window.localStorage.getItem(O.MAP_CENTER));u&&Ut.setCenter(u)}var h=window.localStorage.getItem(O.MAP_ZOOM);if(console.log("GETTING APP ZOOM LEVEL"),null!==h){var m=parseFloat(h);Ut.setZoom(m),m>5&&window.setTimeout(()=>{Ut.isMapOnline()||Ut.setZoom(5)},3e3)}ct(window.localStorage.getItem(O.SHOW_EXTRAS))&&(cn.prop("checked",ln),cn.parent().addClass("is-checked"));var d=ct(window.localStorage.getItem(O.SHOW_RADAR));d&&(hn.prop("checked",d),hn.parent().addClass("is-checked"),Ut.wxRadarOn());var p=ct(window.localStorage.getItem(O.SHOW_VIS));p&&(dn.prop("checked",p),dn.parent().addClass("is-checked"),Ut.wxVisSatOn());var g=ct(window.localStorage.getItem(O.SHOW_IR));g&&(gn.prop("checked",g),gn.parent().addClass("is-checked"),Ut.wxIRSatOn());var f=window.localStorage.getItem(O.OPEN_PAGE);if(null!==f){var w=parseInt(f);0!==w?$t.changePage(w):yt.showLongPressTip()}else yt.showLongPressTip();H(),yt.showEclipseTip(),yt.showLocationTips()}const ht=0,mt=1,dt=2,pt=2e3,gt="en-US",ft={timeZone:"UTC",year:"numeric",month:"long",day:"numeric"},wt={latitude:34,longitude:-118,altitude:0},bt=15e3,Ct=7e3;var vt=null;const Lt=0,Tt=1,Et=2,St=3,At=4;var Pt=!1,Mt=new I,yt=new x,_t=Lt,kt="images/",Dt=12e4,Ot=3.28084,Nt=new C,It="",xt=Intl.DateTimeFormat().resolvedOptions().timeZone,$t=new u,Rt=new _,Ut=new B("map",4,wt),Bt=null,Ht=null,zt=null,Gt="",Ft=new U,Wt=!1,Jt=wt,jt=0,Zt=0,qt=0,Vt=!1,Kt=null,Yt=null,Xt=null,Qt=null,ei=null,ti=null,ii=null,ni=null,si=null,ai=0,oi=0,ri=1,li=-1,ci=-1,ui=!1,hi=!0,mi=!1,di=!1,pi=!1,gi=!1,fi=null,wi=null,bi=document.getElementById("loc-diag");componentHandler.upgradeElement(bi),bi.showModal||dialogPolyfill.registerDialog(bi);var Ci=$("#map"),vi=$("#circumstances"),Li=$("#app-content"),Ti=$("#simulation-tab"),Ei=$("#sun"),Si=$("#moon"),Ai=$("#eclipse_list"),Pi=$("#eclipse-title"),Mi=$("#eclipse-title-date"),yi=$("#next-button"),_i=$("#visible-button"),ki=document.querySelector("#snackbar"),Di=$("#map-location-button"),Oi=$("#map-zoom-in-button"),Ni=$("#map-zoom-out-button"),Ii=$("#map-tab"),xi=$("#map-buttons"),$i=$("#zoom-buttons"),Ri=$("#map-offline-button"),Ui=$("#time-button"),Bi=$("#about-link"),Hi=$("#set-audio"),zi=$("#about-page"),Gi=$("#about-back-button"),Fi=$("#circumstances-tab"),Wi=$("#eclipse-type-header"),Ji=$("#umbra-speed"),ji=$("#coverage-tip"),Zi=$("#mag-tip"),qi=$("#distance-tip"),Vi=$("#depth-tip"),Ki=$("#duration-tip-info"),Yi=$("#total-duration-tip-info"),Xi=$("#map-menu-button"),Qi=$("#animate-shadow"),en=$("#realtime-animate"),tn=$("#first-contact-sim"),nn=$("#second-contact-sim"),sn=$("#mid-eclipse-sim"),an=$("#third-contact-sim"),on=$("#fourth-contact-sim"),rn=$("#globe"),ln=$("#show-extras"),cn=ln.children("label").children("input"),un=$("#show-wx-radar"),hn=un.children("label").children("input"),mn=$("#show-vis-sat"),dn=mn.children("label").children("input"),pn=$("#show-ir-sat"),gn=pn.children("label").children("input"),fn=!0,wn=!1,bn=$("#local-time-pop"),Cn=$("#zulu-time-pop"),vn=$("#local-animate-time"),Ln=$("#zulu-animate-time"),Tn=$("#realtime-shadow"),En=Tn.children("span").first(),Sn=$("#contact-point"),An=$("#map-menu"),Pn=$("#location-icon"),Mn=Pn.children("i"),yn=$("#map-search-box"),_n=$("#map-search-input"),kn=$("#map-search-menu"),Dn=kn.children("li"),On=$("#search-icon"),Nn=$("#top"),In=$("#bottom"),xn=null,$n=$("#sunrise_time"),Rn=$("#sunset_time"),Un=$("#stats_block"),Bn=$("#time_block"),Hn=$("#time_block2"),zn=$("#not_visible"),Gn=$("#eclipse_pic"),Fn=$("#eclipse_type"),Wn=$("#eclipse_date"),Jn=$("#coverage"),jn=$("#magnitude"),Zn=$("#depth"),qn=$("#depth_title"),Vn=$("#distance-header"),Kn=$("#distance"),Yn=$("#c1_time"),Xn=$("#c2_time"),Qn=$("#mid_time"),es=$("#c3_time"),ts=$("#c4_time"),is=$("#c1_horiz"),ns=$("#c2_horiz"),ss=$("#mid_horiz"),as=$("#c3_horiz"),os=$("#c4_horiz"),rs=$("#sunrise_count"),ls=$("#c1_count"),cs=$("#c2_count"),us=$("#mid_count"),hs=$("#c3_count"),ms=$("#c4_count"),ds=$("#sunset_count"),ps=$("#entire_duration"),gs=$("#total_duration"),fs=$("#max_duration"),ws=$("#partial-begins"),bs=$("#total_begins"),Cs=$("#mid-eclipse"),vs=$("#total_ends"),Ls=$("#partial-ends"),Ts=$("#type_div_start"),Es=$("#type_div_ends"),Ss=$("#lat"),As=$("#long"),Ps=$("#alt"),Ms=$("#time"),ys=$("#zone"),_s=$("#help-info"),ks=$("#more-info"),Ds=$("#disclaimer"),Os=$("#disclaimer-text"),Ns=$("#privacy"),Is=$("#privacy-text"),xs=$("#open-source"),$s=$("#open-source-text"),Rs=Ut.addMultiPolyLine(),Us=Ut.addMultiPolyLine(),Bs=Ut.addMultiPolyLine(),Hs=Ut.addMultiPolyLine(),zs=Ut.addMultiPolyLine(),Gs=Ut.addMultiPolyLine(),Fs=Ut.addMultiPolyLine(),Ws=null,Js=null,js=[],Zs=null,qs=null,Vs=null,Ks=null,Ys=t();Oe(),Ss.html(Jt.latitude.toFixed(2)),As.html(Jt.longitude.toFixed(2)),Ps.html((jt*Ot).toFixed(2)),window.setInterval(()=>{Oe(!0)},1e3);var Xs=new Worker("workers/distanceWorker.js");Xs.distancePosted=!0,Xs.totalDistancePosted=!0,Xs.nextUmbraCoords=null,Xs.nextTotalCoords=null;var Qs=new Worker("workers/calculateWorker.js"),ea=new k,ta=new D(function(e){switch(e.type){case"central_line":Rs=Ut.addMultiPolyLine(e.line),Ht.setCentralLine(e.line),Ht.setCentralLineTimes(e.times),Fe(),Rs&&pe();break;case"south_umbra_line":Us=Ut.addMultiPolyLine(e.line),Ht.setSouthUmbraLine(e.line),Ht.setSouthUmbraTimes(e.times),Ge(),Us&&pe();break;case"north_umbra_line":Bs=Ut.addMultiPolyLine(e.line),Ht.setNorthUmbraLine(e.line),Ht.setNorthUmbraTimes(e.times),Ge(),Bs&&pe();break;case"south_penumbra_line":Hs=Ut.addMultiPolyLine(e.line,{stroke_color:"red"}),Ht.setSouthPenumbraLine(e.line);break;case"north_penumbra_line":zs=Ut.addMultiPolyLine(e.line,{stroke_color:"red"}),Ht.setNorthPenumbraLine(e.line);break;case"east_penumbra_line":Gs=Ut.addMultiPolyLine(e.line,{stroke_color:"red"}),Ht.setEastLimitLine(e.line),Ht.setEastLineTimes(e.times);break;case"west_penumbra_line":Fs=Ut.addMultiPolyLine(e.line,{stroke_color:"red"}),Ht.setWestLimitLine(e.line),Ht.setWestLineTimes(e.times);break;default:console.log("Unknown or invalid line type returned from line workers.")}console.log(e.type+" line drawn.")},function(e){if(Wt=!1,console.log("Eclipse lines drawing now complete: "+e),Ht.getPointCount()>10)fe(),ea.setEclipse(Ht),console.timeEnd("DrawLines"),$t.getCurrentPageIndex()!==ht&&Se(),Qi.click(e=>{fn&&(fn=!1,An.transitionEndOne(e=>{ea.isAnimating()?(ea.isRealTime()&&Ys&&(window.clearInterval(Ys),Ys=null),nt(),Se(!0)):(tt(),Ys||(Ys=t()))}),i())}),Qi.removeAttr("disabled");else{console.log("Not enough points"),we();var n=new h("Pardon Our Error","Unfortunately the eclipse circumstance lines could not be displayed for this eclipse. This usually occurs with a partial eclipse that only occurs near the poles. This is a known error and limitation. It is currently being investigated.Circumstance data, timings, and simulations should still work.","OK");n.hideCloseButton(),n.showModal()}});Qs.postMessage({cmd:"coords",coords:JSON.stringify(Jt)}),Xs.onmessage=function(e){"umbra_lines"===e.data.cmd&&(Xs.distancePosted=!0,t=parseFloat(e.data.distance),t=(t/=1609.34)>1e3?Math.round(t):t.toFixed(1),Xs.nextUmbraCoords&&Ge(),Xs.nextTotalCoords&&Fe(),"Annular"===Gt&&"Total"===Gt||Kn.html(t.toString()));if("central_line"===e.data.cmd){Xs.totalDistancePosted=!0;var t=parseFloat(e.data.distance),i=JSON.parse(e.data.coord);t=(t/=1609.34)>1e3?Math.round(t):t.toFixed(1),Xs.nextTotalCoords&&Fe(),Xs.nextUmbraCoords&&Ge(),i&&Qs.postMessage({cmd:"central_coords",coords:e.data.coord}),"Annular"!==Gt&&"Total"!==Gt||Kn.html(t.toString())}};var ia=Ut.addMarker(Jt,"images/loc24.png");ze(Jt,!0),d(),this.init=(()=>{$t.disableSwipe(1),ie(),f()}),this.forceResize=(()=>{d()})}}class U{getOnlineElevation(t,i){if("number"!=typeof t.latitude||"number"!=typeof t.longitude||"function"!=typeof i)throw new Error("Invalid input to getOnlineElevation function.");var n="https://nationalmap.gov/epqs/pqs.php?x=LONG&y=LAT&units=Meters&output=json";n=(n=n.replace("LONG",t.longitude.toString())).replace("LAT",t.latitude.toString()),console.log("Getting elevation data."),$.getJSON(n,()=>{console.log("Initial elevation success.")}).done(n=>{if(console.log("Elevation callback success."),"number"==typeof n.USGS_Elevation_Point_Query_Service.Elevation_Query.Elevation||"string"==typeof n.USGS_Elevation_Point_Query_Service.Elevation_Query.Elevation){var s=parseFloat(n.USGS_Elevation_Point_Query_Service.Elevation_Query.Elevation);s>-999?i(new e(t.latitude,t.longitude,s)):console.log("Bad elevation number, possibly non covered area or oceanic.")}else console.log("Elevation returned malformed data.")}).fail(()=>{console.log("Elevation error.")}).always(()=>{console.log("Elevation complete.")})}constructor(){function e(){l=0,d&&(navigator.geolocation.clearWatch(d),d=null)}function t(e){e.timestamp?(c=new Date,l=new Date(e.timestamp).getTime()-c.getTime()):c?(new Date).getTime()-c.getTime()>u&&(l=0):l=0,l>h&&(l=0),r&&(r(e.coords),r=null),n=e.coords,a&&a(e.coords)}function i(t){console.log(t.message),e(),s&&s(t)}var n,s,a,o={laitude:34,longitude:-118,altitude:0},r=null,l=0,c=null;const u=6e4,h=3e5;var m={enableHighAccuracy:!0,maximumAge:6e4,timeout:65e3},d=null;this.getGPSTimeCorrect=(()=>l),this.getError=(()=>0),this.getPosition=(()=>n||o),this.isOn=(()=>!!d),this.setErrorCall=(e=>{s=e}),this.setPositionCall=(e=>{a=e}),this.onFirstPostion=(e=>{r=e}),this.startWatch=(()=>{d||(d=navigator.geolocation.watchPosition(t,i,m))}),this.clearWatch=(()=>{e()})}}$(()=>{function e(e){(new R).init(),e&&$.getScript("ad_script.js"),console.log("VERSION: 015")}"undefined"!=typeof cordova?document.addEventListener("deviceready",()=>{e(!0)},!1):e(!1)});class B{static get RADAR(){return"rad_rala"}static get VIS_SAT(){return"sat_vis"}static get IR_SAT(){return"sat_ir"}static get OFFLINE_MAP(){return"images/offline/{z}/{x}/{y}.jpg"}static get ONLINE_MAP(){return"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"}static averageCoord(t){for(var i=0,n=0,s=0;s<t.length;s++)i+=t[s].latitude,n+=t[s].longitude;return i/=t.length,n/=t.length,new e(i,n)}static getDistance(e,t){function i(e){return Math.PI*e/180}var n=i(e.latitude),s=i(t.latitude),a=i(t.latitude-e.latitude),o=i(t.longitude-e.longitude),r=Math.sin(a/2)*Math.sin(a/2)+Math.cos(n)*Math.cos(s)*Math.sin(o/2)*Math.sin(o/2);return 6378137*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}constructor(t,i,n){function s(e){return e<10?"0"+e:e.toString()}function a(){var e=new Date;return""+e.getUTCFullYear()+s(e.getUTCMonth()+1)+s(e.getUTCDate())+s(e.getUTCHours())+s(e.getUTCMinutes())}function o(){return h(B.RADAR,T,A)}function r(){return h(B.IR_SAT,S,P)}function l(){return h(B.VIS_SAT,E,P)}function c(e){return"https://www.aviationweather.gov/gis/scripts/tc.php?product="+e+"&date="+a()+"&x={x}&y={-y}&z={z}"}function u(e){return new ol.source.XYZ({url:c(e)})}function h(e,t,i){var n=new ol.layer.Tile({source:u(e),opacity:i});return n.setZIndex(t),n.updateTimer=window.setInterval(function(){var t=u(e);n.setSource(t),t.refresh(),console.log("WX "+e+" layer updated.")},M),n}function m(e){return e&&(window.clearInterval(e.updateTimer),ie.removeLayer(e),e=null),e}function d(e){for(var t=[],i=0,n=0,s=0,a=f().bottomLeft.longitude,o=0;o<e.length;o++)0===o&&"number"==typeof a&&(a>90&&e[o].longitude<-90?n=360:a<-90&&e[o].longitude>90&&(n=-360)),o>0&&0===n&&(i>90&&e[o].longitude<-90?n=360:i<-90&&e[o].longitude>90&&(n=-360)),(s=e[o].longitude+n)>360&&(s-=360),s<-360&&(s+=360),t.push([s,e[o].latitude]),i=e[o].longitude;return t}function p(e,t){var i,n=[];for(i=0;i<e.length;i+=t)n.push(e.slice(i,i+t));return n}function g(){ee.on("tileloaderror",e=>{G&&(O>=L?(O=0,G()):O++);var t=X.getZoom();console.log("Tile load error. Zoom: "+t)})}function f(){var t=X.calculateExtent(ie.getSize()),i=ol.proj.transform([t[0],t[1]],"EPSG:3857","EPSG:4326"),n=ol.proj.transform([t[2],t[3]],"EPSG:3857","EPSG:4326");return{bottomLeft:new e(i[1],i[0]),topRight:new e(n[1],n[0])}}function w(e){if(e)if(Array.isArray(e))for(;e.length>0;)Q.removeFeature(e.pop());else Q.removeFeature(e);return null}function C(t){H&&(Z=window.setTimeout(()=>{Z=null;var i=ol.proj.toLonLat(t.coordinate);H(new e(i[1],i[0]))},100))}const v={scene3DOnly:!0,contextOptions:{webgl:{alpha:!0,depth:!0,stencil:!1,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!1},allowTextureFilterAnisotropic:!1}},L=3,T=3,E=2,S=1,A=.75,P=.5,M=3e5;var y=null,_=null,k=null,D=20,O=0,N=null,I=null,x=null,R=null,U=null,H=null,z=null,G=null,F=null,W=null,J=!1,j=!0,Z=null,q=null,V=!0,K=!1,Y=ol.interaction.defaults({altShiftDragRotate:!1,pinchRotate:!1,shiftDragZoom:!1}),X=new ol.View({center:ol.proj.fromLonLat([n.longitude,n.latitude]),zoom:i}),Q=new ol.source.Vector({wrapX:!0}),ee=new ol.source.OSM({url:B.OFFLINE_MAP}),te=new ol.layer.Tile({source:ee}),ie=new ol.Map({target:t,layers:[te],view:X,controls:[new ol.control.Attribution({collapsible:!1,label:" ",collapseLabel:" "})],interactions:Y,loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,moveTolerance:10}),ne=new ol.layer.Vector({source:Q,style:new ol.style.Style({stroke:new ol.style.Stroke({color:"black",width:2})}),updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:1e3});ne.setZIndex(4),ie.addLayer(ne);var se=new olcs.OLCesium({map:ie,sceneOptions:v});se.setTargetFrameRate(Number.POSITIVE_INFINITY);var ae=f().bottomLeft.longitude,oe=f().topRight.longitude;g(),function(){var e=$(".ol-attribution");e.css("white-space","nowrap"),e.children("ul").children("li").eq(0).remove()}(),this.addGreatCircle=function(t,i,n){for(var s=[],a=new b.GreatCircle({x:t.longitude,y:t.latitude},{x:i.longitude,y:i.latitude}).Arc(50,{offset:10}),o=0;o<a.geometries.length;o++)for(var r=0;r<a.geometries[o].coords.length;r++){var l=new e(a.geometries[o].coords[r][1],a.geometries[o].coords[r][0]);if(isNaN(l.latitude)||isNaN(l.longitude))return null;s.push(l)}return s.length>1?this.addPolyLine(s,n):(console.log("Not enough points created for great circle line."),null)},this.addPolyLine=function(e,t){var i="black",n=1;t&&(t.stroke_color&&(i=t.stroke_color),"number"==typeof t.stroke_width&&(n=t.stroke_width));var s=new ol.style.Style({stroke:new ol.style.Stroke({color:i,width:n})});if(e){var a=d(e),o=new ol.geom.LineString(a);o.transform("EPSG:4326","EPSG:3857");var r=new ol.Feature({geometry:o});return r.setStyle(s),Q.addFeature(r),r.reDraw=(()=>{r.setCoordinates(e)}),r.getCoords=(()=>e),r.setCoordinates=function(e){var t=d(e),i=new ol.geom.LineString(t);i.transform("EPSG:4326","EPSG:3857"),this.setGeometry(i)},r}return null},this.addMultiPolyLine=function(e,t){var i=[];if(!e)return null;for(var n=p(e,100),s=0;s<n.length;s++)s<n.length-1&&n[s].push(n[s+1][0]),i.push(this.addPolyLine(n[s],t));return i.reDraw=(()=>{for(var e=0;e<i.length;e++)i[e]&&i[e].reDraw()}),i.isValid=(()=>i.length>1),i},this.addPolygon=function(e,t){if(e){var i="rgba(0, 0, 0, .5)",n="black",s=.1;new ol.style.Fill;t&&(t.fill_color&&(i=t.fill_color),t.stroke_color&&(n=t.stroke_color),"number"==typeof t.stroke_width&&(s=t.stroke_width));var a=new ol.style.Style({stroke:new ol.style.Stroke({color:n,width:s}),fill:new ol.style.Fill({color:i})}),o=d(e),r=new ol.geom.LinearRing(o);r.transform("EPSG:4326","EPSG:3857");var l=new ol.geom.Polygon;l.appendLinearRing(r);var c=new ol.Feature({geometry:l});return c.setStyle(a),Q.addFeature(c),c.setCoordinates=function(e){var t=d(e);(r=new ol.geom.LinearRing(t)).transform("EPSG:4326","EPSG:3857");var i=new ol.geom.Polygon;i.appendLinearRing(r),this.setGeometry(i)},c}return null},this.setRotation=(e=>{X.rotate(e)}),this.enableGlobe=(()=>{se.setEnabled(!0)}),this.disableGlobe=function(){se.setEnabled(!1),this.setRotation(0)},this.addMarker=function(e,t){var i=new ol.style.Style({image:new ol.style.Icon({src:t})}),n=new ol.geom.Point([e.longitude,e.latitude]);n.transform("EPSG:4326","EPSG:3857");var s=new ol.Feature({geometry:n});return s.setStyle(i),Q.addFeature(s),s.setLocation=function(e){var t=new ol.geom.Point([e.longitude,e.latitude]);t.transform("EPSG:4326","EPSG:3857"),this.setGeometry(t)},s},this.getCenter=(()=>{var t=ol.proj.transform(X.getCenter(),"EPSG:3857","EPSG:4326");return new e(t[1],t[0])}),this.removeFeature=(e=>w(e)),this.render=(()=>{ie.render()}),this.clearMap=(()=>{Q.clear(!0)}),this.onTileLoadError=(e=>{if(!e||"function"!=typeof e)throw new Error("Input function for tile load error.");G=e}),ie.on("pointermove",e=>{e.dragging&&(!q&&V?(V=!1,q=window.setTimeout(()=>{q=null,V=!0,W=null,F=null,C(e),console.log("TODO: Remove isoloated pointermove with new OL 4.2+?")},100)):(window.clearTimeout(q),q=null),W=e.frameState.time,F=e.coordinate,N||(N=e.pixel),I=e.pixel,R&&j&&(j=!1,R(e)))}),ie.on("moveend",e=>{V=!0,q&&(window.clearTimeout(q),q=null);var t=f().bottomLeft.longitude,i=f().topRight.longitude;if(U&&(ae>0&&t<0?U(e):ae<0&&t>0?U(e):ae<-180&&t>-180?U(e):ae>-180&&t<-180?U(e):ae>180&&t<180?U(e):ae<180&&t>180&&U(e),oe>0&&i<0?U(e):oe<0&&i>0?U(e):oe<-180&&i>-180?U(e):oe>-180&&i<-180?U(e):oe>180&&i<180?U(e):oe<180&&i>180&&U(e)),ae=t,oe=i,j=!0,N&&I&&x){var n=0,s=!1;if(J)s=!0,J=!1;else{var a=N[0]-I[0],o=N[1]-I[1];a*=a,o*=o,n=Math.sqrt(a+o)}e.distance=Math.round(n),W&&e.frameState.time-W<250&&e.distance<10&&null!==F&&!s&&(e.coordinate=F,console.log("TODO: Remove drag click call with OL 4.2+"),W=null,F=null,C(e)),e.distance>=10&&x(e)}N=null,I=null}),this.onDoubleClick=(e=>{z=e,ie.on("doubleclick",z)}),this.onClick=(e=>{H=e,ie.on("click",C)}),this.clickOff=(()=>{H&&(ie.un("click",C),H=null)}),this.doubleClickOff=(()=>{z&&(ie.un("doubleclick",z),z=null)}),this.onDragEnd=(e=>{x=e}),this.onDragStart=(e=>{R=e}),this.onRedrawCall=(e=>{U=e}),this.on=((e,t,i)=>ie.on(e,t,i)),this.onZoomEnd=((e,t)=>X.on("change:resolution",i=>{J=!0,Z&&(window.clearTimeout(Z),Z=null),ie.once("moveend",()=>{e();var t=X.getZoom();t>D&&X.setZoom(D),t<1&&X.setZoom(1)},t)},t)),this.updateSize=(()=>{ie.updateSize()}),this.zoomIn=(()=>{X.getZoom()<D&&X.setZoom(X.getZoom()+1)}),this.zoomOut=(()=>{X.getZoom()>1&&X.setZoom(X.getZoom()-1)}),this.setSource=function(e){ee=new ol.source.OSM({url:e}),te.setSource(ee),ee.refresh(),this.render();var t=se.getEnabled();(se=new olcs.OLCesium({map:ie,sceneOptions:v})).setTargetFrameRate(Number.POSITIVE_INFINITY),se.setEnabled(t),g()},this.setOfflineMap=function(){K=!1,this.setSource(B.OFFLINE_MAP),ee.setAttributions("<a href='https://nationalmap.gov/' target='_blank'>The USGS National Map</a>"),D=7,this.getZoom()>D-2&&this.setZoom(D-2),this.getZoom()<1&&this.setZoom(1),this.clearAllWx(),this.render()},this.setOnlineMap=function(){K=!0,this.setSource(B.ONLINE_MAP),ee.setAttributions("&copy; Esri &mdash; Source: Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"),D=20,this.getZoom()>D&&this.setZoom(D),this.getZoom()<1&&this.setZoom(1),this.render()},this.isMapOnline=(()=>K),this.setCenter=(e=>{e&&X.setCenter(ol.proj.fromLonLat([e.longitude,e.latitude]))}),this.setZoom=(e=>{if("number"!=typeof e)throw new Error("setZoom needs a number value input.");e>D?X.setZoom(D):e<1?X.setZoom(1):X.setZoom(e)}),this.getZoom=(()=>X.getZoom()),this.getMaxZoom=(()=>D),this.getMinZoom=(()=>1),this.wxRadarOff=(()=>{y=m(y)}),this.wxRadarOn=function(){this.wxRadarOff(),y=o(),ie.addLayer(y)},this.wxVisSatOff=(()=>{_=m(_)}),this.wxVisSatOn=function(){this.wxVisSatOff(),_=l(),ie.addLayer(_)},this.wxIRSatOff=(()=>{k=m(k)}),this.wxIRSatOn=function(){this.wxIRSatOff(),k=r(),ie.addLayer(k)},this.clearAllWx=function(){this.wxRadarOff(),this.wxVisSatOff(),this.wxIRSatOff()}}}