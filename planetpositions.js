function PlanetPositions(){function o(Ie){return isNaN(Ie)?0:180*Ie/Math.PI}function n(Ie){return isNaN(Ie)?0:Math.PI*Ie/180}function l(Ie){var Se=Math.sin(n(Ie));return isNaN(Se)?0:Se}function d(Ie){var Se=Math.cos(n(Ie));return isNaN(Se)?0:Se}function m(Ie){var Se=Math.tan(n(Ie));return isNaN(Se)?0:Se}function _(Ie,Se){return o(Math.atan2(Ie,Se))}function P(Ie){return Math.sqrt(Math.abs(Ie))}function h(Ie){return 8.794/3600/f(Ie)}function f(Ie){return Ie/149597871}function A(Ie){var Se=new Date(Date.UTC(2e3,0,0,0,0,0)),Ce=Ie.getTime()-Se.getTime();return Ce/=8.64e7,Ce}function I(Ie){return 360<Ie||0>Ie?Ie-360*Math.floor(Ie/360):Ie}function S(Ie,Se,Ce){var ve=_(Ce,P(Ie*Ie+Se*Se));return isNaN(ve)&&(ve=0),ve}function C(Ie,Se){var Ce=_(Se,Ie);return isNaN(Ce)&&(Ce=0),I(Ce)}function O(Ie,Se,Ce,ve,Ue){var Oe=h(ve),Ye=Ue-0.1924*l(2*Ue),De=0.99833+0.00167*d(2*Ue),Le=_(m(Ye),d(Ie)),Me=Oe*De*d(Ye)*l(Ie)/d(Ce);isNaN(Me)&&(Me=0);var Xe=Oe*De*l(Ye)*l(Le-Ce)/l(Le);isNaN(Xe)&&(Xe=0);var je=Se-Me,Ze=Ce-Xe;return{top_ra:je,top_decl:Ze}}function Y(Ie){return I(125.1228-0.0529538083*Ie)}function X(){return 5.1454}function j(Ie){return I(318.0634+0.1643573223*Ie)}function Z(){return 385000}function b(){return 0.0549}function q(Ie){return I(115.3654+13.0649929509*Ie)}function G(Ie){return I(282.9404+4.70935E-5*Ie)}function W(){return 149598261}function B(Ie){return 0.016709-1.151e-9*Ie}function V(Ie){return I(356.047+0.9856002585*Ie)}function Q(Ie,Se){return I(Ie+Se)}function J(Ie){return I(23.4393-3.563e-7*Ie)}function k(Ie,Se){var Ce=Ie+180/Math.PI*Se*l(Ie)*(1+Se*d(Ie)),ve=Ce;for(i=0;i<Pe&&(ve=Ce,Ce-=(Ce-Se*(180/Math.PI)*l(Ce)-Ie)/(1-Se*d(Ce)),!(Math.abs(ve-Ce)<1e-9));i++);return i==Pe&&console.log("Went to max iterations."),I(Ce)}function $(Ie,Se,Ce){var ve=Ie*(d(Se)-Ce),Ue=Ie*l(Se)*P(1-Ce*Ce);return{x:ve,y:Ue,z:0}}function K(Ie,Se){return{x:Ie,y:Se,z:0}}function ee(Ie,Se,Ce){var ve=P(Ie*Ie+Se*Se+Ce*Ce);return ve}function te(Ie,Se){var Ce=I(_(Se,Ie));return Ce}function oe(Ie,Se){var Ce=I(Ie+Se);return Ce}function ie(Ie,Se,Ce,ve){var Ue=Se*d(Ce),Oe=Se*l(Ce)*d(Ie)-ve*l(Ie),Ye=Se*l(Ce)*l(Ie)+ve*d(Ie);return{x:Ue,y:Oe,z:Ye}}function ae(Ie,Se,Ce){var ve=0;ve=0<=Ie?24*(Ie-Math.floor(Ie)):24*(1+(Ie-Math.ceil(Ie))),24<=ve&&(ve-=24);var Ue=Ce+180+Se+15*ve;return Ue=I(Ue),Ue}function le(Ie,Se){return I(Ie-Se)}function se(Ie,Se){return 2*_(Ie,2*Se)}function de(Ie,Se,Ce){var ve=d(Ie)*d(Se),Ue=l(Ie)*d(Se),Oe=l(Se),Ye=ve*d(90-Ce)-Oe*l(90-Ce),De=ve*l(90-Ce)+Oe*d(90-Ce),Le=_(Ue,Ye)+180,Me=_(De,P(Ye*Ye+Ue*Ue));return{azimuth:Le,elevation:Me}}function ge(Ie,Se,Ce,ve){var Ue=Ie*(d(Se)*d(Ce)-l(Se)*l(Ce)*d(ve)),Oe=Ie*(l(Se)*d(Ce)+d(Se)*l(Ce)*d(ve)),Ye=Ie*l(Ce)*l(ve);return{x:Ue,y:Oe,z:Ye}}function me(Ie){var Se=_(Ie.y,Ie.x),Ce=_(Ie.z,P(Ie.x*Ie.x+Ie.y*Ie.y));return{lat:Ce,lon:I(Se)}}function re(Ie,Se,Ce){var ve=Ce*d(Se)*d(Ie),Ue=Ce*l(Se)*d(Ie),Oe=Ce*l(Ie);return{x:ve,y:Ue,z:Oe}}function ue(Ie,Se){var Ce=Se.x,ve=Se.y*d(Ie)-Se.z*l(Ie),Ue=Se.y*l(Ie)+Se.z*d(Ie);return{x:Ce,y:ve,z:Ue}}function ce(Ie,Se,Ce,ve){var Ue=0;return Ue+=-1.274*l(Ie-2*Se),Ue+=0.658*l(2*Se),Ue+=-0.186*l(Ce),Ue+=-0.059*l(2*Ie-2*Se),Ue+=-0.057*l(Ie-2*Se+Ce),Ue+=0.053*l(Ie+2*Se),Ue+=0.046*l(2*Se-Ce),Ue+=0.041*l(Ie-Ce),Ue+=-0.035*l(Se),Ue+=-0.031*l(Ie+Ce),Ue+=-0.015*l(2*ve-2*Se),Ue+=+0.011*l(Ie-4*Se),Ue}function pe(Ie,Se,Ce){var ve=0;return ve+=-0.173*l(Ce-2*Se),ve+=-0.055*l(Ie-Ce-2*Se),ve+=-0.046*l(Ie+Ce-2*Se),ve+=+0.033*l(Ce+2*Se),ve+=+0.017*l(2*Ie+Ce),ve}function _e(Ie,Se){var Ce=0;return Ce+=-0.58*d(Ie-2*Se),Ce+=-0.46*d(2*Se),Ce*6371}var Pe=50;this.getMoonPosition=function(Ie,Se,Ce){var ve=A(Ie),Ue=J(ve),Oe=Y(ve),Ye=X(ve),De=j(ve),Le=Z(ve),Me=b(ve),Xe=q(ve),je=k(Xe,Me),Ze=$(Le,je,Me),be=ee(Ze.x,Ze.y,Ze.z),Fe=te(Ze.x,Ze.y),qe=oe(Fe,De),Re=ge(be,Oe,qe,Ye),He=me(Re),Ge=I(Oe+De+Xe),We=G(ve),Ee=V(ve),Be=Q(We,Ee),Ve=I(Ge-Be),Qe=I(Ge-Oe),we=ce(Xe,Ve,Ee,Qe),Je=pe(Xe,Ve,Qe),ke=_e(Xe,Ve),$e=re(He.lat+Je,He.lon+we,be+ke),Ke=ue(Ue,$e),et=C(Ke.x,Ke.y),tt=S(Ke.x,Ke.y,Ke.z),ot=ae(ve,Ce,Be),it=I(ot-et),at=O(it,et,tt,be+ke,Se),nt=de(it,at.top_decl,Se),lt=se(3474.2,be+ke);return console.log("OLD MOON POS"),{ra:at.top_ra,decl:at.top_decl,elevation:nt.elevation,azimuth:nt.azimuth,diameter:lt}},this.getSunPosition=function(Ie,Se,Ce){var ve=A(Ie),Ue=J(ve),Oe=G(ve),Ye=W(ve),De=B(ve),Le=V(ve),Me=Q(Oe,Le),Xe=k(Le,De),je=$(Ye,Xe,De),Ze=K(je.x,je.y),be=ee(Ze.x,Ze.y,Ze.z),Fe=te(Ze.x,Ze.y),qe=oe(Fe,Oe),Re=ie(Ue,be,qe,Ze.z),He=C(Re.x,Re.y),Ge=S(Re.x,Re.y,Re.z),We=le(ae(ve,Ce,Me),He),Ee=O(We,He,Ge,be,Se),Be=se(1392684,be),Ve=de(We,Ee.top_decl,Se);return console.log("OLD SUN POS"),{ra:Ee.top_ra,decl:Ee.top_decl,elevation:Ve.elevation,azimuth:Ve.azimuth,diameter:Be}}}function PlanetPositionsAC(){function o(nt,lt){var st=lt[0]+lt[1]*nt+lt[2]*nt*nt+lt[3]*nt*nt*nt;return st}function n(nt){return isNaN(nt)?(console.log("RAD NAN"),0):180*nt/Math.PI}function l(nt){return isNaN(nt)?(console.log("DEG NAN"),0):Math.PI*nt/180}function d(nt){var lt=Math.sin(l(nt));return isNaN(lt)?(console.log("SIN NAN"),0):lt}function m(nt){var lt=Math.cos(l(nt));return isNaN(lt)?(console.log("COS NAN"),0):lt}function u(nt){var lt=Math.tan(l(nt));return isNaN(lt)?(console.log("TAN NAN"),0):lt}function c(nt){return n(Math.atan(nt))}function _(nt){var lt=Math.acos(nt);return isNaN(lt)?(console.log("ACOS NAN"),0):n(lt)}function P(nt){var lt=Math.asin(nt);return isNaN(lt)?(console.log("ASIN NAN"),0):n(lt)}function h(nt,lt){return n(Math.atan2(nt,lt))}function f(nt){return Math.sqrt(Math.abs(nt))}function A(nt){return P(d(8.79415/3600)/S(nt))}function I(nt,lt,st){var dt=f(nt*nt+lt*lt+st*st);return dt}function S(nt){return nt/149597871}function C(nt){var lt=nt.getTime()/8.64e7-10956;return Ke=O(nt),Ke/=86400,lt+=1*Ke,lt}function O(nt){var lt=0,st=0,dt=0,xt=0,yt=0,zt=0,gt=nt.getUTCFullYear(),mt=new Date(Date.UTC(gt,0,0,0,0,0)),rt=nt.getTime()-mt.getTime(),ut=new Date(mt);return ut.setUTCFullYear(ut.getUTCFullYear()+1),rt/=ut.getTime()-mt.getTime(),gt+=rt,1900>gt?(lt=gt-1860,st=lt*lt,dt=st*lt,xt=dt*lt,yt=xt*lt,zt=7.62+0.5737*lt-0.251754*st+0.01680668*dt-4.473624e-4*xt+yt/233174):1900<=gt&&1920>gt?(lt=gt-1900,st=lt*lt,dt=st*lt,xt=dt*lt,zt=-2.79+1.494119*lt-0.0598939*st+0.0061966*dt-1.97e-4*xt):1920<=gt&&1941>gt?(lt=gt-1920,st=lt*lt,dt=st*lt,zt=21.2+0.84493*lt-0.0761*st+0.0020936*dt):1941<=gt&&1961>gt?(lt=gt-1950,st=lt*lt,dt=st*lt,zt=29.07+0.407*lt-st/233+dt/2547):1961<=gt&&1986>gt?(lt=gt-1975,st=lt*lt,dt=st*lt,zt=45.45+1.067*lt-st/260-dt/718):1986<=gt&&2005>gt?(lt=gt-2e3,st=lt*lt,dt=st*lt,xt=dt*lt,yt=xt*lt,zt=63.86+0.3345*lt-0.060374*st+0.0017275*dt+6.51814e-4*xt+2.373599e-5*yt):2005<=gt&&2050>gt?(lt=gt-2e3,st=lt*lt,zt=62.92+0.32217*lt+0.005589*st):2050<=gt&&2150>gt?zt=-20+32*((gt-1820)/100)*((gt-1820)/100)-0.5628*(2150-gt):2150<=gt&&(lt=(gt-1820)/100,zt=-20+32*lt*lt),(1955>gt||2005<gt)&&(zt-=1.2932e-5*(gt-1955)*(gt-1955)),zt}function Y(nt){return 360<nt||0>nt?nt-360*Math.floor(nt/360):nt}function j(nt,lt,st){var dt=90-_(st/f(nt*nt+lt*lt+st*st));return isNaN(dt)&&(dt=0),dt}function Z(nt,lt){var st=h(lt,nt);return isNaN(st)&&(st=0),Y(st)}function b(nt,lt,st,dt,xt,yt){var zt=lt,gt=0,mt=0,ut=dt,ct=0,pt=0,_t=0,Nt=0,Tt=0,Pt=0,ht=0,ft=0,At=0,It=0,St=0.99664719,Ct=0,vt=xt-0.1924*d(2*xt),Ut=St*m(2*xt),Yt=0;for(Ct=oe(nt,zt);7>It;)ct=A(ut),pt=c(St*u(xt)),_t=St*d(pt)+yt/6378149*d(xt),Nt=m(pt)+yt/6378149*m(xt),mt=-ct*Nt*d(Ct)/m(st),Yt=-ct*(_t*m(st)-Nt*m(Ct)*d(st)),isNaN(mt)&&(mt=0),zt=Y(lt+mt),gt=st+Yt,Tt=P(6378.149/dt),Pt=m(gt)*d(Ct),ht=m(gt)*m(Ct)-Nt*d(Tt),ft=d(gt)-_t*d(Tt),At=f(Pt*Pt+ht*ht+ft*ft),ut=dt*At,isNaN(gt)&&(gt=st),It++;return{top_ra:zt,top_decl:gt,top_dist:ut}}function q(){var nt=(450160.398036-6962890.5431*ve+7.4722*Ue+0.007702*Oe-5.939e-5*Ye)/3600;return nt=Y(nt),nt}function W(){var nt=(335779.526232+1739527262.8478*ve-12.7512*Ue-0.001037*Oe+4.17e-6*Ye)/3600;return nt=Y(nt),nt}function B(){var nt=(1072260.70369+1602961601.209*ve-6.3706*Ue+0.006593*Oe-3.169e-5*Ye)/3600;return nt=Y(nt),nt}function V(){var nt=Y(218.3164477+481267.88123421*ve-0.0015786*Ue+Oe/538841-Ye/65194000);return nt}function Q(){var nt=(485868.249036+1717915923.2178*ve+31.8792*Ue+0.051635*Oe-2.447e-4*Ye)/3600;return nt=Y(nt),nt}function k(){return 1-0.002516*ve-7.4e-6*Ue}function $(){var nt=1287104.79305+129596581.0481*ve-0.5532*Ue+1.36e-4*Oe-1.149e-5*Ye;return nt/=3600,Y(nt)}function K(nt){var lt=(nt+$e)/3652500,st=84381.448,dt=lt;return st-=4680.93*dt,dt*=lt,st-=1.55*dt,dt*=lt,st+=1999.25*dt,dt*=lt,st-=51.38*dt,dt*=lt,st-=249.67*dt,dt*=lt,st-=39.05*dt,dt*=lt,st+=7.12*dt,dt*=lt,st+=27.87*dt,dt*=lt,st+=5.79*dt,dt*=lt,st+=2.45*dt,st/=3600,Y(st)}function ee(nt){var lt=Se.getUTCHours()+Se.getUTCMinutes()/60+Se.getUTCSeconds()/3600,st=Y(100.46061837+36000.770053608*ve+3.87933e-4*Ue-Oe/3.871e7),dt=Y(st+nt+15*lt);return dt}function oe(nt,lt){return Y(nt-lt)}function ie(nt,lt){return 2*h(nt,2*lt)}function ae(nt,lt,st){var dt=Y(h(d(nt),m(nt)*d(st)-u(lt)*m(st))+180),xt=P(d(st)*d(lt)+m(st)*m(lt)*m(nt));return{azimuth:dt,elevation:xt}}function le(nt,lt,st){var dt=st*m(lt)*m(nt),xt=st*d(lt)*m(nt),yt=st*d(nt);return{x:dt,y:xt,z:yt}}function se(nt,lt){var st=lt.x,dt=lt.y*m(nt)-lt.z*d(nt),xt=lt.y*d(nt)+lt.z*m(nt);return{x:st,y:dt,z:xt}}function de(nt,lt,st,dt,xt){var yt=ve,zt=0;zt+=(-172064161-174666*yt)*d(xt)+33386*m(xt),zt+=(-13170906-1675*yt)*d(2*(st-dt+xt))-13696*m(2*(st-dt+xt)),zt+=(-2276413-234*yt)*d(2*(st+xt))+2796*m(2*(st+xt)),zt+=(2074554+207*yt)*d(2*xt)-698*m(2*xt),zt+=(1475877-3633*yt)*d(lt)+11817*m(lt),zt+=(-516821+1226*yt)*d(lt+2*(st-dt+xt))-524*m(lt+2*(st-dt+xt)),zt+=(711159+73*yt)*d(nt)-872*m(nt),zt+=(-387298-367*yt)*d(2*st+xt)+380*m(2*st+xt),zt+=(-301461-36*yt)*d(nt+2*(st+xt))+816*m(nt+2*(st+xt)),zt+=(215829-494*yt)*d(2*(st-dt+xt)-lt)+111*m(2*(st-dt+xt)-lt),zt+=(128227+137*yt)*d(2*(st-dt)+xt)+181*m(2*(st-dt)+xt),zt+=(123457+11*yt)*d(2*(st+xt)-nt)+19*m(2*(st+xt)-nt),zt+=(156994+10*yt)*d(2*dt-nt)-168*m(2*dt-nt),zt+=(63110+63*yt)*d(nt+xt)+27*m(nt+xt),zt+=(-57976-63*yt)*d(xt-nt)-189*m(xt-nt),zt+=(-59641-11*yt)*d(2*(st+dt+xt)-nt)+149*m(2*(st+dt+xt)-nt),zt+=(-51613-42*yt)*d(nt+2*st+xt)+129*m(nt+2*st+xt),zt+=(45893+50*yt)*d(2*(st-nt)+xt)+31*m(2*(st-nt)+xt),zt+=(63384+11*yt)*d(2*dt)-150*m(2*dt),zt+=(-38571-yt)*d(2*(st+dt+xt))+158*m(2*(st+dt+xt)),zt+=32481*d(2*(st-lt-dt+xt)),zt-=47722*d(2*(dt-nt))+18*m(2*(dt-nt)),zt+=(-31046-yt)*d(2*(nt+st+xt))+131*m(2*(nt+st+xt)),zt+=28593*d(nt+2*(st-dt+xt))-m(nt+2*(st-dt+xt)),zt+=(20441+21*yt)*d(2*st+xt-nt)+10*m(2*st+xt-nt),zt+=29243*d(2*nt)-74*m(2*nt),zt+=25887*d(2*st)-66*m(2*st),zt+=(-14053-25*yt)*d(lt+xt)+79*m(lt+xt),zt+=(15164+10*yt)*d(2*dt-nt+xt)+11*m(2*dt-nt+xt),zt+=(-15794+72*yt)*d(2*(lt+st-dt+xt))-16*m(2*(lt+st-dt+xt)),zt+=21783*d(2*(dt-st))+13*m(2*(dt-st)),zt+=(-12873-10*yt)*d(nt-2*dt+xt)-37*m(nt-2*dt+xt),zt+=(-12654+11*yt)*d(xt-lt)+63*m(xt-lt),zt-=10204*d(2*(st+dt)+xt-nt)-25*m(2*(st+dt)+xt-nt),zt+=(16707-85*yt)*d(2*lt)-10*m(2*lt),zt-=7691*d(nt+2*(st+dt+xt))-44*m(nt+2*(st+dt+xt)),zt-=11024*d(2*(st-nt))+14*m(2*(st-nt)),zt+=(7566-21*yt)*d(lt+2*(st+xt))-11*m(lt+2*(st+xt)),zt+=(-6637-11*yt)*d(2*(st+dt)+xt)+25*m(2*(st+dt)+xt),zt+=(-7141+21*yt)*d(2*(st+xt)-lt)+8*m(2*(st+xt)-lt),zt+=(-6302-11*yt)*d(2*dt+xt)+2*m(2*dt+xt),zt+=(5800+10*yt)*d(nt+2*(st-dt)+xt)+2*m(nt+2*(st-dt)+xt),zt+=6443*d(2*(nt+st-dt+xt))-7*m(2*(nt+st-dt+xt)),zt+=(-5774-11*yt)*d(2*(dt-nt)+xt)-15*m(2*(dt-nt)+xt),zt-=5350*d(2*(nt+st)+xt)-21*m(2*(nt+st)+xt),zt+=(-4752-11*yt)*d(2*(st-dt)+xt-lt)-3*m(2*(st-dt)+xt-lt),zt+=(-4940-11*yt)*d(xt-2*dt)-21*m(xt-2*dt),zt+=7350*d(2*dt-nt-lt)-8*m(2*dt-nt-lt),zt+=4065*d(2*(nt-dt)+xt)+6*m(2*(nt-dt)+xt),zt+=6579*d(nt+2*dt)-24*m(nt+2*dt),zt+=3579*d(lt+2*(st-dt)+xt)+5*m(lt+2*(st-dt)+xt),zt+=4725*d(nt-lt)-6*m(nt-lt),zt-=3075*d(2*(st+xt-nt))+2*m(2*(st+xt-nt)),zt-=2904*d(3*nt+2*(st+xt))-15*m(3*nt+2*(st+xt)),zt+=4348*d(2*dt-lt)-10*m(2*dt-lt),zt-=2878*d(nt-lt+2*(st+xt))-8*m(nt-lt+2*(st+xt)),zt-=4230*d(dt)-5*m(dt),zt-=2819*d(2*(st+dt+xt)-nt-lt)-7*m(2*(st+dt+xt)-nt-lt),zt-=4056*d(2*st-nt)-5*m(2*st-nt),zt-=2647*d(2*(st+dt+xt)-lt)-11*m(2*(st+dt+xt)-lt),zt-=2294*d(xt-2*nt)+10*m(xt-2*nt),zt+=2481*d(nt+lt+2*(st+xt))-7*m(nt+lt+2*(st+xt)),zt+=2179*d(2*nt+xt)-2*m(2*nt+xt),zt+=3276*d(lt+dt-nt)+m(lt+dt-nt),zt-=3389*d(nt+lt)-5*m(nt+lt),zt+=3339*d(nt+2*st)-13*m(nt+2*st),zt-=1987*d(2*(st-dt)+xt-nt)+6*m(2*(st-dt)+xt-nt),zt-=1981*d(nt+2*xt),zt+=4026*d(dt-nt)-353*m(dt-nt),zt+=1660*d(2*st+dt+2*xt)-5*m(dt+2*(st+xt)),zt-=1521*d(2*(st+2*dt+xt)-nt)-9*m(2*(st+2*dt+xt)-nt),zt+=1314*d(lt+dt+xt-nt),zt-=1283*d(2*(st-dt-lt)+xt),zt-=1331*d(nt+2*st+2*dt+xt)-8*m(nt+2*(st+dt)+xt),zt+=1383*d(2*(st-nt+dt+xt))-2*m(2*(st-nt+dt+xt)),zt+=1405*d(2*xt-nt)+4*m(2*xt-nt),zt+=1290*d(nt+lt+2*(st-dt+xt));var gt=zt/3.6e10;return gt}function ge(nt,lt,st,dt,xt){var yt=ve,zt=0;zt+=(92052331+9086*yt)*m(xt)+15377*d(xt),zt+=(5730336-3015*yt)*m(2*(st-dt+xt))-4587*d(2*(st-dt+xt)),zt+=(978459-485*yt)*m(2*(st+xt))+1374*d(2*(st+xt)),zt+=(-897492+470*yt)*m(2*xt)-291*d(2*xt),zt+=(73871-184*yt)*m(lt)-1924*d(lt),zt+=(224386-677*yt)*m(lt+2*(st-dt+xt))-174*d(lt+2*(st-dt+xt)),zt-=6750*m(nt)-358*d(nt),zt+=(200728+18*yt)*m(2*st+xt)+318*d(2*st+xt),zt+=(129025-63*yt)*m(nt+2*(st+xt))+367*d(nt+2*(st+xt)),zt+=(-95929+299*yt)*m(2*(st-dt+xt)-lt)+132*d(2*(st-dt+xt)-lt),zt+=(-68982-9*yt)*m(2*(st-dt)+xt)+39*d(2*(st-dt)+xt),zt+=(-53311+32*yt)*m(2*(st+xt)-nt)-4*d(2*(st+xt)-nt),zt-=1235*m(2*dt-nt)-82*d(2*dt-nt),zt-=33228*m(nt+xt)+9*d(nt+xt),zt+=31429*m(xt-nt)-75*d(xt-nt),zt+=(25543-11*yt)*m(2*(st+dt+xt)-nt)+66*d(2*(st+dt+xt)-nt),zt+=26366*m(nt+2*st+xt)+78*d(nt+2*st+xt),zt+=(-24236-10*yt)*m(2*(st-nt)+xt)+20*d(2*(st-nt)+xt),zt-=1220*m(2*dt)-29*d(2*dt),zt+=(16452-11*yt)*m(2*(st+dt+xt))+68*d(2*(st+dt+xt)),zt-=13870*m(2*(st-lt-dt+xt)),zt+=477*m(2*(dt-nt))-25*d(2*(dt-nt)),zt+=(13238-11*yt)*m(2*(nt+st+xt))+59*d(2*(nt+st+xt)),zt+=(-12338+10*yt)*m(nt+2*(st-dt+xt))-3*d(nt+2*(st-dt+xt)),zt-=10758*m(2*st+xt-nt)+3*d(2*st+xt-nt),zt-=609*m(2*nt)-13*d(2*nt),zt-=550*m(2*st)-11*d(2*st),zt+=(8551-2*yt)*m(lt+xt)-45*d(lt+xt),zt-=8001*m(2*dt+xt-nt)+d(2*dt+xt-nt),zt+=(6850-42*yt)*m(2*(lt+st-dt+xt))-5*d(2*(lt+st-dt+xt)),zt-=167*m(2*(dt-st))-13*d(2*(dt-st)),zt+=6953*m(nt-2*dt+xt)-14*d(nt-2*dt+xt),zt+=6415*m(xt-lt)+26*d(xt-lt),zt+=5222*m(2*(st+dt)+xt-nt)+15*d(2*(st+dt)+xt-nt),zt+=(168-yt)*m(2*lt)+10*d(2*lt),zt+=3268*m(nt+2*(st+dt+xt))+19*d(nt+2*(st+dt+xt)),zt+=104*m(2*(st-nt))+2*d(2*(st-nt)),zt-=3250*m(lt+2*(st+xt))+5*d(lt+2*(st+xt)),zt+=3353*m(2*(st+dt)+xt)+14*d(2*(st+dt)+xt),zt+=3070*m(2*(st+xt)-lt)+4*d(2*(st+xt)-lt),zt+=3272*m(2*dt+xt)+4*d(2*dt+xt),zt-=3045*m(nt+2*(st-dt)+xt)+d(nt+2*(st-dt)+xt),zt-=2768*m(2*(nt+st-dt+xt))+4*d(2*(nt+st-dt+xt)),zt+=3041*m(2*(dt-nt)+xt)-5*d(2*(dt-nt)+xt),zt+=2695*m(2*(nt+st)+xt)+12*d(2*(nt+st)+xt),zt+=2719*m(2*(st-dt)+xt-lt)-3*d(2*(st-dt)+xt-lt),zt+=2720*m(xt-2*dt)-9*d(xt-2*dt),zt-=51*m(2*dt-nt-lt)-4*d(2*dt-nt-lt),zt-=2206*m(2*(nt-dt)+xt)-d(2*(nt-dt)+xt),zt-=199*m(nt+2*dt)-2*d(nt+2*dt),zt-=1900*m(lt+2*(st-dt)+xt)-d(lt+2*(st-dt)+xt),zt-=41*m(nt-lt)-3*d(nt-lt),zt+=1313*m(2*(st-nt+xt))-d(2*(st-nt+xt)),zt+=1233*m(3*nt+2*(st+xt))+7*d(3*nt+2*(st+xt)),zt-=81*m(2*dt-lt)-2*d(2*dt-lt),zt+=1232*m(nt-lt+2*(st+xt))+4*d(nt-lt+2*(st+xt)),zt-=20*m(dt)+2*d(dt),zt+=1207*m(2*(st+dt+xt)-nt-lt)+3*d(2*(st+dt+xt)-nt-lt),zt+=40*m(2*st-nt)-2*d(2*st-nt),zt+=1129*m(2*(st+dt+xt)-lt)+5*d(2*(st+dt+xt)-lt),zt+=1266*m(xt-2*nt)-4*d(xt-2*nt),zt-=1062*m(nt+lt+2*(st+xt))+3*d(nt+lt+2*(st+xt)),zt-=1129*m(2*nt+xt)+2*d(2*nt+xt),zt-=9*m(lt+dt-nt),zt+=35*m(nt+lt)-2*d(nt+lt),zt-=107*m(nt+2*st)-d(nt+2*st),zt+=1073*m(2*(st-dt)+xt-nt)-2*d(2*(st-dt)+xt-nt),zt+=854*m(nt+2*xt),zt-=553*m(dt-nt)+139*d(dt-nt),zt-=710*m(2*(st+xt)+dt)+2*d(2*(st+xt)+dt),zt+=647*m(2*(st+2*dt+xt)-nt)+4*d(2*(st+2*dt+xt)-nt),zt-=700*m(lt+dt+xt-nt),zt+=672*m(2*(st-lt-dt)+xt),zt+=663*m(nt+2*(st+dt)+xt)+4*d(nt+2*(st+dt)+xt),zt-=594*m(2*(st-nt+dt+xt))+2*d(2*(st-nt+dt+xt)),zt-=610*m(2*xt-nt)-2*d(2*xt-nt),zt-=556*m(nt+lt+2*(st-dt+xt));var gt=zt/3.6e10;return gt}function re(){return[[0,0,1,0],[2,0,-1,0],[2,0,0,0],[0,0,2,0],[0,1,0,0],[0,0,0,2],[2,0,-2,0],[2,-1,-1,0],[2,0,1,0],[2,-1,0,0],[0,1,-1,0],[1,0,0,0],[0,1,1,0],[2,0,0,-2],[0,0,1,2],[0,0,1,-2],[4,0,-1,0],[0,0,3,0],[4,0,-2,0],[2,1,-1,0],[2,1,0,0],[1,0,-1,0],[1,1,0,0],[2,-1,1,0],[2,0,2,0],[4,0,0,0],[2,0,-3,0],[0,1,-2,0],[2,0,-1,2],[2,-1,-2,0],[1,0,1,0],[2,-2,0,0],[0,1,2,0],[0,2,0,0],[2,-2,-1,0],[2,0,1,-2],[2,0,0,2],[4,-1,-1,0],[0,0,2,2],[3,0,-1,0],[2,1,1,0],[4,-1,-2,0],[0,2,-1,0],[2,2,-1,0],[2,1,-2,0],[2,-1,0,-2],[4,0,1,0],[0,0,4,0],[4,-1,0,0],[1,0,-2,0],[2,1,0,-2],[0,0,2,-2],[1,1,1,0],[3,0,-2,0],[4,0,-3,0],[2,-1,2,0],[0,2,1,0],[1,1,-1,0],[2,0,3,0],[2,0,-1,-2]]}function ue(){return[[6288774,-20905355],[1274027,-3699111],[658314,-2955968],[213618,-569925],[-185116,48888],[-114332,-3149],[58793,246158],[57066,-152138],[53322,-170733],[45758,-204586],[-40923,-129620],[-34720,108743],[-30383,104755],[15327,10321],[-12528,0],[10980,79661],[10675,-34782],[10034,-23210],[8548,-21636],[-7888,24208],[-6766,30824],[-5163,-8379],[4987,-16675],[4036,-12831],[3994,-10445],[3861,-11650],[3665,14403],[-2689,-7003],[-2602,0],[2390,10056],[-2348,6322],[2236,-9884],[-2120,5751],[-2069,0],[2048,-4950],[-1773,4130],[-1595,0],[1215,-3958],[-1110,0],[-892,3258],[-810,2616],[759,-1897],[-713,-2117],[-700,2354],[691,0],[596,0],[549,-1423],[537,-1117],[520,-1571],[-487,-1739],[-399,0],[-381,-4421],[351,0],[-340,0],[330,0],[327,0],[-323,1165],[299,0],[294,0],[0,8752]]}function ce(){return[[0,0,0,1],[0,0,1,1],[0,0,1,-1],[2,0,0,-1],[2,0,-1,1],[2,0,-1,-1],[2,0,0,1],[0,0,2,1],[2,0,1,-1],[0,0,2,-1],[2,-1,0,-1],[2,0,-2,-1],[2,0,1,1],[2,1,0,-1],[2,-1,-1,1],[2,-1,0,1],[2,-1,-1,-1],[0,1,-1,-1],[4,0,-1,-1],[0,1,0,1],[0,0,0,3],[0,1,-1,1],[1,0,0,1],[0,1,1,1],[0,1,1,-1],[0,1,0,-1],[1,0,0,-1],[0,0,3,1],[4,0,0,-1],[4,0,-1,1],[0,0,1,-3],[4,0,-2,1],[2,0,0,-3],[2,0,2,-1],[2,-1,1,-1],[2,0,-2,1],[0,0,3,-1],[2,0,2,1],[2,0,-3,-1],[2,1,-1,1],[2,1,0,1],[4,0,0,1],[2,-1,1,1],[2,-2,0,-1],[0,0,1,3],[2,1,1,-1],[1,1,0,-1],[1,1,0,1],[0,1,-2,-1],[2,1,-1,-1],[1,0,1,1],[2,-1,-2,-1],[0,1,2,1],[4,0,-2,-1],[4,-1,-1,-1],[1,0,1,-1],[4,0,1,-1],[1,0,-1,-1],[4,-1,0,-1],[2,-2,0,1]]}function pe(){return[5128122,280602,277693,173237,55413,46271,32573,17198,9266,8822,8216,4324,4200,-3359,2463,2211,2065,-1870,1828,-1794,-1749,-1565,-1491,-1475,-1410,-1344,-1335,1107,1021,833,777,671,607,596,491,-451,439,422,421,-366,-351,331,315,302,-283,-229,223,223,-220,-220,-185,181,-177,176,166,-164,132,-119,115,107]}function _e(){for(var nt=ce(),lt=pe(),st=nt.length,dt=0,xt=0,yt=0;yt<st;yt++)xt=lt[yt]*d(Y(nt[yt][0]*be+nt[yt][1]*qe+nt[yt][2]*Me+nt[yt][3]*Ze)),1===nt[yt][1]||-1===nt[yt][1]?xt*=Xe:(2===nt[yt][1]||-2===nt[yt][1])&&(xt*=je),dt+=xt;return dt-=2235*d(Fe),dt+=382*d(Ge),dt+=175*d(Y(Re-Ze)),dt+=175*d(Y(Re+Ze)),dt+=127*d(Y(Fe-Me)),dt-=115*d(Y(Fe+Me)),dt/=1e6,dt}function Ne(){for(var nt=0,lt=0,st=re(),dt=ue(),xt=st.length,yt=0;yt<xt;yt++)lt=dt[yt][0]*d(Y(st[yt][0]*be+st[yt][1]*qe+st[yt][2]*Me+st[yt][3]*Ze)),1===st[yt][1]||-1===st[yt][1]?lt*=Xe:(2===st[yt][1]||-2===st[yt][1])&&(lt*=je),nt+=lt;nt+=3958*d(Re),nt+=1962*d(Y(Fe-Ze)),nt+=318*d(He);var zt=Y(Fe+nt/1e6+We);return zt}function Te(){for(var nt=0,lt=0,st=re(),dt=ue(),xt=st.length,yt=0;yt<xt;yt++)lt=dt[yt][1]*m(Y(st[yt][0]*be+st[yt][1]*qe+st[yt][2]*Me+st[yt][3]*Ze)),1===st[yt][1]||-1===st[yt][1]?lt*=Xe:(2===st[yt][1]||-2===st[yt][1])&&(lt*=je),nt+=lt;var zt=385000.56+nt/1e3;return zt}function he(){return Y(53.09+479264.29*ve)}function fe(){return Y(119.75+131.849*ve)}function Ae(){return Y(313.45+481266.484*ve)}function Ie(){var lt=at.find(function(st){return 1>=Math.abs(st.jdIndex-Be)});return lt}var Se=null,Ce=0,ve=0,Ue=0,Oe=0,Ye=0,De=0,Le=0,Me=0,Xe=0,je=0,Ze=0,be=0,Fe=0,qe=0,Re=0,He=0,Ge=0,We=0,Ee=0,Be=0,$e=-1.5,Ke=0,it=null,at=[{jdIndex:2457987,moonX:new Float64Array([18506749504126840,5290.876340618884,-9189.489244770575,0.0024924126589560233]),moonY:new Float64Array([-11310217493380308,-3233.4052430461234,5616.109217784905,-0.0015232311075495902]),moonZ:new Float64Array([-162387097319673.28,-46.25147358968696,80.62973631698192,-0.00002186830191413755]),sunX:new Float64Array([37427259303053540,10699.540576661608,-18583.943823988215,0.005040350909218588]),sunY:new Float64Array([-22810547500994236,-6521.104342668403,11327.447458238365,-0.003072403061287145]),sunZ:new Float64Array([-1163215847171.9973,-1.3123060261563904,0.5775136769017654,-1.5662488470583e-7])}];this.setDate=function(nt,lt,st){Se=new Date(nt),Ce=C(Se),ve=(Ce+$e)/36525,Ue=ve*ve,Oe=ve*Ue,Ye=ve*Oe,De=K(Ce),Le=q(),Me=Q(),Ze=W(),be=B(),qe=$(),Fe=V(),Xe=k(),je=Xe*Xe,Re=fe(),He=he(),Ge=Ae();var dt=ge(Me,qe,Ze,be,Le);De+=dt,We=de(Me,qe,Ze,be,Le),Ee=lt?lt:0,Be=st?st:0,it=Ie(Be)},this.getMoonPosition=function(nt,lt,st){var yt=Y(Ne(Ce)+We+0),zt=Y(_e(Ce)+0),xt=Te(Ce),dt=le(zt,yt,xt);var dt,xt;var gt=se(De,dt),mt=Z(gt.x,gt.y),rt=j(gt.x,gt.y,gt.z),ut=ee(lt),ct=oe(ut,mt),pt=b(ut,mt,rt,xt,nt,st),_t=ae(ct,pt.top_decl,nt),Nt=ie(3474.8,pt.top_dist);return{ra:pt.top_ra,decl:pt.top_decl,elevation:_t.elevation,azimuth:_t.azimuth,diameter:Nt,eclipLon:yt,eclipLat:zt,distance:pt.top_dist,jd:Be}},this.getSunPosition=function(nt,lt,st){var yt=new EarthPosition,zt=yt.getPosition(ve/10),xt=zt.r,gt=xt/299792.458,mt=ve;mt-=gt/3155760000,zt=yt.getPosition(mt/10);var rt=-1*zt.lat,ut=Y(zt.lon+180+We);xt=zt.r;var dt=le(rt,ut,xt);var dt,xt;var ct=se(De,dt),pt=Z(ct.x,ct.y),_t=j(ct.x,ct.y,ct.z),Nt=ee(lt),Tt=oe(Nt,pt),Pt=b(Nt,pt,_t,xt,nt,st),ht=ie(1392000,Pt.top_dist),ft=ae(Tt,Pt.top_decl,nt);return{ra:Pt.top_ra,decl:Pt.top_decl,elevation:ft.elevation,azimuth:ft.azimuth,diameter:ht,jd:Be}}}