var LineWorkers=function(B,Y){function k(f){f=f.data;var h="null",k="null";switch(f.cmd){case "eclipse_central_line_update":v++;A({type:"central_line",line:JSON.parse(f.line),times:JSON.parse(f.times)});break;case "eclipse_north_umbra_line_update":v++;A({type:"north_umbra_line",line:JSON.parse(f.line),times:JSON.parse(f.times)});break;case "eclipse_south_umbra_line_update":v++;A({type:"south_umbra_line",line:JSON.parse(f.line),times:JSON.parse(f.times)});break;case "eclipse_south_penumbra_line_update":v++;
h=f.line;t=!0;H&&(H=t=!1,pa.postMessage({cmd:"east_penumbra_line",eclipse:D,south_pen_line:h,north_pen_line:k}),xa.postMessage({cmd:"west_penumbra_line",eclipse:D,south_pen_line:h,north_pen_line:k}));A({type:"south_penumbra_line",line:JSON.parse(f.line)});break;case "eclipse_north_penumbra_line_update":v++;k=f.line;H=!0;t&&(H=t=!1,pa.postMessage({cmd:"east_penumbra_line",eclipse:D,south_pen_line:h,north_pen_line:k}),xa.postMessage({cmd:"west_penumbra_line",eclipse:D,south_pen_line:h,north_pen_line:k}));
A({type:"north_penumbra_line",line:JSON.parse(f.line)});break;case "eclipse_east_penumbra_line_update":v++;A({type:"east_penumbra_line",line:JSON.parse(f.line),times:JSON.parse(f.times)});break;case "eclipse_west_penumbra_line_update":v++;A({type:"west_penumbra_line",line:JSON.parse(f.line),times:JSON.parse(f.times)});break;case "eclipse_central_line_error":p++;console.log("LINE WORKER: Central line error.");break;case "eclipse_north_umbra_line_error":p++;console.log("LINE WORKER: North umbra line error.");
break;case "eclipse_south_umbra_line_error":p++;console.log("LINE WORKER: South ubmra line error.");break;case "eclipse_south_penumbra_line_error":p++;console.log("LINE WORKER: South penumbra line error.");break;case "eclipse_north_penumbra_line_error":p++;console.log("LINE WORKER: North penumbra line error.");break;case "eclipse_east_penumbra_line_error":p++;console.log("LINE WORKER: East penumbra line error.");break;case "eclipse_west_penumbra_line_error":p++;console.log("LINE WORKER: West penumbra line error.");
break;default:p++,console.log("LINE WORKER: Invalid line command.")}7===v+p&&(0===v-p&&console.log("LINE ERROR: No lines drawn."),P(v),v=p=0)}if("function"!==typeof B)throw Error("Must use callback function for single line complete updaterr.");if("function"!==typeof Y)throw Error("Must use callback function for all lines complete fucntion.");var v=0,p=0,D=null,A=B,P=Y,H=!1,t=!1,h=new Worker("calculateWorker.js"),ya=new Worker("calculateWorker.js"),za=new Worker("calculateWorker.js"),qa=new Worker("calculateWorker.js"),
Z=new Worker("calculateWorker.js"),pa=new Worker("calculateWorker.js"),xa=new Worker("calculateWorker.js");h.onmessage=k;ya.onmessage=k;za.onmessage=k;qa.onmessage=k;Z.onmessage=k;pa.onmessage=k;xa.onmessage=k;this.updateLines=function(f){D=f;t=H=!1;h.postMessage({cmd:"central_line",eclipse:f});ya.postMessage({cmd:"north_umbra_line",eclipse:f});za.postMessage({cmd:"south_umbra_line",eclipse:f});qa.postMessage({cmd:"south_penumbra_line",eclipse:f});Z.postMessage({cmd:"north_penumbra_line",eclipse:f})}},
EclipseUI=function(){function B(){window.setTimeout(function(){w=!0},500)}function Y(){var a=e.getHeaderHeight(),b=e.getFooterHeight();return $(window).height()-a-b}function k(){var a=Y(),b=$(window).height();aa.height(a);hb.offset();aa.offset();var m=$("#top").height(),d=$("#bottom").height();console.log("Top height: "+m);console.log("Bottom height: "+d);console.log("Total height: "+(m+d));console.log("Content height: "+a);aa.css("min-height",(m+d<=a+1?a:b)+"px");b=$(document).width();x.height(a);
a<b&&(b=a);K.width("100%");K.height("100%");ra.width(.5*b);ra.height(.5*b);Aa.is(":checked")&&1===e.getCurrentPageIndex()?Z():(Q.height(a),c.updateSize());console.log("Updated content sizes.")}function v(){if(window.localStorage.getItem("run_before"))E(!0);else{window.localStorage.setItem("run_before","true");var a=new DialogBox("Welcome!","Welcome to the Eclipse Explorer App, may your skies be clear! Never look at the Sun, eclipsed or not, without proper and certificated eye protection. ");a.hideCloseButton();
e.hideSpinner();a.setOKCallBack(function(){var a=new DialogBox("Location Information Request","This app requires the use of location information, please enable this feature when prompted.");a.hideCloseButton();a.setOKCallBack(function(){E(!0)});a.showModal()});a.showModal()}}function p(){c.getZoom()>=c.getMaxZoom()?ib.prop("disabled",!0):ib.prop("disabled",!1);c.getZoom()<=c.getMinZoom()?jb.prop("disabled",!0):jb.prop("disabled",!1)}function D(){var a=sa.width(),b=$(document).width();return.6<a/b?
!0:!1}function A(){Bb=Intl.DateTimeFormat().resolvedOptions().timeZone}function P(){Ba.hide();kb.hide();lb.show();mb.show();nb.show()}function H(){Oa.hide();Pa.hide()}function t(){kb.show();Ba.show();lb.hide();mb.hide();nb.hide();H()}function h(){q.isAnimating()||(I?(P(),ya()):Cb())}function ya(){if(L)switch(Oa.show(),Pa.show(),ba){case 0:Ca();break;case 1:ob();break;case 2:Db();break;case 3:Eb();break;case 4:pb();break;default:goMidConactPoint()}else switch(H(),ba){case 0:Ca();break;case 1:ob();
break;case 4:pb();break;default:Ca()}}function za(){c.setOnlineMap();1===e.getCurrentPageIndex()&&sa.show();Qa.removeClass("eclipse-offline-button-placement-transition")}function qa(){ta.removeClass("eclipse-card-text-show");ua.removeClass("eclipse-card-text-show");va.removeClass("eclipse-card-text-show")}function Z(){var a=$(window).width(),b=Y(),m=b,d=$(window).height(),y=b,f=!1;console.log("Map extras shown.");n.hasClass("eclipse-show-circumstances-vertical")||n.hasClass("eclipse-show-circumstances-horizontal")||
n.hasClass("eclipse-show-circumstances-vertical-clean")||r.css("visibility","hidden");d>a?(f=!0,n.hasClass("eclipse-show-circumstances-vertical")||n.hasClass("eclipse-show-circumstances-vertical-clean"),e.isHeaderFooterShown()?(n.removeClass("eclipse-show-circumstances-vertical-clean"),n.addClass("eclipse-show-circumstances-vertical"),m*=.75):(n.removeClass("eclipse-show-circumstances-vertical"),n.addClass("eclipse-show-circumstances-vertical-clean"),m*=.6),n.removeClass("eclipse-show-circumstances-horizontal"),
Q.removeClass("eclipse-map-circumstances-horizontal"),aa.height(m),aa.css("min-height",m+"px"),x.removeClass("eclipse-simulation-map-show-horizontal"),x.removeClass("eclipse-simulation-map-show-horizontal-tablet"),x.addClass("eclipse-simulation-map-show"),F.css("left",""),C.css("left",""),C.css("transform","")):(n.hasClass("eclipse-show-circumstances-horizontal"),n.addClass("eclipse-show-circumstances-horizontal"),n.removeClass("eclipse-show-circumstances-vertical"),n.removeClass("eclipse-show-circumstances-vertical-clean"),
Q.addClass("eclipse-map-circumstances-horizontal"),aa.height("calc("+m+"px + 5em)"),aa.css("min-height","calc("+m+"px + 5em)"),x.removeClass("eclipse-simulation-map-show"),1024>a?(x.removeClass("eclipse-simulation-map-show-horizontal-tablet"),x.addClass("eclipse-simulation-map-show-horizontal")):(x.removeClass("eclipse-simulation-map-show-horizontal"),x.addClass("eclipse-simulation-map-show-horizontal-tablet")));r.addClass("eclipse-move-eclipse-type");Ra.hide();Sa.hide();a=0;ca.is(":visible")?(a=
ca.offset().top,r.css("float",""),r.css("transform","")):(a=r.offset().top,r.css("float","none"),r.css("transform","translateX(0)"));f?(y=a-e.getHeaderHeight()-6,da.css("bottom","calc("+(d-y)+"px - 2em)")):(y=b,da.css("bottom","5em"));Q.height(y);c.updateSize();ra.css("box-shadow","4px 4px 4px 4px #888888");Ta();n.transitionEndOff();n.transitionEndOne(function(){if(ca.is(":visible")){var a=ca.offset().top;r.css("float","");r.css("transform","")}else a=r.offset().top,r.css("float","none"),r.css("transform",
"translateX(0)");var m=a-24;f?(R.css("top","calc("+m+"px - 1.2em"),F.css("top","calc("+m+"px - 1.2em"),y=a-e.getHeaderHeight()-6,da.css("bottom","calc("+(d-y)+"px - 2em)")):(a=ca.width(),0===a&&(a=r.width()),R.css("top",""),F.css("top",""),F.css("left","calc("+a+"px + 3em"),y=b,da.css("bottom","5em"),C.css("left","calc("+a+"px + 25%"),C.css("transform","translateX(0%)"));Q.height(y);c.updateSize();r.css("visibility","");console.log("Delayed map resize: "+y)})}function pa(){n.removeClass("eclipse-show-circumstances-vertical");
n.removeClass("eclipse-show-circumstances-vertical-clean");n.removeClass("eclipse-show-circumstances-horizontal");Q.removeClass("eclipse-map-circumstances-horizontal");r.removeClass("eclipse-move-eclipse-type");x.removeClass("eclipse-simulation-map-show");x.removeClass("eclipse-simulation-map-show-horizontal");x.removeClass("eclipse-simulation-map-show-horizontal-tablet");R.css("top","");F.css("top","");F.css("left","");C.css("left","");C.css("transform","");r.css("float","");r.css("transform","");
Ra.show();Sa.show();ra.css("box-shadow","")}function xa(){console.log("Binding Eclipse UI events.");window.setInterval(A,3E4);tc.click(qa);uc.click(qa);Aa.click(function(){$(this).is(":checked")?console.log("Box is checked."):(console.log("Box is not checked."),pa(),da.css("bottom",""));k()});vc.click(function(){va.removeClass("eclipse-card-text-show");ua.removeClass("eclipse-card-text-show");ta.hasClass("eclipse-card-text-show")?ta.removeClass("eclipse-card-text-show"):ta.addClass("eclipse-card-text-show")});
wc.click(function(){ta.removeClass("eclipse-card-text-show");va.removeClass("eclipse-card-text-show");ua.hasClass("eclipse-card-text-show")?ua.removeClass("eclipse-card-text-show"):ua.addClass("eclipse-card-text-show")});xc.click(function(){ta.removeClass("eclipse-card-text-show");ua.removeClass("eclipse-card-text-show");va.hasClass("eclipse-card-text-show")?va.removeClass("eclipse-card-text-show"):va.addClass("eclipse-card-text-show")});yc.click(function(){Da.height("100vh");Da.addClass("material-other-page-show")});
zc.click(function(){Da.removeClass("material-other-page-show");Da.transitionEndOne(function(){Da.height("0");qa()})});Ba.click(function(){qb?(qb=!1,Ba.html("3D Globe (Experimental)"),c.disableGlobe()):(qb=!0,Ba.html("2D Map"),c.enableGlobe())});Qa.click(function(){console.log("Attempt to restart online map.");Ea=!0;za();window.setTimeout(function(){Ea=!1},500)});c.onTileLoadError(function(){!Ea&&c.isMapOnline()&&(Ea=!0,console.log("Map possibly gone offline."),c.setOfflineMap(),1===e.getCurrentPageIndex()&&
sa.hide(),Qa.hasClass("eclipse-offline-button-placement-transition")||Qa.addClass("eclipse-offline-button-placement-transition"),M("Connection lost. Going to offline mode."),window.setTimeout(function(){Ea=!1},1E3))});e.onBeforePageChange(function(a){console.log("Before page change.");pa()});e.onPageChange(function(a){console.log("Page change fired.");t();rb.hide();sa.hide();e.enableYScroll();k();console.log("Removing contact point.");l.css("visibility","hidden");1===a.currentPageIdx?(console.log("Map page displayed."),
console.log("Page change to map."),e.disableYScroll(),c.updateSize(),c.isMapOnline()&&sa.show(),rb.show(),S(),Aa.is(":checked")&&Z()):2===a.currentPageIdx?(console.log("Simulation page displayed."),l.css("visibility",""),e.disableYScroll(),rb.show(),h(),Ta()):(console.log("Circumstances page displayed."),z())});lb.click(function(){w&&(w=!1,z(),ob(),B())});Oa.click(function(){w&&(w=!1,z(),Db(),B())});mb.click(function(){w&&(w=!1,z(),Ca(),B())});Pa.click(function(){w&&(w=!1,z(),Eb(),B())});nb.click(function(){w&&
(w=!1,z(),pb(),B())});Fa.onmessage=Ac;N.setPositionCall(Bc);N.setErrorCall(Cc);Fb.click(function(){console.log("Location icon clicked.");N.isOn()?E(!1):E(!0)});Q.longPress(Dc);window.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1};Ga.click(function(a){w&&(w=!1,Gb.transitionEndOne(function(a){Hb()}),B())});e.onHeaderChange(function(a){console.log("Header change.");k()});e.onWindowResize(function(a){console.log("UI: Window height change.");k();Ta();ea.is(":focus")?D()?(fa.hasClass("eclipse-hide-header-text")||
fa.addClass("eclipse-hide-header-text"),ga.hasClass("eclipse-hide-header-text")||ga.addClass("eclipse-hide-header-text"),e.isDrawerButtonSpun()||e.spinBackDrawerButton(),Ha.parent("label").hide()):(fa.removeClass("eclipse-hide-header-text"),ga.removeClass("eclipse-hide-header-text"),Ha.parent("label").show(),e.unSpinDrawerButton()):(fa.removeClass("eclipse-hide-header-text"),ga.removeClass("eclipse-hide-header-text"),e.unSpinDrawerButton(),Ha.parent("label").show())});e.onDrawerOpen(function(a){console.log("Drawer opened.");
Ib($(Ia.children("li")[W]))});e.onDrawerClosed(function(a){console.log("Drawer closed.")});Ec.click(function(a){Jb()});Fc.click(function(a){0!==u&&(u=0,ha.removeClass("eclipse-time-travel-font"),M("Returning to present time!"),z());S()});Gc.longPress(function(a){O&&(u=0,z(),u=O.getTime()-(new Date).getTime()-1E4,ha.addClass("eclipse-time-travel-font"),e.changePage(1),M("Time traveling to partial eclipse begins!"),S())});sb.longPress(function(a){L&&(u=0,z(),u=L.getTime()-(new Date).getTime()-1E4,ha.addClass("eclipse-time-travel-font"),
e.changePage(1),M("Time traveling to "+d.type+" eclipse begins!"),S())});Hc.longPress(function(a){I&&(u=0,z(),u=I.getTime()-(new Date).getTime()-1E4,ha.addClass("eclipse-time-travel-font"),e.changePage(1),M("Time traveling to mid eclipse!"),S())});tb.longPress(function(a){X&&(u=0,z(),u=X.getTime()-(new Date).getTime()-1E4,ha.addClass("eclipse-time-travel-font"),e.changePage(1),M("Time traveling to "+d.type+" eclipse ends!"),S())});Ic.longPress(function(a){T&&(u=0,z(),u=T.getTime()-(new Date).getTime()-
1E4,ha.addClass("eclipse-time-travel-font"),e.changePage(1),M("Time traveling to end of eclipse!"),S())});Jc.click(function(a){-1<ub&&gb(ub)});vb.click(function(a){wa?f():(vb.children("i").html("my_location"),wa=!0,c.setCenter(g))});ib.click(function(a){c.zoomIn()});jb.click(function(a){c.zoomOut()});c.onDragStart(function(a){wb=!0;console.log("Map drag started.")});c.onDragEnd(function(a){15<a.distance?f():wa&&c.setCenter(g);wb=!1;console.log("Map drag ended.")});Q.keydown(function(a){40>=a.keyCode&&
37<=a.keyCode&&(f(),console.log("Map arrow key event."))});c.onZoomEnd(function(a){console.log("ZOOM LEVEL: "+c.getZoom());p();wa&&c.setCenter(g)});c.onRedrawCall(function(a){console.log("Redraw call!");Ua.reDraw();Va.reDraw();Wa.reDraw();Xa.reDraw();Ya.reDraw();Za.reDraw();$a.reDraw();Ja&&Ja.reDraw();Ka&&Ka.reDraw();for(a=0;a<J.length;a++)J[a].reDraw()});e.onMDLComplete(function(){console.log("MDL Complete callback.");e.toggleHeaderFooter(!0)});ea.focus(function(a){F.hide();R.hide();C.hide();D()&&
(fa.addClass("eclipse-hide-header-text"),ga.addClass("eclipse-hide-header-text"),e.spinBackDrawerButton(),Ha.parent("label").hide());ia=null;xb.addClass("eclipse-map-search-list-show");ea.val("");U.eq(0).addClass("eclipse-disabled-text");U.eq(0).children("span").html("Searching locations...");for(a=1;a<U.length;a++)U.eq(a).children("span").html("")});ea.focusout(function(a){F.show();R.show();C.show();ea.val("");sa.removeClass("is-dirty");xb.removeClass("eclipse-map-search-list-show");fa.removeClass("eclipse-hide-header-text");
ga.removeClass("eclipse-hide-header-text");e.unSpinDrawerButton();Ha.parent("label").show()});U.click(function(a){console.log("Map search click fired.");ia?(a=$(this).index(),a<ia.length&&(console.log("Item: "+a),E(!1),ab(new Position(parseFloat(ia[a].lat),parseFloat(ia[a].lon))),ia=null)):M("No valid city selected.")});ea.on("input",function(a){a=encodeURIComponent(ea.val());console.log("Search box value: "+a);a="https://nominatim.openstreetmap.org/search?q=QUERY&format=json&limit=3".replace("QUERY",
a);$.getJSON(a,function(){console.log("Initial JSON success.")}).done(function(a){ia=a;U.eq(0).removeClass("eclipse-disabled-text");for(var b=0;b<a.length;b++)U.eq(b).children("span").html(a[b].display_name);for(b=U.length;b>a.length&&0<b;b--)U.eq(b-1).children("span").html("");console.log("Second JSON success.")}).fail(function(){console.log("JSON error.")}).always(function(){console.log("JSON complete.")})})}function f(){wa=!1;vb.children("i").html("location_searching")}function sc(){Ia.children("li").click(function(a){gb(parseInt($(this).attr("eclipse-index"),
10));e.toggleDrawer();console.log("Selected eclipse: "+W)})}function gb(a){Ga.hide();ja.clickOff();ja.attr("disabled",!0);-1<W&&($(Ia.children("li")[W]).removeClass("eclipse-selected"),d.destroy());W=a;d=La.getEclipse(W);z();q.reset();Kb();a=JSON.stringify(d);Fa.postMessage({cmd:"eclipse",eclipse:a});console.time("DrawLines");Kc.updateLines(a);a=d;fa.html(a.type+" Solar Eclipse");ga.html(a.maxEclipseDate.toLocaleDateString("en-US",Lc));a=$(Ia.children("li")[W]);a.addClass("eclipse-selected");Ib(a)}
function Jb(){gb(La.getNextEclipseIdx());console.log("Found next eclipse: "+W)}function Ac(a){var b=a.data;switch(b.cmd){case "eclipse_stats_update":a=new ObserverCircumstances(JSON.parse(b.eclipse_stats));var c=new Date;c.setTime(c.getTime()+u);if(a.isVisible){O=d.toDate(a.circDates.getC1Date());I=d.toDate(a.circDates.getMidDate());T=d.toDate(a.circDates.getC4Date());c={};G&&(c={timeZone:G,timeZoneName:"short"});var f=parseFloat(b.solar_elevation);if(null===JSON.parse(b.sunrise)){ka=null;var y=0<=
f?"Sun is Up":"Sun is Down"}else ka=new Date(JSON.parse(b.sunrise)),y=ka.toLocaleTimeString("en-US",c);null===JSON.parse(b.sunset)?(la=null,b=0<=f?"Sun is Up":"Sun is Down"):(la=new Date(JSON.parse(b.sunset)),b=la.toLocaleTimeString("en-US",c));Mc.html(y);Nc.html(b);ca.show(0);hb.show(0);Lb.show(0);Mb.hide(0);Nb.css({background:"url('images/"+a.eclipseType.toLowerCase()+".png')","background-size":"contain"});Ra.html(a.eclipseType+" Eclipse Occurs");Sa.html(I.toLocaleDateString("en-US",{year:"numeric",
month:"long",day:"numeric"}));Ob.html(a.coverage.toFixed(1)+"%");Pb.html(a.magnitude.toFixed(1)+"%");Oc.html(O.toLocaleTimeString("en-US",c));Pc.html(I.toLocaleTimeString("en-US",c));Qc.html(T.toLocaleTimeString("en-US",c));b=ka;y=la;b=a.firstContactBelowHorizon&&a.fourthContactBelowHorizon?new TimeSpan(b,y):a.firstContactBelowHorizon&&!a.fourthContactBelowHorizon?new TimeSpan(b,d.toDate(a.circDates.getC4Date())):!a.firstContactBelowHorizon&&a.fourthContactBelowHorizon?new TimeSpan(d.toDate(a.circDates.getC1Date()),
y):a.c1c4TimeSpan;Rc.html(b.toTimeString());a.firstContactBelowHorizon?Qb.show(0):Qb.hide(0);a.midEclipseBelowHorizon?Rb.show(0):Rb.hide(0);a.fourthContactBelowHorizon?Sb.show(0):Sb.hide(0);"Annular"===a.eclipseType||"Total"===a.eclipseType?(L=d.toDate(a.circDates.getC2Date()),X=d.toDate(a.circDates.getC3Date()),b=a.depth.toFixed(1)+"%",b=a.northOfCenter?b+" N":b+" S",sb.show(0),tb.show(0),bb.show(0),yb.show(0),bb.html(b),Sc.html(a.eclipseType+" Phase Begins"),Tc.html(a.eclipseType+" Phase Ends"),
Uc.html(L.toLocaleTimeString("en-US",c)),Vc.html(X.toLocaleTimeString("en-US",c)),c=ka,b=la,c=a.secondContactBelowHorizon&&a.thirdContactBelowHorizon?new TimeSpan:a.secondContactBelowHorizon&&!a.thirdContactBelowHorizon?new TimeSpan(c,a.circDates.getC3Date()):!a.secondContactBelowHorizon&&a.thirdContactBelowHorizon?new TimeSpan(a.circDates.getC2Date(),b):a.c2c3TimeSpan,Wc.html(c.toTimeString()),a.secondContactBelowHorizon?Tb.show(0):Tb.hide(0),a.thirdContactBelowHorizon?Ub.show(0):Ub.hide(0),2===
e.getPageIndex()&&(Oa.show(),Pa.show())):(H(),X=L=null,Vb.html(""),Wb.html(""),bb.hide(0),yb.hide(0),sb.hide(0),tb.hide(0));zb();q.isAnimating()||ya();2===e.getPageIndex()&&P()}Xb!==a.eclipseType&&(Xb=a.eclipseType,console.log("Eclipse type change."),a.isVisible?K.removeClass("eclipse-moon-invisible"):(Yb(),t(),Cb(),T=I=O=null,Zb.html(""),$b.html(""),ac.html(""),bc.html(""),cc.html(""),ca.hide(0),hb.hide(0),Lb.hide(0),Ra.html("No Eclipse Occurs"),Mb.show(0),Ob.html("0.0%"),Pb.html("0.0%"),bb.hide(0),
yb.hide(0),Sa.html(""),Nb.css({background:"url('images/no-eclipse.png')","background-size":"contain"})),k());break;case "visible_index_update":cb=JSON.parse(b.visible_array);ub=parseInt(b.next_visible,10);Ma&&dc();break;default:console.log("Unknow calculate message command.")}}function Xc(){var a=d.getNorthUmbraLine(),b=d.getSouthUmbraLine(),m=d.getNorthPenumbraLine(),e=d.getSouthPenumbraLine(),f=d.getEastLimitLine(),g=d.getWestLimitLine(),h={stroke_color:"red"};a&&b&&(Ka=c.addGreatCircle(a[0],b[0],
h),Ja=c.addGreatCircle(a[a.length-1],b[b.length-1],h));e&&g&&(a=c.addGreatCircle(g[0],e[0],h))&&J.push(a);e&&f&&(a=c.addGreatCircle(e[e.length-1],f[0],h))&&J.push(a);f&&m&&(a=c.addGreatCircle(f[f.length-1],m[m.length-1],h))&&J.push(a);m&&g&&(a=c.addGreatCircle(m[0],g[g.length-1],h))&&J.push(a);!m&&g&&f&&(a=c.addGreatCircle(g[g.length-1],f[f.length-1],h))&&J.push(a);!e&&g&&f&&(a=c.addGreatCircle(g[0],f[0],h))&&J.push(a)}function Kb(){Ua=c.removeFeature(Ua);Va=c.removeFeature(Va);Wa=c.removeFeature(Wa);
Xa=c.removeFeature(Xa);Ya=c.removeFeature(Ya);Za=c.removeFeature(Za);$a=c.removeFeature($a);Ka=c.removeFeature(Ka);Ja=c.removeFeature(Ja);for(var a=0;a<J.length;a++)c.removeFeature(J[a]);J.length=0;console.log("Eclipse lines removed.")}function Dc(){console.log("Toggle click fired.");db=!0;window.setTimeout(function(){db=!1},1200);e.toggleHeaderFooter()?(ec.removeClass("eclipse-main-expand"),fc.removeClass("eclipse-section-expand"),da.addClass("eclipse-map-button-placement-transition"),gc.addClass("eclipse-zoom-button-placement-transition"),
x.css("top",""),F.css("bottom",""),R.css("bottom",""),C.css("top",""),Aa.is(":checked")&&Z()):(ec.addClass("eclipse-main-expand"),da.removeClass("eclipse-map-button-placement-transition"),gc.removeClass("eclipse-zoom-button-placement-transition"),fc.addClass("eclipse-section-expand"),Aa.is(":checked")&&Z(),x.css("top","calc(0px - 90vh)"),F.css("bottom","0.2em"),R.css("bottom","0.25em"),C.css("top","1em"))}function S(a){if(d){var b=new Date;b.setTime(b.getTime()+u);if(d.isEclipseOccurring(b)&&!q.isAnimating())return Ga.show(),
a||q.isAnimating()||Hb(),!0;a||q.isAnimating()||z();Ga.hide();C.removeClass("eclipse-realtime-shadow-trans");Ca()}return!1}function hc(){l.removeClass("eclipse-sim-info-trans")}function Cb(){t();l.hasClass("eclipse-sim-info-trans")||l.addClass("eclipse-sim-info-trans");l.children("span").html("Eclipse Not Visible");Yb()}function ob(){ba=1;O&&(q.getMoonPosition(O,g,ma),l.hasClass("eclipse-sim-info-trans")||l.addClass("eclipse-sim-info-trans"),l.children("span").html("First Contact"))}function Db(){ba=
2;L&&(q.getMoonPosition(L,g,ma),l.hasClass("eclipse-sim-info-trans")||l.addClass("eclipse-sim-info-trans"),l.children("span").html("Second Contact"))}function Ca(){console.log("Mid contact point simulation.");ba=0;I&&(q.getMoonPosition(I,g,ma),l.hasClass("eclipse-sim-info-trans")||l.addClass("eclipse-sim-info-trans"),l.children("span").html("Mid Eclipse"))}function Eb(){ba=3;O&&(q.getMoonPosition(X,g,ma),l.hasClass("eclipse-sim-info-trans")||l.addClass("eclipse-sim-info-trans"),l.children("span").html("Third Contact"))}
function pb(){ba=4;T&&(q.getMoonPosition(T,g,ma),l.hasClass("eclipse-sim-info-trans")||l.addClass("eclipse-sim-info-trans"),l.children("span").html("Fourth Contact"))}function zb(){var a=new Date;a.setTime(a.getTime()+u);var b={timeZone:Bb,timeZoneName:"short"};G&&(b={timeZone:G,timeZoneName:"short"});var b=a.toLocaleTimeString("en-US",b),c=b.slice(-3),b=b.slice(0,-4);ha.html(b);Yc.html(c);c=b="--:--:--";ka&&(b=(new TimeSpan(ka,a)).toTimeString());la&&(c=(new TimeSpan(la,a)).toTimeString());Zb.html(b);
cc.html(c);O&&(b=new TimeSpan(O,a),$b.html(b.toTimeString()));I&&(b=new TimeSpan(I,a),ac.html(b.toTimeString()));T&&(b=new TimeSpan(T,a),bc.html(b.toTimeString()));L&&(b=new TimeSpan(L,a),Vb.html(b.toTimeString()));X&&(a=new TimeSpan(X,a),Wb.html(a.toTimeString()))}function Zc(a){a=a.data;switch(a.cmd){case "eclipse_load_complete":La.copyEclipsesIn(JSON.parse(a.eclipse_data));Fa.postMessage({cmd:"update_catalog",catalog:La.eclipseToJSON()});console.log("Eclipse UI load complete: "+La.getEclipseCount()+
" eclipses loaded.");break;case "eclipse_html_complete":Ia.html(a.eclipse_data);null!==V&&(V.terminate(),V=null,console.log("Terminated eclipse loader thread."));e.hideSpinner();Q.show();x.css("visibility","");Ma=$(".visible-class");console.log("Icon count: "+Ma.length);sc();cb&&dc();Jb();break;case "eclipse_load_error":null!==V&&(V.terminate(),V=null),console.log("Eclipse loader error: "+a.status),e.hideSpinner()}}function dc(){Ma.hide();for(var a=0;a<cb.length;a++)$(Ma[cb[a]]).show()}function Bc(a){ab(a)}
function ab(a){g=a;g.altitude&&(eb=g.altitude);a={latitude:g.latitude,longitude:g.longitude,altitude:eb};ic.html(g.latitude.toFixed(2));jc.html(g.longitude.toFixed(2));kc.html((3.28084*eb).toFixed(2));q.setCoords(a);Fa.postMessage({cmd:"coords",coords:JSON.stringify(a)});$c.setLocation(g);wa&&!wb&&c.setCenter(g);if(N.isOn())A(),G&&(G="");else try{G=lc.lookup(g.latitude,g.longitude),console.log("New timezone: "+G)}catch(b){console.log("Time zone DB not ready... trying again in 1 second."),window.setTimeout(function(){G=
lc.lookup(g.latitude,g.longitude);console.log("New timezone: "+G)},1E3)}console.log("Position updated!")}function E(a){a?N.isOn()||(c.clickOff(),N.onFirstPostion(function(){mc.html("location_on");M("GPS Mode On.")}),N.startWatch()):(N.isOn()&&N.clearWatch(),c.clickOff(),c.onClick(function(a){console.log("Map click fired.");db?db=!1:(console.log("Clicked at: "+a.latitude+", "+a.longitude),ab(a))}),mc.html("location_off"),M("Position in manual mode."))}function Cc(a){N.clearWatch();console.log("Position UI error:"+
a.code);var b=new DialogBox("Location Error");b.setOKText("Retry");b.setCloseText("Cancel");a.code===a.PERMISSION_DENIED?(b.setDescriptionText("This app requires the use of location information, please enable this feature in the app's permission settings. Click Retry to try again. Otherwise click Cancel."),b.setOKCallBack(function(){E(!0)}),b.setCloseCallBack(function(){E(!1)})):a.code===a.POSITION_UNAVAILABLE?(E(!0),b.setDescriptionText("Location services are unavailable. Press Cancel to run location in manual mode.  Press retry to try again."),
b.setOKCallBack(function(){E(!0)}),b.setCloseCallBack(function(){E(!1)})):a.code===a.TIMEOUT&&(b.setDescriptionText("Location services timed out. Press Cancel to run location in manual mode.  Press retry to try again."),b.setCloseCallBack(function(){E(!0)}),b.setCloseCallBack(function(){E(!1)}));e.hideSpinner();b.showModal()}function Ib(a){var b=a.parent();a[0].scrollIntoView();var c=Math.round(b.scrollTop()),e=b[0].scrollHeight,d=Math.round(b.height()/2),f=e-Math.round(b.height())-Math.round(a.height());
a=Math.round(a.position().top);c<d?b.scrollTop(0):c>d&&c<f?b.scrollTop(c-d):a<d?b.scrollTop(c-d+(c-f)):b.scrollTop(e)}function M(a){try{nc.MaterialSnackbar.showSnackbar({message:a,timeout:2E3,actionText:"Dismiss",actionHandler:function(){nc.classList.remove("mdl-snackbar--active")}})}catch(b){console.log("Toast: "+a),console.log("Unable to show toast, MDL probably not yet ready.")}}function oc(){F.addClass("eclipse-map-times-local-trans");R.addClass("eclipse-map-times-zulu-trans")}function Ab(a){G?
pc.html(a.toLocaleTimeString("en-US",{timeZone:G,timeZoneName:"short"})):pc.html(a.toLocaleTimeString());a=a.toLocaleTimeString("en-US",{timeZone:"UTC",timeZoneName:"short"});a=a.replace(" GMT","");ad.html(a)}function Hb(){hc();Ga.hide();C.addClass("eclipse-realtime-shadow-trans");ja.html("Stop Animation");Ab(d.getPenumbraStartTime());oc();q.start(qc,ma,{realTime:!0,dateOffset:u})}function z(){S(!0);C.removeClass("eclipse-realtime-shadow-trans");F.removeClass("eclipse-map-times-local-trans");R.removeClass("eclipse-map-times-zulu-trans");
ja.html("Animate Shadow");q.stop();na=c.removeFeature(na);oa=c.removeFeature(oa);2===e.getCurrentPageIndex()&&h();console.log("Animation stopped.")}function ma(a){fb=a.moon_pos;Na=a.sun_pos;Ta()}function Ta(){var a=ra.width(),b=ra.offset();var c=fb.diameter/Na.diameter*100;var d=a/Na.diameter,e=fb.ra-Na.ra;b.top=-1*(fb.decl-Na.decl)*d/a*100+"%";b.left=-1*e*d/a*100+"%";K.width(c+"%");K.height(c+"%");K.css("top",b.top);K.css("left",b.left);a=(100-c)/2+"%";K.css("transform","translate("+a+", "+a+")")}
function Yb(){K.hasClass("eclipse-moon-invisible")||K.addClass("eclipse-moon-invisible")}function qc(a){null!==a.umb_shadow?oa?oa.setCoordinates(a.umb_shadow):oa=c.addPolygon(a.umb_shadow,{fill_color:"rgba(0, 0, 0, 0.75)"}):oa=c.removeFeature(oa);null!==a.pen_shadow?na?na.setCoordinates(a.pen_shadow):na=c.addPolygon(a.pen_shadow,{fill_color:"rgba(0, 0, 0, 0.2)"}):na=c.removeFeature(na);Ab(a.date)}var Lc={timeZone:"UTC",year:"numeric",month:"long",day:"numeric"},rc={latitude:34,longitude:-118,altitude:0},
ba=0,lc=new TimeZone,G="",Bb=Intl.DateTimeFormat().resolvedOptions().timeZone,e=new MaterialAddons,La=new Eclipses,c=new EasyMap("map",4,rc),V=null,d=null,ia=null,Xb="",N=new WatchPosition,g=rc,eb=0,u=0,ka=null,la=null,O=null,L=null,I=null,X=null,T=null,cb=null,fb=0,Na=0,W=-1,ub=-1,db=!1,wa=!0,wb=!1,Ea=!1,Q=$("#map"),aa=$("#circumstances"),ec=$("#app-content"),x=$("#simulation-tab"),ra=$("#sun"),K=$("#moon"),Ia=$("#eclipse_list"),fa=$("#eclipse-title"),ga=$("#eclipse-title-date"),Ec=$("#next-button"),
Jc=$("#visible-button"),nc=document.querySelector("#snackbar"),vb=$("#map-location-button"),ib=$("#map-zoom-in-button"),jb=$("#map-zoom-out-button"),fc=$("#map-tab"),da=$("#map-buttons"),gc=$("#zoom-buttons"),Qa=$("#map-offline-button"),Fc=$("#time-button"),yc=$("#about-link"),Da=$("#about-page"),zc=$("#about-back-button"),kb=$("#show-extras"),Aa=kb.children("label").children("input"),n=$("#circumstances-tab"),r=$("#eclipse-type-header"),rb=$("#map-menu-button"),ja=$("#animate-shadow"),Ga=$("#realtime-animate"),
lb=$("#first-contact-sim"),Oa=$("#second-contact-sim"),mb=$("#mid-eclipse-sim"),Pa=$("#third-contact-sim"),nb=$("#fourth-contact-sim"),Ba=$("#globe"),w=!0,qb=!1,F=$("#local-time-pop"),R=$("#zulu-time-pop"),pc=$("#local-animate-time"),ad=$("#zulu-animate-time"),C=$("#realtime-shadow"),l=$("#contact-point"),Gb=$("#map-menu"),Fb=$("#location-icon"),mc=Fb.children("i"),sa=$("#map-search-box"),ea=$("#map-search-input"),xb=$("#map-search-menu"),U=xb.children("li"),Ha=$("#search-icon"),Ma=null,Mc=$("#sunrise_time"),
Nc=$("#sunset_time"),ca=$("#stats_block"),hb=$("#time_block"),Lb=$("#time_block2"),Mb=$("#not_visible"),Nb=$("#eclipse_pic"),Ra=$("#eclipse_type"),Sa=$("#eclipse_date"),Ob=$("#coverage"),Pb=$("#magnitude"),bb=$("#depth"),yb=$("#depth_title"),Oc=$("#c1_time"),Uc=$("#c2_time"),Pc=$("#mid_time"),Vc=$("#c3_time"),Qc=$("#c4_time"),Qb=$("#c1_horiz"),Tb=$("#c2_horiz"),Rb=$("#mid_horiz"),Ub=$("#c3_horiz"),Sb=$("#c4_horiz"),Zb=$("#sunrise_count"),$b=$("#c1_count"),Vb=$("#c2_count"),ac=$("#mid_count"),Wb=$("#c3_count"),
bc=$("#c4_count"),cc=$("#sunset_count"),Rc=$("#entire_duration"),Wc=$("#total_duration");$("#sunrise");var Gc=$("#partial-begins"),sb=$("#total_begins"),Hc=$("#mid-eclipse"),tb=$("#total_ends"),Ic=$("#partial-ends");$("#sunset");var Sc=$("#type_div_start"),Tc=$("#type_div_ends"),ic=$("#lat"),jc=$("#long"),kc=$("#alt"),ha=$("#time"),Yc=$("#zone"),tc=$("#help-info"),uc=$("#more-info"),vc=$("#disclaimer"),ta=$("#disclaimer-text"),wc=$("#privacy"),ua=$("#privacy-text"),xc=$("#open-source"),va=$("#open-source-text"),
Ua=c.addMultiPolyLine(),Va=c.addMultiPolyLine(),Wa=c.addMultiPolyLine(),Xa=c.addMultiPolyLine(),Ya=c.addMultiPolyLine(),Za=c.addMultiPolyLine(),$a=c.addMultiPolyLine(),Ka=null,Ja=null,J=[],oa=null,na=null;zb();ic.html(g.latitude.toFixed(2));jc.html(g.longitude.toFixed(2));kc.html((3.28084*eb).toFixed(2));window.setInterval(zb,1E3);var Fa=new Worker("calculateWorker.js"),q=new ShadowAnimator,Kc=new LineWorkers(function(a){switch(a.type){case "central_line":Ua=c.addMultiPolyLine(a.line);d.setCentralLine(a.line);
d.setCentralLineTimes(a.times);break;case "south_umbra_line":Va=c.addMultiPolyLine(a.line);d.setSouthUmbraLine(a.line);d.setSouthUmbraTimes(a.times);break;case "north_umbra_line":Wa=c.addMultiPolyLine(a.line);d.setNorthUmbraLine(a.line);d.setNorthUmbraTimes(a.times);break;case "south_penumbra_line":Xa=c.addMultiPolyLine(a.line,{stroke_color:"red"});d.setSouthPenumbraLine(a.line);break;case "north_penumbra_line":Ya=c.addMultiPolyLine(a.line,{stroke_color:"red"});d.setNorthPenumbraLine(a.line);break;
case "east_penumbra_line":Za=c.addMultiPolyLine(a.line,{stroke_color:"red"});d.setEastLimitLine(a.line);d.setEastLineTimes(a.times);break;case "west_penumbra_line":$a=c.addMultiPolyLine(a.line,{stroke_color:"red"});d.setWestLimitLine(a.line);d.setWestLineTimes(a.times);break;default:console.log("Unknown or invalid line type returned from line workers.")}console.log(a.type+" line drawn.")},function(a){console.log("Eclipse lines drawing now complete: "+a);10<d.getPointCount()?(Xc(),q.setEclipse(d),
d.getEastLimitLine(),console.timeEnd("DrawLines"),ja.click(function(a){w&&(w=!1,Gb.transitionEndOne(function(a){q.isAnimating()?(z(),S(!0)):(hc(),f(),ja.html("Stop Animation"),Ab(d.getPenumbraStartTime()),oc(),q.start(qc,ma),a={latitude:d.midEclipsePoint.latitude,longitude:d.midEclipsePoint.longitude},45<a.latitude&&(a.latitude=45),-45>a.latitude&&(a.latitude=-45),c.setCenter(a),c.setZoom(3))}),B())}),ja.removeAttr("disabled")):(console.log("Not enough points"),Kb(),a=new DialogBox("Pardon Our Error",
"Unfortunately the eclipse circumstance lines could not be displayed for this eclipse. This usually occurs with a partial eclipse that only occurs near the poles. This is a known error and limitation. It is currently being investigated.Circumstance data, timings, and simulations should still work.","OK"),a.hideCloseButton(),a.showModal())});Fa.postMessage({cmd:"coords",coords:JSON.stringify(g)});var $c=c.addMarker(g,"images/loc24.png");ab(g);k();this.init=function(){e.disableSwipe(1);xa();v();p();
za();console.log("Spawning eclipse loader thread.");e.showSpinner();null===V&&(V=new Worker("EclipseLoader.js"),V.onmessage=Zc)};this.forceResize=function(){k()}},WatchPosition=function(){function B(){t&&(navigator.geolocation.clearWatch(t),t=null)}function Y(h){P&&(P(h.coords),P=null);p=h.coords;A&&A(h.coords)}function k(h){console.log(h.message);B();D&&D(h)}var v={laitude:34,longitude:-118,altitude:0},p,D,A,P=null,H={enableHighAccuracy:!0,maximumAge:3E4,timeout:27E3},t=null;this.getError=function(){return 0};
this.getPosition=function(){return p?p:v};this.isOn=function(){return t?!0:!1};this.setErrorCall=function(h){D=h};this.setPositionCall=function(h){A=h};this.onFirstPostion=function(h){P=h};this.startWatch=function(){t||(t=navigator.geolocation.watchPosition(Y,k,H))};this.clearWatch=function(){B()}};$(function(){(new EclipseUI).init();$.getScript("ad_script.js");console.log("VERSION: 011")});