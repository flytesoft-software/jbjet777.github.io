"use strict";var D2R=Math.PI/180,R2D=180/Math.PI,Coord=function(t,e){this.lon=t,this.lat=e,this.x=D2R*t,this.y=D2R*e};Coord.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},Coord.prototype.antipode=function(){var t=-1*this.lat,e=this.lon<0?180+this.lon:-1*(180-this.lon);return new Coord(e,t)};var LineString=function(){this.coords=[],this.length=0};LineString.prototype.move_to=function(t){this.length++,this.coords.push(t)};var Arc=function(t){this.properties=t||{},this.geometries=[]};Arc.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1==this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],e=0;e<this.geometries.length;e++)t.push(this.geometries[e].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}},Arc.prototype.wkt=function(){for(var t="",e="LINESTRING(",r=0;r<this.geometries.length;r++){if(0===this.geometries[r].coords.length)return"LINESTRING(empty)";this.geometries[r].coords.forEach(t=>{e+=t[0]+" "+t[1]+","}),t+=e.substring(0,e.length-1)+")"}return t};var GreatCircle=function(t,e,r){if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new Coord(t.x,t.y),this.end=new Coord(e.x,e.y),this.properties=r||{};var s=this.start.x-this.end.x,i=this.start.y-this.end.y,o=Math.pow(Math.sin(i/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(s/2),2);if(this.g=2*Math.asin(Math.sqrt(o)),this.g==Math.PI)throw new Error("it appears "+t.view()+" and "+e.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)};if(GreatCircle.prototype.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),r=Math.sin(t*this.g)/Math.sin(this.g),s=e*Math.cos(this.start.y)*Math.cos(this.start.x)+r*Math.cos(this.end.y)*Math.cos(this.end.x),i=e*Math.cos(this.start.y)*Math.sin(this.start.x)+r*Math.cos(this.end.y)*Math.sin(this.end.x),o=e*Math.sin(this.start.y)+r*Math.sin(this.end.y),a=R2D*Math.atan2(o,Math.sqrt(Math.pow(s,2)+Math.pow(i,2)));return[R2D*Math.atan2(i,s),a]},GreatCircle.prototype.Arc=function(t,e){var r=[];if(!t||t<=2)r.push([this.start.lon,this.start.lat]),r.push([this.end.lon,this.end.lat]);else for(var s=1/(t-1),i=0;i<t;++i){var o=s*i,a=this.interpolate(o);r.push(a)}for(var h=!1,n=0,p=e&&e.offset?e.offset:10,c=180-p,l=-180+p,u=360-p,d=1;d<r.length;++d){var g=r[d-1][0],f=r[d][0],v=Math.abs(f-g);v>u&&(f>c&&g<l||g>c&&f<l)?h=!0:v>n&&(n=v)}var y=[];if(h&&n<p){var M=[];y.push(M);for(var w=0;w<r.length;++w){var m=parseFloat(r[w][0]);if(w>0&&Math.abs(m-r[w-1][0])>u){var x=parseFloat(r[w-1][0]),C=parseFloat(r[w-1][1]),G=parseFloat(r[w][0]),S=parseFloat(r[w][1]);if(x>-180&&x<l&&180==G&&w+1<r.length&&r[w-1][0]>-180&&r[w-1][0]<l){M.push([-180,r[w][1]]),w++,M.push([r[w][0],r[w][1]]);continue}if(x>c&&x<180&&-180==G&&w+1<r.length&&r[w-1][0]>c&&r[w-1][0]<180){M.push([180,r[w][1]]),w++,M.push([r[w][0],r[w][1]]);continue}if(x<l&&G>c){var A=x;x=G,G=A;var F=C;C=S,S=F}if(x>c&&G<l&&(G+=360),x<=180&&G>=180&&x<G){var L=(180-x)/(G-x),R=L*S+(1-L)*C;M.push([r[w-1][0]>c?180:-180,R]),(M=[]).push([r[w-1][0]>c?-180:180,R]),y.push(M)}else M=[],y.push(M);M.push([m,r[w][1]])}else M.push([r[w][0],r[w][1]])}}else{var b=[];y.push(b);for(var E=0;E<r.length;++E)b.push([r[E][0],r[E][1]])}for(var I=new Arc(this.properties),D=0;D<y.length;++D){var N=new LineString;I.geometries.push(N);for(var j=y[D],P=0;P<j.length;++P)N.move_to(j[P])}return I},"undefined"!=typeof module&&void 0!==module.exports)module.exports.Coord=Coord,module.exports.Arc=Arc,module.exports.GreatCircle=GreatCircle;else{var arc={};arc.Coord=Coord,arc.Arc=Arc,arc.GreatCircle=GreatCircle}