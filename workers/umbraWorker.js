"use strict";class UmbraWorker{constructor(){function e(e){l=new EclipseData(JSON.parse(e))}function t(e){var t=new EclipseData(JSON.parse(e.eclipse)),a=parseInt(e.dateOffset),r=null,n=null,i=t.getPenumbraStartTime(),o=t.getPenumbraEndTime(),s=!1,l=null;if("Annular"!==t.type&&"Total"!==t.type&&"Hybrid"!==t.type||(s=!0),s)var u=t.getUmbraStartTime(),d=t.getUmbraEndTime();for(isNaN(a)&&(a=0);go;)(l=new Date).setTime(l.getTime()+a),l>=i&&l<=o&&(r=t.drawPenumbraShadow(l)),s&&l.getTime()>=u&&l.getTime()<=d&&(n=t.drawUmbraShadow(l)),postMessage({cmd:"shadow_done",pen_shadow:JSON.stringify(r),umb_shadow:JSON.stringify(n),date:l.toUTCString()});go=!0}function a(e){if(e){for(var t=[],a=1;a<e.length;a++){t.push(e[a-1]);for(var r=new arc.GreatCircle({x:e[a-1].longitude,y:e[a-1].latitude},{x:e[a].longitude,y:e[a].latitude}).Arc(20,{offset:10}),n=0;n<r.geometries.length;n++)for(var i=0;i<r.geometries[n].coords.length;i++)t.push(new PositionObj(r.geometries[n].coords[i][1],r.geometries[n].coords[i][0]))}return t}return null}function r(e){return Math.PI*e/180}function n(e){for(var t=0,a=0,r=0;r<e.length;r++)t+=e[r].latitude,a+=e[r].longitude;return t/=e.length,a/=e.length,new PositionObj(t,a)}function i(e,t){var a=r(e.latitude),n=r(t.latitude),i=r(t.latitude-e.latitude),o=r(t.longitude-e.longitude),s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(a)*Math.cos(n)*Math.sin(o/2)*Math.sin(o/2);return 6378137*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))}function o(e,t){var a=!0;if(u){var r=e-d;if(r>=.00013888888){a=!0;var o=n(t);if(o.latitude!==u.latitude||o.longitude!==u.longitude){var s=i(o,u);c=(s/=1609.34)/(r*=24)}}else a=r<=0}else c=0;return a&&(u=n(t),d=e),c}function s(e){var t=null,r=parseFloat(e),n=l.drawUmbraShadow(r),i=0;n&&(t=a(n),i=o(r,n)),postMessage({cmd:"shadow_done",umb_shadow:JSON.stringify(t),umb_speed:i})}importScripts("SolarElevation.js"),importScripts("EclipseCalc.js"),importScripts("arc.js");var l=null,u=null,d=null,c=0;self.addEventListener("message",a=>{var r=a.data;switch(r.cmd){case"eclipse":e(r.eclipse);break;case"shadow":s(r.time);break;case"real":t(r.time);break;default:console.log("ANIMATE WORKER: Unkown command sent to worker.")}},!1)}}(()=>{console.log("UMBRA WORKER: Initialized.");new UmbraWorker})();