"use strict";function PositionObj(t,e,i){this.latitude=0,this.longitude=0,this.altitude=0,this.setPosition=function(t,e,i){"number"==typeof t&&(this.latitude=t),"number"==typeof e&&(this.longitude=e),"number"==typeof i&&(this.altitude=i)},this.setPosition(t,e,i)}function PositionLimits(){var t=0,e=0,i=0,s=0;this.setEastLimit=(e=>{"number"==typeof e&&e<=180&&e>=-180&&(t=e)}),this.setWestLimit=(t=>{"number"==typeof t&&t<=180&&t>=-180&&(e=t)}),this.setNorthLimit=(t=>{"number"==typeof t&&t<=90&&t>=-90&&(s=t)}),this.setSouthLimit=(t=>{"number"==typeof t&&t<=90&&t>=-90&&(i=t)}),this.getNorthLimit=(()=>s),this.getSouthLimit=(()=>i),this.getWestLimit=(()=>e),this.getEastLimit=(()=>t)}function CircumstanceDates(t){this.c1Date=null,this.c2Date=null,this.midDate=null,this.c3Date=null,this.c4Date=null,t&&(this.c1Date=t.c1Date,this.c2Date=t.c2Date,this.midDate=t.midDate,this.c3Date=t.c3Date,this.c4Date=t.c4Date),this.setC1Date=function(t){this.c1Date=t},this.setC2Date=function(t){this.c2Date=t},this.setMidDate=function(t){this.midDate=t},this.setC3Date=function(t){this.c3Date=t},this.setC4Date=function(t){this.c4Date=t},this.getC1Date=function(){return this.c1Date},this.getC2Date=function(){return this.c2Date},this.getMidDate=function(){return this.midDate},this.getC3Date=function(){return this.c3Date},this.getC4Date=function(){return this.c4Date}}function TimeSpan(t,e){var i=0,s=0,n=0,a=0,h=0,r=0;return this.setSpan=((t,e)=>(i=void 0===e&&void 0===t?0:"number"==typeof e&&"number"==typeof t?e-t:void 0===e&&"number"==typeof t?t:void 0===e.getTime&&"function"==typeof t.getTime?t.getTime():"function"==typeof e.getTime&&"function"==typeof t.getTime?e.getTime()-t.getTime():0,r=Math.abs(i/864e5),h=r>=1?24*(r-Math.floor(r)):24*r,a=h>=1?60*(h-Math.floor(h)):60*h,n=a>=1?60*(a-Math.floor(a)):60*a,s=n>=1?Math.round(1e3*(n-Math.floor(n))):Math.round(1e3*n),i)),this.getRawMilliSeconds=(()=>i),this.checkNegative=(()=>i<0),this.getDays=(()=>Math.floor(r)),this.getHours=(()=>Math.floor(h)),this.getMinutes=(()=>Math.floor(a)),this.getSeconds=(()=>Math.floor(n)),this.getMilliseconds=(()=>s),this.toTimeString=function(){var t="",e=Math.floor(this.getDays()),i=Math.floor(this.getHours()),s=Math.floor(this.getMinutes()),n=Math.floor(this.getSeconds());return this.checkNegative()&&(t+="-"),e>0&&(t+=e+":"),i>=10&&(t+=i+":"),i>0&&i<10&&(t+="0"+i+":"),0===i&&e>0&&(t+="00:"),s>=10&&(t+=s+":"),s<10&&s>0&&(t+="0"+s+":"),0===s&&(t+="00:"),n>=10&&(t+=""+n),n>0&&n<10&&(t+="0"+n),0===n&&(t+="00"),t},this.setSpan(t,e)}function julianDayToTime(t){var e=864e5*t,i=new Date(Date.UTC(-4713,0,1,12,0,0,0)),s=i.getTime();return i.setTime(s+e+282528e5),i}function ObserverConstants(t,e,i){this.latRadians=t*Math.PI/180,this.longRadians=-1*e*Math.PI/180,this.altitude=i,this.timeZone=0,this.getAltitude=function(){return this.altitude},this.getLatRadians=function(){return this.latRadians},this.getLongRadians=function(){return this.longRadians},this.getTimeZone=function(){return this.timeZone};var s=Math.atan(.99664719*Math.tan(this.getLatRadians()));this.rhoSinO=.99664719*Math.sin(s)+this.getAltitude()/6378140*Math.sin(this.getLatRadians()),this.rhoCosO=Math.cos(s)+this.getAltitude()/6378140*Math.cos(this.getLatRadians()),this.getRhoSinO=function(){return this.rhoSinO},this.getRhoCosO=function(){return this.rhoCosO}}function EclipseCircumstances(){this.eventType=new Number,this.t=new Number,this.x=new Number,this.y=new Number,this.d=new Number,this.sinDelta=new Number,this.cosDelta=new Number,this.mu=new Number,this.l1=new Number,this.l2=new Number,this.dx=new Number,this.dy=new Number,this.dd=new Number,this.dmu=new Number,this.dl1=new Number,this.dl2=new Number,this.h=new Number,this.sinH=new Number,this.cosH=new Number,this.xi=new Number,this.eta=new Number,this.zeta=new Number,this.dxi=new Number,this.deta=new Number,this.u=new Number,this.vLoc=new Number,this.a=new Number,this.b=new Number,this.l1prime=new Number,this.l2prime=new Number,this.nSquared=new Number,this.p=new Number,this.alt=new Number,this.q=new Number,this.vObs=new Number,this.azi=new Number,this.mid=new Number,this.magnitude=new Number,this.moonSun=new Number,this.localType=new Number}function ObserverCircumstances(t){this.isVisible=!1,this.eclipseType="None",this.magnitude=0,this.coverage=0,this.depth=0,this.pAngle=0,this.northOfCenter=!0,this.midAltitude=0,this.c1Altitude=0,this.c4Altitude=0,this.circDates=new CircumstanceDates,this.firstContactBelowHorizon=!1,this.secondContactBelowHorizon=!1,this.midEclipseBelowHorizon=!1,this.thirdContactBelowHorizon=!1,this.fourthContactBelowHorizon=!1,this.c1c4TimeSpan=new TimeSpan,this.c2c3TimeSpan=new TimeSpan,this.set=function(t){"object"==typeof t&&null!==t&&(this.isVisible=t.isVisible,this.eclipseType=t.eclipseType,this.magnitude=t.magnitude,this.coverage=t.coverage,this.depth=t.depth,this.pAngle=t.pAngle,this.northOfCenter=t.northOfCenter,this.midAltitude=t.midAltitude,this.c1Altitude=t.c1Altitude,this.c4Altitude=t.c4Altitude,this.circDates=new CircumstanceDates(t.circDates),this.firstContactBelowHorizon=t.firstContactBelowHorizon,this.secondContactBelowHorizon=t.secondContactBelowHorizon,this.midEclipseBelowHorizon=t.midEclipseBelowHorizon,this.thirdContactBelowHorizon=t.thirdContactBelowHorizon,this.fourthContactBelowHorizon=t.fourthContactBelowHorizon,this.c1c4TimeSpan=new TimeSpan(t.c1c4TimeSpan),this.c2c3TimeSpan=new TimeSpan(t.c2c3TimeSpan))},this.set(t)}function Besselian(){this.julianDayMax=new Number,this.t0=new Number,this.tMin=new Number,this.tMax=new Number,this.dUTC=new Number,this.dT=new Number,this.x0=new Number,this.x1=new Number,this.x2=new Number,this.x3=new Number,this.y0=new Number,this.y1=new Number,this.y2=new Number,this.y3=new Number,this.d0=new Number,this.d1=new Number,this.d2=new Number,this.m0=new Number,this.m1=new Number,this.m2=new Number,this.l10=new Number,this.l11=new Number,this.l12=new Number,this.l20=new Number,this.l21=new Number,this.l22=new Number,this.tanF1=new Number,this.tanF2=new Number}function EclipseData(t){function e(t){return t>360||t<0?t-360*Math.floor(t/360):t}function i(t,i){var s=e(n(t)-i[0]);if((s/=i[1])>=i[2]-1)return 999;var a=Math.floor(s);return(i[a+4]-i[a+3])*(s-a)+i[a+3]}function s(t){var e=Math.abs(t);return e<90?d*Math.cos(a(e)):1e-8*d}function n(t){return 180*t/Math.PI}function a(t){return Math.PI*t/180}function h(t,e){var i=0;return t>0&&e>0||t<0&&e<0?((i=t-e)<0&&(i+=360),i):t>0?t+Math.abs(e):180-Math.abs(t)+180-Math.abs(e)}function r(t,e){var i=t+e;return i>180&&(i-=360),i<-180&&(i+=360),i}function u(t,e){var i=t+e;return i>90&&(i=90),i<-90&&(i=-90),i}function o(t,e){return!c(t,e)}function c(t,e){var i=h(t,e);return i<180&&i>0}function l(t,e){return t.longitude===e.longitude?0:c(t.longitude,e.longitude)?1:-1}function m(t,e){return t.longitude===e.longitude?0:o(t.longitude,e.longitude)?1:-1}function b(t,e){if(t.length>1&&e.length>1){var i=t[t.length-1].longitude,s=t[t.length-1].latitude,n=e[e.length-1].longitude,a=e[e.length-1].latitude;if((Math.abs(s)>75||Math.abs(a)>75)&&h(i,n)>120){var u=h(i,n)/5,o=r(i,-1*u);t.push(new PositionObj(-89.99,o)),o=r(i,-2*u),t.push(new PositionObj(-89.99,o)),o=r(i,-3*u),t.push(new PositionObj(-89.99,o)),o=r(i,-4*u),t.push(new PositionObj(-89.99,o))}}}var d=.1,L=!1;this.type="",this.maxEclipseDate=new Date,this.midEclipsePoint=new PositionObj,this.besselianElements=new Besselian,this.observerConstants=null,this.c1Circumstances=new EclipseCircumstances,this.c2Circumstances=new EclipseCircumstances,this.midCircumstances=new EclipseCircumstances,this.c3Circumstances=new EclipseCircumstances,this.c4Circumstances=new EclipseCircumstances,this.northPenumbraLine=null,this.southPenumbraLine=null,this.centralLine=null,this.southUmbraLine=null,this.northUmbraLine=null,this.westLimitLine=null,this.eastLimitLine=null,this.centralLineTimes=[],this.southUmbraLineTimes=[],this.northUmbraLineTimes=[],this.westPenumbraLineTimes=[],this.eastPenumbraLineTimes=[],this.toDate=(t=>{if(t){var e=Math.floor(t),i=24*(t-e),s=Math.floor((e-122.1)/365.25),n=Math.floor(365.25*s),a=Math.floor((e-n)/30.6001);n=e-n-Math.floor(30.6001*a),s-=(a-=a<13.5?1:13)>2.5?4716:4715,a--;var h=Math.floor(i),r=60*i-60*h,u=60*r-60*Math.floor(r),o=1e3*(u-Math.floor(u));return r=Math.floor(r),u=Math.floor(u),o=Math.floor(o),new Date(Date.UTC(s,a,n,h,r,u,o))}return null}),this.destroy=function(){this.observerConstants=null,this.c1Circumstances=new EclipseCircumstances,this.c2Circumstances=new EclipseCircumstances,this.midCircumstances=new EclipseCircumstances,this.c3Circumstances=new EclipseCircumstances,this.c4Circumstances=new EclipseCircumstances,this.northPenumbraLine=null,this.southPenumbraLine=null,this.centralLine=null,this.southUmbraLine=null,this.northUmbraLine=null,this.westLimitLine=null,this.eastLimitLine=null,this.centralLineTimes=[],this.southUmbraLineTimes=[],this.northUmbraLineTimes=[],this.westPenumbraLineTimes=[],this.eastPenumbraLineTimes=[]},this.deepCopyLineTimes=(t=>{var e=[];if("object"==typeof t&&null!==t)for(var i=0;i<t.length;i++)e.push(new CircumstanceDates(t[i]));return e}),this.set=function(t){"object"==typeof t&&null!==t&&(this.type=t.type,this.maxEclipseDate=new Date(t.maxEclipseDate),this.midEclipsePoint=t.midEclipsePoint,this.besselianElements=t.besselianElements,this.observerConstants=t.observerConstants,this.c1Circumstances=t.c1Circumstances,this.c2Circumstances=t.c2Circumstances,this.midCircumstances=t.midCircumstances,this.c3Circumstances=t.c3Circumstances,this.c4Circumstances=t.c4Circumstances,this.northPenumbraLine=t.northPenumbraLine,this.southPenumbraLine=t.southPenumbraLine,this.centralLine=t.centralLine,this.southUmbraLine=t.southUmbraLine,this.northUmbraLine=t.northUmbraLine,this.westLimitLine=t.westLimitLine,this.eastLimitLine=t.eastLimitLine,this.centralLineTimes=this.deepCopyLineTimes(t.centralLineTimes),this.southUmbraLineTimes=this.deepCopyLineTimes(t.southUmbraLineTimes),this.northUmbraLineTimes=this.deepCopyLineTimes(t.northUmbraLineTimes),this.westPenumbraLineTimes=this.deepCopyLineTimes(t.westPenumbraLineTimes),this.eastPenumbraLineTimes=this.deepCopyLineTimes(t.eastPenumbraLineTimes))},this.calculateLocalCircumstances=function(t,e,i,s){if("number"!=typeof t||"number"!=typeof e)throw"Pleae input proper latitude and longitude to calclulate local cirucumstances.";var n=0,a=e,h=new ObserverCircumstances;if(i&&(isNaN(i)||(n=i)),L=!!s,this.observerConstants=new ObserverConstants(t,a,n),this.getAll(),h.magnitude=100*this.midCircumstances.magnitude,h.northOfCenter=this.midCircumstances.vLoc<0,h.midAltitude=this.getAlt(this.midCircumstances),h.c1Altitude=this.getAlt(this.c1Circumstances),h.c4Altitude=this.getAlt(this.c4Circumstances),h.circDates.setC1Date(this.getDate(this.c1Circumstances)),h.circDates.setMidDate(this.getDate(this.midCircumstances)),h.circDates.setC4Date(this.getDate(this.c4Circumstances)),h.circDates.setC2Date(this.getDate(this.c2Circumstances)),h.circDates.setC3Date(this.getDate(this.c3Circumstances)),h.coverage=this.getCoverage(),h.depth=this.getDepth(),h.pAngle=this.getP(this.midCircumstances),this.midCircumstances.localType>0&&this.checkHorizons(h))switch(h.isVisible=!0,null!==h.circDates.getC1Date()&&null!==h.circDates.getC4Date()&&h.c1c4TimeSpan.setSpan(this.toDate(h.circDates.getC1Date()),this.toDate(h.circDates.getC4Date())),this.midCircumstances.localType){case 1:h.eclipseType="Partial";break;case 2:h.eclipseType="Annular",null!==h.circDates.getC2Date()&&null!==h.circDates.getC3Date()&&h.c2c3TimeSpan.setSpan(this.toDate(h.circDates.getC2Date()),this.toDate(h.circDates.getC3Date()));break;case 3:h.eclipseType="Total",null!==h.circDates.getC2Date()&&null!==h.circDates.getC3Date()&&h.c2c3TimeSpan.setSpan(this.toDate(h.circDates.getC2Date()),this.toDate(h.circDates.getC3Date()));break;default:h.eclipseType="None"}return h},this.checkHorizons=function(t){if(this.getAlt(this.c1Circumstances)<0?t.firstContactBelowHorizon=!0:t.firstContactBelowHorizon=!1,this.getAlt(this.midCircumstances)<0?t.midEclipseBelowHorizon=!0:t.midEclipseBelowHorizon=!1,this.getAlt(this.c4Circumstances)<0?t.fourthContactBelowHorizon=!0:t.fourthContactBelowHorizon=!1,this.getAlt(this.c2Circumstances)<0?t.secondContactBelowHorizon=!0:t.secondContactBelowHorizon=!1,this.getAlt(this.c3Circumstances)<0?t.thirdContactBelowHorizon=!0:t.thirdContactBelowHorizon=!1,1===this.midCircumstances.localType){if(t.fourthContactBelowHorizon&&t.midEclipseBelowHorizon&&t.firstContactBelowHorizon)return this.midCircumstances.localType=0,!1}else{if(t.fourthContactBelowHorizon&&t.midEclipseBelowHorizon&&t.firstContactBelowHorizon&&t.secondContactBelowHorizon&&t.thirdContactBelowHorizon)return this.midCircumstances.localType=0,!1;t.secondContactBelowHorizon&&t.thirdContactBelowHorizon&&(this.midCircumstances.localType=1)}return!0},this.checkCentralHorizons=((t,e)=>!t.isVisible||!!t.midEclipseBelowHorizon),this.checkPartialHorizons=((t,e)=>!(!t.firstContactBelowHorizon||!e)||!(!t.fourthContactBelowHorizon||e)),this.getCentralLine=function(){return this.centralLine},this.setCentralLine=function(t){this.centralLine=t},this.setCentralLineTimes=function(t){this.centralLineTimes=this.deepCopyLineTimes(t)},this.getCentralLineTimes=function(){return this.centralLineTimes},this.drawCentralLine=function(){if(null!==this.centralLine)return this.centralLine;if("Annular"===this.type||"Total"===this.type||"Hybrid"===this.type){this.centralLine=[],this.centralLineTimes=[],this.centralLine.push(this.midEclipsePoint);var t=s(this.midEclipsePoint.latitude),e=.1,i=0,n=0,a=0,h=1,u=new ObserverCircumstances,o=!1;u=this.calculateLocalCircumstances(this.midEclipsePoint.latitude,this.midEclipsePoint.longitude,0),this.centralLineTimes.push(u.circDates);for(var c=1;c>-2;c-=2){o=!1;for(var l=t=s(n)*c;Math.abs(l)<=180&&(t=s(n)*c,i=r(this.midEclipsePoint.longitude,l),l===t&&(n=this.midEclipsePoint.latitude),u=this.calculateLocalCircumstances(n,i,0),a=u.depth,!this.checkCentralHorizons(u,1===c)&&!o);l+=t)if(u.depth<99.9)for(h=u.northOfCenter?-1:1,n+=e=Math.abs(e)*h;Math.abs(n)<=90;n+=e){if(u=this.calculateLocalCircumstances(n,i,0),this.checkCentralHorizons(u,1===c)&&(o=!0),!(u.depth<99.9)){u=this.calculateLocalCircumstances(n,i,0),1===c?(this.centralLine.push(new PositionObj(n,i)),this.centralLineTimes.unshift(u.circDates)):(this.centralLine.unshift(new PositionObj(n,i)),this.centralLineTimes.unshift(u.circDates));break}if(u.northOfCenter&&1===h||!u.northOfCenter&&-1===h){n-=e*((100-u.depth)/(100-a+(100-u.depth))),u=this.calculateLocalCircumstances(n,i,0),1===c?(this.centralLine.push(new PositionObj(n,i)),this.centralLineTimes.push(u.circDates)):(this.centralLine.unshift(new PositionObj(n,i)),this.centralLineTimes.unshift(u.circDates));break}a=u.depth}else u=this.calculateLocalCircumstances(n,i,0),1===c?(this.centralLine.push(new PositionObj(n,i)),this.centralLineTimes.push(u.circDates)):(this.centralLine.unshift(new PositionObj(n,i)),this.centralLineTimes.unshift(u.circDates))}}return this.centralLine},this.getPenumbraStartTimeJD=function(){var t=null;if(this.westPenumbraLineTimes){var e=[];t=(e=(e=e.concat(this.westPenumbraLineTimes)).sort((t,e)=>null!==t.getMidDate()&&null!==e.getMidDate()?t.getMidDate()-e.getMidDate():0))[0].getMidDate(),t-=.03}return t},this.getPenumbraStartTime=function(){return this.toDate(this.getPenumbraStartTimeJD())},this.getPenumbraEndTimeJD=function(){var t=null;if(this.eastPenumbraLineTimes){var e=[];t=(e=(e=e.concat(this.eastPenumbraLineTimes)).sort((t,e)=>null!==e.getMidDate()&&null!==t.getMidDate()?e.getMidDate()-t.getMidDate():0))[0].getMidDate(),t+=.03}return t},this.getPenumbraEndTime=function(){return this.toDate(this.getPenumbraEndTimeJD())},this.getUmbraStartTimeJD=function(){var t=null;return this.centralLineTimes?t=this.centralLineTimes[0].getC2Date():(this.northUmbraLineTimes&&(t=this.northUmbraLineTimes[0].getMidDate()),this.southUmbraLineTimes&&(t=this.southUmbraLineTimes[0].getMidDate())),t&&(t-=.001),t},this.getUmbraStartTime=function(){return this.toDate(this.getUmbraStartTimeJD())},this.getUmbraEndTimeJD=function(){var t=null;return this.centralLineTimes?t=this.centralLineTimes[this.centralLineTimes.length-1].getC3Date():(this.northUmbraLineTimes&&(t=this.northUmbraLineTimes[this.northUmbraLineTimes.length-1].getMidDate()),this.southUmbraLineTimes&&(t=this.southUmbraLineTimes[this.northUmbraLineTimes.length-1].getMidDate())),t&&(t+=.001),t},this.getUmbraEndTime=function(){return this.toDate(this.getUmbraEndTimeJD())},this.setSouthUmbraLine=function(t){this.southUmbraLine=t},this.getSouthUmbraLine=function(){return this.southUmbraLine},this.setNorthUmbraLine=function(t){this.northUmbraLine=t},this.getNorthUmbraLine=function(){return this.northUmbraLine},this.getNorthUmbraTimes=function(){return this.northUmbraLineTimes},this.setNorthUmbraTimes=function(t){this.northUmbraLineTimes=this.deepCopyLineTimes(t)},this.getSouthUmbraTimes=function(){return this.southUmbraLineTimes},this.setSouthUmbraTimes=function(t){this.southUmbraLineTimes=this.deepCopyLineTimes(t)},this.drawUmbraLimit=function(t){if(!t&&this.southUmbraLine)return this.southUmbraLine;if(t&&this.northUmbraLine)return this.northUmbraLine;var e=null,i=null;if("Annular"===this.type||"Total"===this.type||"Hybrid"===this.type){e=[],i=[];var n=s(this.midEclipsePoint.latitude),a=.1,h=this.midEclipsePoint.longitude,u=this.midEclipsePoint.latitude,o=100,c=1,l=new ObserverCircumstances,m=!1;t||(c=-1);for(var b=1;b>=-1;b-=2){l=new ObserverCircumstances,o=100,n=s(u)*b,h=this.midEclipsePoint.longitude,u=this.midEclipsePoint.latitude,m=!1;for(var d=0;Math.abs(d)<=180;d+=n){if(n=s(u)*b,-1===b&&(d+=n,u=e[0].latitude),h=r(this.midEclipsePoint.longitude,d),d>0||-1===b){if(l=this.calculateLocalCircumstances(u,h,0),o=l.depth,this.checkCentralHorizons(l,1===b)||m)break;o<=0&&l.northOfCenter?c=-1:o>0&&l.northOfCenter?c=1:o>0&&!l.northOfCenter?c=-1:o<=0&&!l.northOfCenter&&(c=1)}for(u+=a=Math.abs(a)*c;Math.abs(u)<=90;u+=a){if(l=this.calculateLocalCircumstances(u,h,0),this.checkCentralHorizons(l,1===b)&&(m=!0),!(l.depth>.1||l.depth<-.1)){l=this.calculateLocalCircumstances(u,h,0),1===b?(e.push(new PositionObj(u,h)),i.push(l.circDates)):(e.unshift(new PositionObj(u,h)),i.unshift(l.circDates));break}if(l.depth<0&&o>0||l.depth>0&&o<0){u-=a*(Math.abs(l.depth)/(Math.abs(o)+Math.abs(l.depth))),l=this.calculateLocalCircumstances(u,h,0),1===b?(e.push(new PositionObj(u,h)),i.push(l.circDates)):(e.unshift(new PositionObj(u,h)),i.unshift(l.circDates));break}o=l.depth}}}}return i&&i.length>0&&(t?(this.northUmbraLineTimes=[],this.northUmbraLineTimes=this.northUmbraLineTimes.concat(i)):(this.southUmbraLineTimes=[],this.southUmbraLineTimes=this.southUmbraLineTimes.concat(i))),e&&e.length>0?t?(this.northUmbraLine=[],this.northUmbraLine=this.northUmbraLine.concat(e),this.northUmbraLine):(this.southUmbraLine=[],this.southUmbraLine=this.southUmbraLine.concat(e),this.southUmbraLine):this.northUmbraLine},this.getNorthPenumbraLine=function(){return this.northPenumbraLine},this.getSouthPenumbraLine=function(){return this.southPenumbraLine},this.setNorthPenumbraLine=function(t){this.northPenumbraLine=t},this.setSouthPenumbraLine=function(t){this.southPenumbraLine=t},this.drawPenumbralLimit=function(t){if(t&&this.northPenumbralLine)return this.northPenumbraLine;if(!t&&this.southPenumbraLine)return this.southPenumbraLine;for(var e=[],i=s(this.midEclipsePoint.latitude),n=.1,a=this.midEclipsePoint.longitude,h=this.midEclipsePoint.latitude,u=100,o=1,c=new ObserverCircumstances,l=!1,m=!0,b=1;b>-2;b-=2){if(l=!1,i=s(h)*b,t||(o=-1),n=Math.abs(n)*o,1===b){for(h+=n=.2*o;Math.abs(h)<=90;h+=n){if(!((c=this.calculateLocalCircumstances(h,a,0)).magnitude>0)){h-=n*Math.abs(c.magnitude)/(Math.abs(u)+Math.abs(c.magnitude)),e.push(new PositionObj(h,a)),m=!1;break}u=c.magnitude}if(m)break}else h=e[0].latitude,a=e[0].longitude;n=.1*o;for(var d=i;Math.abs(d)<=180&&(a=r(e[0].longitude,d),c=this.calculateLocalCircumstances(h,a,0),u=c.magnitude,!this.checkPartialHorizons(c,1===b)&&!l);d+=i){for(c.northOfCenter&&u<0?o=-1:!c.northOfCenter&&u<0?o=1:!c.northOfCenter&&u>0?o=-1:c.northOfCenter&&u>0&&(o=1),m=!0,h+=n=Math.abs(n)*o;Math.abs(h)<=90;h+=n){if(c=this.calculateLocalCircumstances(h,a,0),this.checkPartialHorizons(c,1===b)&&(l=!0),u>0&&c.magnitude<0||u<0&&c.magnitude>0){h-=n*Math.abs(c.magnitude)/(Math.abs(u)+Math.abs(c.magnitude)),m=!1,1===b?e.push(new PositionObj(h,a)):e.unshift(new PositionObj(h,a));break}u=c.magnitude}i=s(h)*b}}return e.length<1&&(e=null),t?(e&&(this.northPenumbraLine=e.slice(1,e.length-1)),this.northPenumbraLine):(e&&(this.southPenumbraLine=e.slice(1,e.length-1)),this.southPenumbraLine)},this.getWestLimitLine=function(){return this.westLimitLine},this.getEastLimitLine=function(){return this.eastLimitLine},this.setWestLimitLine=function(t){this.westLimitLine=t},this.setEastLimitLine=function(t){this.eastLimitLine=t},this.getWestLineTimes=function(){return this.westPenumbraLineTimes},this.getPointCount=function(){var t=0;return this.getWestLimitLine()&&(t+=this.getWestLimitLine().length),this.getEastLimitLine()&&(t+=this.getEastLimitLine().length),this.getNorthPenumbraLine()&&(t+=this.getNorthPenumbraLine().length),this.getSouthPenumbraLine()&&(t+=this.getSouthPenumbraLine().length),t},this.isEclipseOccurring=function(t){try{if(t&&this.getPenumbraEndTime()&&this.getPenumbraStartTime()&&t<=this.getPenumbraEndTime()&&t>=this.getPenumbraStartTime())return!0}catch(t){return!1}return!1},this.setWestLineTimes=function(t){this.westPenumbraLineTimes=this.deepCopyLineTimes(t)},this.getEastLineTimes=function(){return this.eastPenumbraLineTimes},this.setEastLineTimes=function(t){this.eastPenumbraLineTimes=this.deepCopyLineTimes(t)},this.drawEastWestLimit=function(t){if(t&&this.westLimitLine)return this.westLimitLine;if(!t&&this.eastLimitLine)return this.eastLimitLine;if(!this.southPenumbraLine&&!this.northPenumbraLine)throw"Can't draw east or west limit line without the north and south penumbral limits.";var e=.1,i=s(0),n=[],a=!0,h=90,u=0,o=0,c=0,l=0,m=0,b=0,d=0,L=0,g=0,C=0,p=0,f=new ObserverCircumstances,T=[];if(!this.southPenumbraLine&&this.northPenumbraLine)this.northPenumbraLine.length>0&&(a=!1,h=-89,t?(n.push(this.northPenumbraLine[0]),f=this.calculateLocalCircumstances(this.northPenumbraLine[0].latitude,this.northPenumbraLine[0].longitude,0),T.push(f.circDates)):(n.push(this.northPenumbraLine[this.northPenumbraLine.length-1]),f=this.calculateLocalCircumstances(this.northPenumbraLine[this.northPenumbraLine.length-1].latitude,this.northPenumbraLine[this.northPenumbraLine.length-1].longitude,0),T.push(f.circDates)));else if(this.southPenumbraLine.length>0)if(t)n.push(this.southPenumbraLine[0]),f=this.calculateLocalCircumstances(this.southPenumbraLine[0].latitude,this.southPenumbraLine[0].longitude,0),T.push(f.circDates);else{n.push(this.southPenumbraLine[this.southPenumbraLine.length-1]);try{f=this.calculateLocalCircumstances(this.southPenumbraLine[this.southPenumbraLine.length-1].latitude,this.southPenumbraLine[this.southPenumbraLine.length-1].longitude,0),T.push(f.circDates)}catch(t){throw"Ummmm no number here!"}}t?(o=this.midEclipsePoint.longitude,u=n.length>0?r(n[0].longitude,-90):r(this.midEclipsePoint.longitude,-90)):(u=this.midEclipsePoint.longitude,o=n.length>0?r(n[0].longitude,90):r(this.midEclipsePoint.longitude,90)),"Annular"!==this.type&&"Total"!==this.type&&"Hybrid"!==this.type||(h=a?this.northPenumbraLine?t?this.northPenumbraLine[0].latitude:this.northPenumbraLine[this.northPenumbraLine.length-1].latitude:90:this.southPenumbraLine?t?this.southPenumbraLine[0].latitude:this.southPenumbraLine[this.southPenumbraLine.length-1].latitude:-89),a||(e*=-1),n.length>0?(m=n[0].latitude,b=n[0].longitude):(m=0,b=t?r(this.midEclipsePoint.longitude,90):r(this.midEclipsePoint.longitude,-90)),g=Math.abs(h-m);var D=0;for(D=n.length>0?n[0].latitude:m,L+=e;Math.abs(L)<g;L+=e)for(i=s(m=D+L),f=this.calculateLocalCircumstances(m,b,0),t?(c=f.c4Altitude)>0?(i=-1*Math.abs(i),p=Math.abs(b-u)):(i=Math.abs(i),p=Math.abs(b-o)):(c=f.c1Altitude)<0?(i=-1*Math.abs(i),p=Math.abs(b-u)):(i=Math.abs(i),p=Math.abs(b-o)),p>180&&(p-=180),l=c,C=0,d=b,C+=i;Math.abs(C)<=Math.abs(p)&&(b=r(d,C),f=this.calculateLocalCircumstances(m,b,0),c=t?f.c4Altitude:f.c1Altitude,!isNaN(c));C+=i){if(c<0&&l>0||c>0&&l<0){b=r(b,i*Math.abs(c)/(Math.abs(c)+Math.abs(l))*-1),n.push(new PositionObj(m,b)),f=this.calculateLocalCircumstances(m,b,0),T.push(f.circDates);break}l=c}return a?!t&&this.northPenumbraLine?(n.push(this.northPenumbraLine[this.northPenumbraLine.length-1]),f=this.calculateLocalCircumstances(n[n.length-1].latitude,n[n.length-1].longitude,0),T.push(f.circDates)):this.northPenumbraLine?(n.push(this.northPenumbraLine[0]),f=this.calculateLocalCircumstances(n[n.length-1].latitude,n[n.length-1].longitude,0),T.push(f.circDates)):t&&this.eastLimitLine&&(n.push(this.eastLimitLine[this.eastLimitLine.length-1]),f=this.calculateLocalCircumstances(n[n.length-1].latitude,n[n.length-1].longitude,0),T.push(f.circDates)):!t&&this.southPenumbraLine?(n.push(this.southPenumbraLine[this.southPenumbraLine.length-1]),f=this.calculateLocalCircumstances(n[n.length-1].latitude,n[n.length-1].longitude,0),T.push(f.circDates)):this.southPenumbraLine?(n.push(this.southPenumbraLine[0]),f=this.calculateLocalCircumstances(n[n.length-1].latitude,n[n.length-1].longitude,0),T.push(f.circDates)):t&&this.eastLimitLine&&(n.push(this.eastLimitLine[this.eastLimitLine.length-1]),f=this.calculateLocalCircumstances(n[n.length-1].latitude,n[n.length-1].longitude,0),T.push(f.circDates)),n&&n.length>1&&n[0].latitude>n[n.length-1].latitude&&(n=n.reverse(),T=T.reverse()),t?(console.log("WEST COMPLETE"),this.westLimitLine=[],this.westLimitLine=this.westLimitLine.concat(n),this.westPenumbraLineTimes=[],this.westPenumbraLineTimes=this.westPenumbraLineTimes.concat(T),this.westLimitLine):(this.eastPenumbraLineTimes=[],this.eastPenumbraLineTimes=this.eastPenumbraLineTimes.concat(T),this.eastLimitLine=[],this.eastLimitLine=this.eastLimitLine.concat(n),this.eastLimitLine)},this.getPenumbraLimits=function(){var t=null;if(this.eastLimitLine&&this.westLimitLine&&(this.northPenumbraLine||this.southPenumbraLine)){var e=this.midEclipsePoint.latitude,i=this.midEclipsePoint.latitude,s=this.midEclipsePoint.longitude,n=this.midEclipsePoint.longitude,a=this.midEclipsePoint.longitude;if(t=new PositionLimits,this.eastLimitLine[0].latitude>e&&(e=this.eastLimitLine[0].latitude),this.eastLimitLine[this.eastLimitLine.length-1].latitude>e&&(e=this.eastLimitLine[this.eastLimitLine.length-1].latitude),this.westLimitLine[0].latitude>e&&(e=this.westLimitLine[0].latitude),this.westLimitLine[this.westLimitLine.length-1].latitude>e&&(e=this.westLimitLine[this.westLimitLine.length-1].latitude),this.northPenumbraLine){for(h=0;h<this.northPenumbraLine.length;h++)this.northPenumbraLine[h].latitude>e&&(e=this.northPenumbraLine[h].latitude);c(s,this.northPenumbraLine[0].longitude)&&c(a,this.northPenumbraLine[0].longitude)&&(s=this.northPenumbraLine[0].longitude),c(s,this.northPenumbraLine[this.northPenumbraLine.length-1].longitude)&&c(a,this.northPenumbraLine[this.northPenumbraLine.length-1].longitude)&&(s=this.northPenumbraLine[this.northPenumbraLine.length-1].longitude),o(n,this.northPenumbraLine[0].longitude)&&o(a,this.northPenumbraLine[0].longitude)&&(n=this.northPenumbraLine[0].longitude),o(n,this.northPenumbraLine[this.northPenumbraLine.length-1].longitude)&&o(a,this.northPenumbraLine[this.northPenumbraLine.length-1].longitude)&&(n=this.northPenumbraLine[this.northPenumbraLine.length-1].longitude)}if((e+=1)>90&&(e=89),t.setNorthLimit(e),this.eastLimitLine[0].latitude<i&&(i=this.eastLimitLine[0].latitude),this.eastLimitLine[this.eastLimitLine.length-1].latitude<i&&(i=this.eastLimitLine[this.eastLimitLine.length-1].latitude),this.westLimitLine[0].latitude<i&&(i=this.westLimitLine[0].latitude),this.westLimitLine[this.westLimitLine.length-1].latitude<i&&(i=this.westLimitLine[this.westLimitLine.length-1].latitude),this.southPenumbraLine){for(h=0;h<this.southPenumbraLine.length;h++)this.southPenumbraLine[h].latitude<i&&(i=this.southPenumbraLine[h].latitude);c(s,this.southPenumbraLine[0].longitude)&&c(a,this.southPenumbraLine[0].longitudev)&&(s=this.southPenumbraLine[0].longitude),c(s,this.southPenumbraLine[this.southPenumbraLine.length-1].longitude)&&c(a,this.southPenumbraLine[this.southPenumbraLine.length-1].longitude)&&(s=this.southPenumbraLine[this.southPenumbraLine.length-1].longitude),o(n,this.southPenumbraLine[0].longitude)&&o(a,this.southPenumbraLine[0].longitude)&&(n=this.southPenumbraLine[0].longitude),o(n,this.southPenumbraLine[this.southPenumbraLine.length-1].longitude)&&o(a,this.southPenumbraLine[this.southPenumbraLine.length-1].longitude)&&(n=this.southPenumbraLine[this.southPenumbraLine.length-1].longitude)}(i-=1)<-90&&(i=-89),t.setSouthLimit(i);for(h=0;h<this.westLimitLine.length-1;h++)c(s,this.westLimitLine[h].longitude)&&c(a,this.westLimitLine[h].longitude)&&(s=this.westLimitLine[h].longitude);s=r(s,-1),t.setWestLimit(s);for(var h=0;h<this.eastLimitLine.length-1;h++)o(n,this.eastLimitLine[h].longitude)&&o(a,this.eastLimitLine[h].longitude)&&(n=this.eastLimitLine[h].longitude);n=r(n,1),t.setEastLimit(n)}return t},this.getUmbraLimits=function(t){var e=null;if(this.northUmbraLineTimes||this.southUmbraLineTimes){e=new PositionLimits;var i=null,s=null,n=null,a=!1,h=!1,l=0;if(this.centralLineTimes){for(L=0;L<this.centralLineTimes.length;L++)if((n=this.centralLineTimes[L].getMidDate())&&n>=t){l=this.calculateLocalCircumstances(this.centralLine[L].latitude,this.centralLine[L].longitude,0).c2c3TimeSpan.getRawMilliSeconds();break}0===l&&(l=this.calculateLocalCircumstances(this.midEclipsePoint.latitude,this.midEclipsePoint.longitude,0).c2c3TimeSpan.getRawMilliSeconds())}0===l&&(l=751e3);var m=t-l/2/864e5,b=t+l/2/864e5;if(this.northUmbraLineTimes){for(var d=-89,L=0;L<this.northUmbraLineTimes.length;L++)if(n=this.northUmbraLineTimes[L].getMidDate()){if(n>=m&&!a){a=!0,null===i?i=this.northUmbraLine[L].longitude:o(i,this.northUmbraLine[L].longitude)&&(i=this.northUmbraLine[L].longitude),d<this.northUmbraLine[L].latitude&&(d=this.northUmbraLine[L].latitude),L>0&&(null===s?s=this.northUmbraLine[L-1].longitude:c(s,this.northUmbraLine[L-1].longitude)&&(s=this.northUmbraLine[L-1].longitude),d<this.northUmbraLine[L-1].latitude&&(d=this.northUmbraLine[L-1].latitude));continue}if(n>=b){null===i?i=this.northUmbraLine[L].longitude:o(i,this.northUmbraLine[L].longitude)&&(i=this.northUmbraLine[L].longitude),d<this.northUmbraLine[L].latitude&&(d=this.northUmbraLine[L].latitude),L>0&&(null===s?s=this.northUmbraLine[L-1].longitude:c(s,this.northUmbraLine[L-1].longitude)&&(s=this.northUmbraLine[L-1].longitude),d<this.northUmbraLine[L-1].latitude&&(d=this.northUmbraLine[L-1].latitude)),h=!0;break}}if(a&&!h&&--L>0&&(null===i?i=this.northUmbraLine[L].longitude:o(i,this.northUmbraLine[L].longitude)&&(i=this.northUmbraLine[L].longitude),d<this.northUmbraLine[L].latitude&&(d=this.northUmbraLine[L].latitude),L>0&&(null===s?s=this.northUmbraLine[L-1].longitude:c(s,this.northUmbraLine[L-1].longitude)&&(s=this.northUmbraLine[L-1].longitude),d<this.northUmbraLine[L-1].latitude&&(d=this.northUmbraLine[L-1].latitude))),-89===d)return null;d=u(d,.05),e.setNorthLimit(d)}else e.setNorthLimit(89);if(this.southUmbraLineTimes){var g=89;a=!1,h=!1;for(L=0;L<this.southUmbraLineTimes.length;L++)if(n=this.southUmbraLineTimes[L].getMidDate()){if(n>=m&&!a){a=!0,null===i?i=this.southUmbraLine[L].longitude:o(i,this.southUmbraLine[L].longitude)&&(i=this.southUmbraLine[L].longitude),g>this.southUmbraLine[L].latitude&&(g=this.southUmbraLine[L].latitude),L>0&&(null===s?s=this.southUmbraLine[L-1].longitude:c(s,this.southUmbraLine[L-1].longitude)&&(s=this.southUmbraLine[L-1].longitude),g>this.southUmbraLine[L-1].latitude&&(g=this.southUmbraLine[L-1].latitude));continue}if(n>=b){h=!0,null===i?i=this.southUmbraLine[L].longitude:o(i,this.southUmbraLine[L].longitude)&&(i=this.southUmbraLine[L].longitude),g>this.southUmbraLine[L].latitude&&(g=this.southUmbraLine[L].latitude),L>0&&(null===s?s=this.southUmbraLine[L-1].longitude:c(s,this.southUmbraLine[L-1].longitude)&&(s=this.southUmbraLine[L-1].longitude),g>this.southUmbraLine[L-1].latitude&&(g=this.southUmbraLine[L-1].latitude));break}}if(a&&!h&&--L>0&&(null===i?i=this.southUmbraLine[L].longitude:o(i,this.southUmbraLine[L].longitude)&&(i=this.southUmbraLine[L].longitude),g>this.southUmbraLine[L].latitude&&(g=this.southUmbraLine[L].latitude),L>0&&(null===s?s=this.southUmbraLine[L-1].longitude:c(s,this.southUmbraLine[L-1].longitude)&&(s=this.southUmbraLine[L-1].longitude),g>this.southUmbraLine[L-1].latitude&&(g=this.southUmbraLine[L-1].latitude))),89===g)return null;g=u(g,-.05),e.setSouthLimit(g)}else e.setSouthLimit(-89);if(this.centralLineTimes)for(var C=2;C<4;C++)for(L=0;L<this.centralLineTimes.length;L++)if(2===C){if(this.centralLineTimes[L].getC2Date()&&this.centralLineTimes[L].getC2Date()>=t){null===i?i=this.centralLine[L].longitude:o(i,this.centralLine[L].longitude)&&(i=this.centralLine[L].longitude);break}}else if(this.centralLineTimes[L].getC3Date()&&this.centralLineTimes[L].getC3Date()>=t){null===s&&(s=this.centralLine[L].longitude),c(s,this.centralLine[L].longitude)&&(s=this.centralLine[L].longitude),L>0&&c(s,this.centralLine[L-1].longitude)&&(s=this.centralLine[L-1].longitude);break}i=r(i,1),e.setEastLimit(i),s=r(s,-.2),e.setWestLimit(s)}return e},this.drawPenumbraShadow=function(t){var e=null,i=this.getPenumbraLimits();if(i){var s=new SolarCalc,n=t,a=this.toDate(t),u=0,o=h(i.getEastLimit(),i.getWestLimit()),c=0,l=0,m=0,d=0,L=!1,g=null,C=null,p=null,f=null,T=!1,D=0,P=0,w=new ObserverCircumstances;e=[];var E=[];for(o=Math.abs(o),d=i.getSouthLimit();d<i.getNorthLimit();d+=.5)if(u=0,c=r(i.getWestLimit(),u),w=this.calculateLocalCircumstances(d,c,0),C=w.circDates.getC4Date(),f=w.circDates.getC1Date(),D=s.getSolarElevation(d,c,a),T=w.isVisible,!(D<2&&D>=0&&T&&null!==g&&null!==p&&g>=n&&p<=n))for(u+=3;u<=o;u+=3){if(c=r(i.getWestLimit(),u),w=this.calculateLocalCircumstances(d,c,0),g=w.circDates.getC4Date(),p=w.circDates.getC1Date(),P=s.getSolarElevation(d,c,a),((L=w.isVisible)||T)&&(g&&C&&(D<=0&&P>0&&g>=n&&p<=n&&(l=r(c,Math.abs(P)/(Math.abs(D)+Math.abs(P))*-3),E.push(new PositionObj(d,l))),g>=n&&C<=n&&P>=0&&(l=r(c,Math.abs(n-g)/(Math.abs(n-g)+Math.abs(n-C))*-3),E.push(new PositionObj(d,l))),g<=n&&C>=n&&P>=0&&(l=r(c,Math.abs(n-g)/(Math.abs(n-g)+Math.abs(n-C))*-3),E.push(new PositionObj(d,l)))),p&&f&&(p>=n&&f<=n&&P>=0&&(m=r(c,Math.abs(n-p)/(Math.abs(n-p)+Math.abs(n-f))*-3),e.push(new PositionObj(d,m))),p<=n&&f>=n&&P>=0&&(m=r(c,Math.abs(n-p)/(Math.abs(n-p)+Math.abs(n-f))*-3),e.push(new PositionObj(d,m))),D>=0&&P<0&&C>=n&&f<=n))){m=r(c,Math.abs(P)/(Math.abs(D)+Math.abs(P))*-3),e.push(new PositionObj(d,m));break}C=g,f=p,D=P,T=L}E.length>0&&(E=this.sortShadowLine(!0,E)),e.length>0&&(e=this.sortShadowLine(!1,e)),b(e,E),E.length>0&&(e=e.concat(E.reverse())),e.length>1&&(e=e.concat(e[0])),e.length<2&&(e=null)}return e},this.sortShadowLine=((t,e)=>{for(var i=e[0].longitude,s=0,n=0;n<e.length;n++)t?c(i,e[n].longitude)&&(i=e[n].longitude,s=n):c(i,e[n].longitude)||(i=e[n].longitude,s=n);var a=[],h=[];return a=a.concat(e.slice(0,s+1)),h=h.concat(e.slice(s+1,e.length)),t?(a.sort(l),h.sort(m),h=h.concat(a)):(a.sort(m),h.sort(l),h=h.concat(a))}),this.drawUmbraShadow=function(t){var e=new SolarCalc,i=t,s=this.toDate(t),n=null,a=this.getUmbraLimits(i);if(a){var h=0,u=r(0,a.getWestLimit()-a.getEastLimit()),o=0,c=0,l=0,m=0,b=null,d=null,L=null,g=null,C=0,p=0,f=!1,T=!1,D=new ObserverCircumstances;n=[];var P=[];for(u=Math.abs(u),m=a.getSouthLimit();m<=a.getNorthLimit();m+=.025)if(h=0,o=r(a.getWestLimit(),h),D=this.calculateLocalCircumstances(m,o,0),d=D.circDates.getC3Date(),g=D.circDates.getC2Date(),C=e.getSolarElevation(m,o,s),f=D.isVisible,!(C<2&&C>=0&&f&&null!==b&&null!==L&&b>=i&&L<=i))for(h+=.05;h<=u;h+=.05)if(o=r(a.getWestLimit(),h),D=this.calculateLocalCircumstances(m,o,0),b=D.circDates.getC3Date(),L=D.circDates.getC2Date(),p=e.getSolarElevation(m,o,s),(T=D.isVisible)||f){if(b&&d&&(C<=0&&p>0&&b>=i&&L<=i&&(c=r(o,Math.abs(p)/(Math.abs(C)+Math.abs(p))*-.05),P.push(new PositionObj(m,c))),b>=i&&d<=i&&p>=0&&(c=r(o,Math.abs(i-b)/(Math.abs(i-b)+Math.abs(i-d))*-.05),P.push(new PositionObj(m,c))),b<=i&&d>=i&&p>=0&&(c=r(o,Math.abs(i-b)/(Math.abs(i-b)+Math.abs(i-d))*-.05),n.push(new PositionObj(m,c)))),L&&g)if(L>=i&&g<=i&&p>=0)l=r(o,Math.abs(i-L)/(Math.abs(i-L)+Math.abs(i-g))*-.05),n.push(new PositionObj(m,l));else if(L<=i&&g>=i&&p>=0)l=r(o,Math.abs(i-L)/(Math.abs(i-L)+Math.abs(i-g))*-.05),P.push(new PositionObj(m,l));else if(C>=0&&p<0&&d>=i&&g<=i){l=r(o,Math.abs(p)/(Math.abs(C)+Math.abs(p))*-.05),n.push(new PositionObj(m,l));break}d=b,g=L,C=p,f=T}P.length>1&&(P=P.reverse(),n=n.concat(P)),n.length>1&&(n=n.concat(n[0])),n.length<2&&(n=null)}return n},this.getJulianDay=function(t){var e=t.t+this.besselianElements.t0-(this.besselianElements.dUTC-.05)/3600;return e<0&&(e+=24),e>=24&&(e-=24),this.besselianElements.julianDayMax-e/24},this.getAlt=(t=>180*t.alt/Math.PI),this.getAzi=(t=>{var e=180*t.azi/Math.PI;return e<0&&(e+=360),e>=360&&(e-=360),e}),this.getP=(t=>{var e=180*t.p/Math.PI;return e<0&&(e+=360),e>=360&&(e-=360),e}),this.getDate=function(t){if(!isNaN(t.t)&&!isNaN(this.besselianElements.t0)&&!isNaN(this.besselianElements.dUTC)){var e=0,i=t.t+this.besselianElements.t0-this.besselianElements.dUTC/3600;return i<0&&(i+=24),i>=24&&(i-=24),e=Math.floor(this.besselianElements.julianDayMax-i/24+1538),e+=i/24}return null},this.getAll=function(){if(this.getMid(),this.observational(this.midCircumstances),this.midCircumstances.mid=Math.sqrt(this.midCircumstances.u*this.midCircumstances.u+this.midCircumstances.vLoc*this.midCircumstances.vLoc),this.midCircumstances.magnitude=(this.midCircumstances.l1prime-this.midCircumstances.mid)/(this.midCircumstances.l1prime+this.midCircumstances.l2prime),this.midCircumstances.moonSun=(this.midCircumstances.l1prime-this.midCircumstances.l2prime)/(this.midCircumstances.l1prime+this.midCircumstances.l2prime),this.getC1C4(),this.observational(this.c1Circumstances),this.observational(this.c4Circumstances),this.getC2C3(),this.observational(this.c2Circumstances),this.observational(this.c3Circumstances),this.midCircumstances.magnitude>0)if(this.midCircumstances.mid<this.midCircumstances.l2prime||this.midCircumstances.mid<-this.midCircumstances.l2prime)if(this.midCircumstances.l2prime<0?this.midCircumstances.localType=3:this.midCircumstances.localType=2,L){var t=this.getLimbData(this.getMaxEclipseDateJD());if(t){var s=e(n(this.c2Circumstances.p)),h=e(n(this.c2Circumstances.p)),r=Math.cos(this.c2Circumstances.p),u=Math.cos(this.c3Circumstances.p),o=Math.sin(this.c2Circumstances.p),c=Math.sin(this.c3Circumstances.p),l=Math.atan2(u-r,c-o);l=e(n(l)+270);var m=a(m),b=i(this.c2Circumstances.p,t),d=i(this.c3Circumstances.p,t),g=3600*(this.midCircumstances.l1prime+this.midCircumstances.l2prime)/(3600*(this.c3Circumstances.t-this.c1Circumstances.t)),C=-1*b/g*Math.cos(a(e(l-s))),p=d/g*Math.cos(a(e(l-h)));this.c2Circumstances.mid=C,this.c3Circumstances.mid=p,this.c2Circumstances.mid<990&&(this.c2Circumstances.t+=this.c2Circumstances.mid/3600),this.c3Circumstances.mid<990&&(this.c3Circumstances.t+=this.c3Circumstances.mid/3600)}}else this.c2Circumstances.mid=999.9,this.c3Circumstances.mid=999.9;else this.midCircumstances.localType=1;else this.midCircumstances.localType=0},this.getCoverage=function(){var t,e,i;return this.midCircumstances.magnitude<=0?0:this.midCircumstances.magnitude>=1?100:(2===this.midCircumstances.localType?i=this.midCircumstances.moonSun*this.midCircumstances.moonSun:(i=Math.acos((this.midCircumstances.l1prime*this.midCircumstances.l1prime+this.midCircumstances.l2prime*this.midCircumstances.l2prime-2*this.midCircumstances.mid*this.midCircumstances.mid)/(this.midCircumstances.l1prime*this.midCircumstances.l1prime-this.midCircumstances.l2prime*this.midCircumstances.l2prime)),e=Math.acos((this.midCircumstances.l1prime*this.midCircumstances.l2prime+this.midCircumstances.mid*this.midCircumstances.mid)/this.midCircumstances.mid/(this.midCircumstances.l1prime+this.midCircumstances.l2prime)),t=Math.PI-e-i,i=(this.midCircumstances.moonSun*this.midCircumstances.moonSun*t+e-this.midCircumstances.moonSun*Math.sin(i))/Math.PI),i?t=i=(1e3*i+.5)/10:0)},this.getDepth=function(){var t=0;return t=Math.abs(this.midCircumstances.mid/this.midCircumstances.l2prime),t=t<0?1+t:1-t,t*=100},this.getMid=function(){var t=0,e=1;for(this.midCircumstances.eventType=0,this.midCircumstances.t=0,this.timeLocalDependent(this.midCircumstances);(e>1e-6||e<-1e-6)&&t<CALC_ITERATIONS;)e=(this.midCircumstances.u*this.midCircumstances.a+this.midCircumstances.vLoc*this.midCircumstances.b)/this.midCircumstances.nSquared,this.midCircumstances.t=this.midCircumstances.t-e,t++,this.timeLocalDependent(this.midCircumstances)},this.getC1C4=function(){var t,e;e=Math.sqrt(this.midCircumstances.nSquared),t=(t=this.midCircumstances.a*this.midCircumstances.vLoc-this.midCircumstances.u*this.midCircumstances.b)/e/this.midCircumstances.l1prime,t=Math.sqrt(1-t*t)*this.midCircumstances.l1prime/e,this.c1Circumstances.eventType=-2,this.c4Circumstances.eventType=2,this.c1Circumstances.t=this.midCircumstances.t-t,this.c4Circumstances.t=this.midCircumstances.t+t,this.c1c4Iterate(this.c1Circumstances),this.c1c4Iterate(this.c4Circumstances)},this.c1c4Iterate=function(t){var e,i,s,n;for(this.timeLocalDependent(t),e=t.eventType<0?-1:1,s=1,i=0;(s>1e-6||s<-1e-6)&&i<CALC_ITERATIONS;)n=Math.sqrt(t.nSquared),s=(s=t.a*t.vLoc-t.u*t.b)/n/t.l1prime,s=e*Math.sqrt(1-s*s)*t.l1prime/n,s=(t.u*t.a+t.vLoc*t.b)/t.nSquared-s,t.t=t.t-s,this.timeLocalDependent(t),i++;return t},this.getC2C3=function(){var t,e;e=Math.sqrt(this.midCircumstances.nSquared),t=(t=this.midCircumstances.a*this.midCircumstances.vLoc-this.midCircumstances.u*this.midCircumstances.b)/e/this.midCircumstances.l2prime,t=Math.sqrt(1-t*t)*this.midCircumstances.l2prime/e,this.c2Circumstances.eventType=-1,this.c3Circumstances.eventType=1,this.midCircumstances.l2prime<0?(this.c2Circumstances.t=this.midCircumstances.t+t,this.c3Circumstances.t=this.midCircumstances.t-t):(this.c2Circumstances.t=this.midCircumstances.t-t,this.c3Circumstances.t=this.midCircumstances.t+t),this.c2c3Iterate(this.c2Circumstances),this.c2c3Iterate(this.c3Circumstances)},this.c2c3Iterate=function(t){var e,i,s,n;for(this.timeLocalDependent(t),e=t.eventType<0?-1:1,this.midCircumstances.l2prime<0&&(e=-e),s=1,i=0;(s>1e-6||s<-1e-6)&&i<50;)n=Math.sqrt(t.nSquared),s=(s=t.a*t.vLoc-t.u*t.b)/n/t.l2prime,s=e*Math.sqrt(1-s*s)*t.l2prime/n,s=(t.u*t.a+t.vLoc*t.b)/t.nSquared-s,t.t=t.t-s,this.timeLocalDependent(t),i++;return t},this.timeLocalDependent=function(t){var e;return this.timeDependent(t),t.h=t.mu-this.observerConstants.getLongRadians()-this.besselianElements.dT/13713.44,t.sinH=Math.sin(t.h),t.cosH=Math.cos(t.h),t.xi=this.observerConstants.getRhoCosO()*t.sinH,t.eta=this.observerConstants.getRhoSinO()*t.cosDelta-this.observerConstants.getRhoCosO()*t.cosH*t.sinDelta,t.zeta=this.observerConstants.getRhoSinO()*t.sinDelta+this.observerConstants.getRhoCosO()*t.cosH*t.cosDelta,t.dxi=t.dmu*this.observerConstants.getRhoCosO()*t.cosH,t.deta=t.dmu*t.xi*t.sinDelta-t.zeta*t.dd,t.u=t.x-t.xi,t.vLoc=t.y-t.eta,t.a=t.dx-t.dxi,t.b=t.dy-t.deta,-2!==(e=t.eventType)&&0!==e&&2!==e||(t.l1prime=t.l1-t.zeta*this.besselianElements.tanF1),-1!==e&&0!==e&&1!==e||(t.l2prime=t.l2-t.zeta*this.besselianElements.tanF2),t.nSquared=t.a*t.a+t.b*t.b,t},this.timeDependent=function(t){var e,i,s;return i=t.t,s=this.besselianElements.x3*i+this.besselianElements.x2,s=s*i+this.besselianElements.x1,s=s*i+this.besselianElements.x0,t.x=s,s=3*this.besselianElements.x3*i+2*this.besselianElements.x2,s=s*i+this.besselianElements.x1,t.dx=s,s=this.besselianElements.y3*i+this.besselianElements.y2,s=s*i+this.besselianElements.y1,s=s*i+this.besselianElements.y0,t.y=s,s=3*this.besselianElements.y3*i+2*this.besselianElements.y2,s=s*i+this.besselianElements.y1,t.dy=s,s=this.besselianElements.d2*i+this.besselianElements.d1,s=s*i+this.besselianElements.d0,s=s*Math.PI/180,t.d=s,t.sinDelta=Math.sin(s),t.cosDelta=Math.cos(s),s=2*this.besselianElements.d2*i+this.besselianElements.d1,s=s*Math.PI/180,t.dd=s,s=this.besselianElements.m2*i+this.besselianElements.m1,(s=s*i+this.besselianElements.m0)>=360&&(s-=360),s=s*Math.PI/180,t.mu=s,s=2*this.besselianElements.m2*i+this.besselianElements.m1,s=s*Math.PI/180,t.dmu=s,-2!==(e=t.eventType)&&0!==e&&2!==e||(s=(s=this.besselianElements.l12*i+this.besselianElements.l11)*i+this.besselianElements.l10,t.l1=s,t.dl1=2*this.besselianElements.l12*i+this.besselianElements.l11),-1!==e&&0!==e&&1!==e||(s=(s=this.besselianElements.l22*i+this.besselianElements.l21)*i+this.besselianElements.l20,t.l2=s,t.dl2=2*this.besselianElements.l22*i+this.besselianElements.l21),t},this.observational=function(t){var e,i,s;e=0===t.eventType?1:3!==this.midCircumstances.localType||-1!==t.eventType&&1!==t.eventType?1:-1,t.p=Math.atan2(e*t.u,e*t.vLoc),s=Math.sin(this.observerConstants.getLatRadians()),i=Math.cos(this.observerConstants.getLatRadians()),t.alt=Math.asin(t.sinDelta*s+t.cosDelta*i*t.cosH),t.q=Math.asin(i*t.sinH/Math.cos(t.alt)),t.eta<0&&(t.q=Math.PI-t.q),t.vObs=t.p-t.q,t.azi=Math.atan2(-1*t.sinH*t.cosDelta,t.sinDelta*i-t.cosH*s*t.cosDelta)},this.setMaxJulianDay=function(t){this.besselianElements.julianDayMax=t,this.maxEclipseDate=julianDayToTime(this.besselianElements.julianDayMax)},this.getMaxEclipseDate=function(){return this.maxEclipseDate},this.getMaxEclipseDateJD=function(){return this.besselianElements.julianDayMax},this.isTotalOrAnnular=function(){return"Annular"===this.type||"Total"===this.type||"Hybrid"===this.type},this.set(t)}var VALID_LINE_LENGTH=115,DATE_START_IDX=13,LAT_START_IDX=81,LAT_LENGTH=4,LONG_START_IDX=87,LONG_LENGTH=5,DATE_STRING_LENGTH=21,ECLIPSE_TYPE_IDX=56,CALC_ITERATIONS=50;TimeSpan.prototype.toString=function(){return""+this.getRawMilliSeconds()},TimeSpan.prototype.toJSON=function(){return this.getRawMilliSeconds()},EclipseData.prototype.getLimbData=function(t){return 2457987.267725===t?this.tse2017LimbData():null},EclipseData.prototype.tse2017LimbData=(()=>[0,.25,1439,-.36,-.2,-.5,-.73,-.47,-.54,-.3,-.3,-.29,-.33,-.08,-.03,-.08,-.09,-.13,-.33,-.28,-.21,-.19,-.18,.06,.26,.13,.13,.09,.42,.1,-.26,.21,.03,.11,.24,.22,-.06,-.26,-.56,-.43,-.01,-.09,-.04,.11,0,.03,-.14,-.3,-.07,-.05,-.16,-.08,.04,.1,-.03,.02,.2,.22,.32,.31,.42,.34,.13,.22,.2,.25,.29,.31,.35,.17,.49,.49,.5,.44,.22,-.03,-.3,-.36,-.35,-.01,-.25,-.23,-.27,-.49,-.37,-.49,-.5,-.29,-.24,-.26,-.36,-.23,-.43,-.35,-.22,-.25,-.43,-.51,-.56,-.4,-.5,-.53,-.65,-.5,-.49,-.52,-.57,-.43,-.47,-.54,-.26,-.25,-.48,-.6,-.6,-.54,-.44,-.48,-.32,-.36,-.28,-.27,-.34,-.17,-.1,-.17,-.28,-.48,-.58,-.61,-.66,-.91,-.75,-.86,-.71,-.56,-.46,-.16,-.14,.11,-.1,-.31,-.53,-.59,-.71,-.62,-.41,-.14,-.43,-.45,-.33,-.37,-.55,-.13,-.17,-.06,-.15,-.23,.11,-.1,.07,-.29,-.1,-.05,-.27,-.35,-.52,-.64,-.84,-.6,-.13,-.32,-.79,-.95,-1.05,-1.12,-1.05,-.95,-1.11,-1.09,-.93,-1.24,-.83,-.79,-.76,-.45,-.25,-.33,-.51,-.53,-.42,-.63,-.82,-.57,-.59,-.81,-.84,-.81,-.9,-.81,-.57,-.81,-.85,-.84,-1,-.9,-1.12,-1.02,-1.01,-1.1,-1.15,-1,-.79,-.7,-.6,-.82,-1.07,-1.15,-1.01,-.93,-1.02,-.4,-.51,-.84,-.87,-.69,-.61,-.84,-.91,-.78,-.84,-.84,-.56,-.54,-.41,-.58,-.72,-.77,-.85,-.51,-.34,-.34,-.18,-.04,-.23,-.37,-.28,-.28,-.48,-.27,-.22,-.25,-.43,-.45,-.42,-.65,-.59,-.59,-.79,-.8,-.44,-.36,-.3,-.46,-.58,-.23,-.18,-.1,-.11,.15,.13,-.1,-.37,-.8,-.34,-.42,-.31,-.31,-.28,-.11,-.21,-.13,-.08,.04,.14,.1,.14,.26,.24,-.1,-.22,-.1,.12,.14,.27,.38,.57,.51,.38,.24,.13,.26,.43,.7,.86,.92,.76,.67,.55,.35,.07,.38,.42,-.1,-.18,-.2,.16,-.01,-.15,-.16,-.3,-.32,-.5,-.38,-.46,-.51,-.46,-.41,-.33,-.27,.17,-.13,-.08,-.05,-.17,-.23,-.3,-.01,.39,.22,.5,.57,.56,.14,.3,.1,.07,.19,.71,.8,.63,.2,.21,.22,.19,.44,.02,.18,.41,.35,.27,.86,.76,.36,.49,.44,.57,.16,.37,.71,.33,.35,.19,.4,.14,.23,.25,.47,.66,.71,.83,.88,.99,.96,.98,1.19,1.26,1.05,1.4,1.24,1.11,1.35,1.15,.85,.89,.46,-.04,.02,-.05,.11,-.23,-.06,.34,.4,.18,.2,.33,.72,1.12,.92,1.19,.58,.8,.63,.63,.6,.39,.57,1.26,1.19,1.39,1.69,1.71,1.67,1.57,1.79,1.35,.59,.43,.63,.44,.28,.99,1.08,1.2,1.07,.97,.41,.26,.26,.21,.87,.81,.77,.66,.8,.59,.09,.4,.68,.28,.07,.23,.63,.05,.65,.38,.91,1.01,.88,.27,.28,.06,-.03,.02,.49,.5,.76,.55,.95,1.54,1.35,1.14,.72,.78,.77,.65,.33,.09,.18,.17,.07,.15,.05,.04,.07,.09,.17,.25,.14,.2,.54,1.22,1.22,1.48,1.51,1.78,1.66,1.42,1.5,1.81,1.8,1.43,1.52,1.85,1.41,1.17,1.14,1.09,.78,1.06,.78,1.15,1.63,1.97,2.53,2.8,2.84,2.9,2.89,2.79,2.83,2.75,2.57,2.47,2.78,2.54,2.36,2.35,2.42,2.22,2.41,1.84,1.2,1.09,1.22,1.01,.97,1.12,1,1.3,1.27,1.18,1.18,1.28,1.36,1.39,.94,.84,.94,.93,.91,.68,.62,.67,.42,.48,.38,.31,.69,.39,.45,.58,.96,1.05,.82,.84,.78,.36,.22,.28,.4,.7,.86,1.1,1.72,1.51,.97,1.3,.76,.67,.42,.01,-.06,-.1,-.08,.32,.37,.29,.42,.44,.68,.68,.7,.99,1.13,1.81,2.33,2.2,2.48,2.47,2.57,2.56,2.19,2.3,1.8,1.8,1.73,1.65,1.62,1.43,1.68,2.19,2.3,1.97,2.17,2.12,1.79,2,2.25,2.36,2.38,2.37,2.23,2.41,2.34,2.22,2.09,2.14,2.37,2.51,2.51,2.58,2.31,2.22,2.51,2.6,2.07,2.04,1.65,1.84,1.72,1.76,1.83,1.57,1.2,.91,1.22,1.02,.64,.81,.66,.18,-.14,-.27,-.67,-.69,-.1,.45,.07,.54,.71,.74,1.18,1.71,1.25,.93,1.2,1.83,1.03,.73,.77,.92,.93,.09,-.3,-.39,-.39,-.58,-.41,-.72,-.46,-.72,-.56,-.91,-1.27,-1.35,-1.29,-1.38,-1.39,-1.09,-.45,.03,-.1,.16,.31,-.14,.38,1.57,1.36,.1,-.2,-.23,-.69,-.96,-.58,.36,.61,.38,.14,-1.09,-1.21,-.47,-.31,-.51,-.13,-.06,.49,.61,.48,.39,.41,.57,.42,.35,.26,.2,.45,-.31,-.25,.34,.84,.64,1.19,.92,.84,.45,.42,.3,-.07,-.74,-.79,-.63,-.74,-.9,-.85,-.85,-.89,-.49,.28,1.4,1.22,1.03,.63,.03,.03,.13,-.04,.25,.25,.8,1.26,1.46,1.27,1.31,1.42,1.87,2.16,2.19,2.08,1.89,1.5,1.41,1.55,2.02,2.21,2.42,2.4,2.19,1.68,1.18,.74,.24,-.13,-.51,-.52,-.37,-.4,-.26,-.13,-.12,-.32,-.5,-.45,-.35,.35,1.03,.76,.5,.22,.24,.35,.48,.72,.65,.85,1.04,.59,.69,.77,.85,.57,.51,.23,.26,.06,-.12,-.17,-.24,-.41,-.39,-.27,-.46,-.72,-.9,-.87,-.78,-.57,-.11,-.33,.16,-.03,.06,.14,.11,.3,.54,.63,.73,.56,.65,.35,.02,.02,.01,.11,-.02,.11,0,-.37,-.29,-.06,-.13,-.04,.3,.77,.55,.71,.23,-.21,0,-.12,-.32,-.16,-.06,.01,-.27,-.28,-.35,-.36,-.51,-.54,-.18,-.24,-.26,-.26,-.14,-.27,-.1,.04,-.28,-.19,-.28,-.35,-.27,.16,.42,.02,.42,.38,.08,.1,.16,.17,.1,-.27,-.5,-.44,-.71,-.57,-.56,-.45,-.65,-.61,-.58,-.88,-.84,-.69,-.6,-.24,-.2,-.33,-.06,-.33,-.21,-.53,-.48,-.58,-.53,-.54,-.49,-.74,-.93,-.86,-.78,-.69,-.35,-.62,-.59,-1.03,-1.08,-1.22,-1.22,-1.02,-.8,-.75,-.83,-.83,-1.09,-1.33,-1.37,-1.25,-1.13,-1.13,-1.18,-1.29,-1.29,-1.37,-1.28,-1.38,-1.33,-1.29,-1.44,-1.26,-.9,-.64,-.68,-.88,-.73,-.64,-.65,-.38,-.4,-.34,-.26,-.23,-.2,-.22,.03,-.15,-.31,-.07,-.14,-.38,-.23,-.25,.14,-.23,-.17,-.13,-.11,.24,.1,.26,.37,.47,.01,-.44,-.63,-.78,-.66,-.24,.19,.21,.3,-.15,-.54,-.38,.09,.24,.11,-.02,.01,.13,.19,.41,.39,.36,.06,-.16,-.16,.01,.05,.11,.23,.28,.08,.37,.69,.96,.91,.9,.8,1.13,1.32,1.44,1.16,.85,.86,.64,.49,.56,.26,.49,.31,.32,.3,.42,.45,.3,.32,.49,.32,.2,.69,.91,1.23,1.08,1.32,1.17,.68,.18,.55,.42,.4,.35,.11,-.22,-.08,-.11,-.11,-.1,.05,.27,.21,.16,.34,.68,.93,1.05,.66,.74,.49,.78,-.44,-.56,-.03,.1,.33,-.03,.1,.13,.28,.15,-.41,-.73,-.81,-.6,-.58,-1.14,-1.03,-.95,-.58,-.52,-.24,-.14,-.16,-.24,-.29,-.66,-.53,-.58,-.68,-.62,-.71,-.73,-.71,-.7,-.67,-.92,-.76,-.9,-.76,-.79,-1.04,-1.14,-1.17,-1.02,-1.11,-1.23,-1.35,-1.37,-1.43,-1.36,-1.19,-1.19,-.96,-1.1,-.96,-.76,-1.01,-1.32,-1.43,-1.57,-1.54,-1.49,-1.37,-1.25,-1.37,-1,-1.01,-1,-1.08,-1.23,-.99,-1,-.79,-.74,-.94,-.95,-.5,-.61,-.73,-.74,-.73,-.66,-.69,-.52,-.61,-.54,-.4,-.62,-.68,-.72,-.79,-.69,-.19,-.5,-.49,-.61,-.41,-.31,-.44,-.45,-.29,.03,-.03,.01,-.23,-.48,-.49,-.69,-.84,-.93,-1.01,-.81,-.72,-.69,-.61,-.42,-.33,-.18,-.09,-.2,-.22,-.36,-.21,-.18,-.17,-.16,-.41,-.33,-.3,-.33,-.44,-.39,-.24,-.29,-.13,-.15,-.13,-.12,-.04,-.23,-.12,-.21,-.05,.09,.15,.29,.06,.28,.09,.07,.28,.41,.54,.5,.44,.17,.09,.17,.1,.13,.22,.2,.11,-.08,-.33,-.15,.18,.07,.15,-.09,-.09,-.13,-.06,.08,.19,.24,.38,.56,.24,.13,.29,.47,.55,.53,.66,.57,.59,.54,.16,.07,.23,.19,.1,.13,0,.31,.31,.33,.3,.42,.33,.49,1.05,.97,.52,.19,.33,.18,-.12,.04,.19,.32,-.08,-.78,-.97,-1.04,-1.15,-1.12,-1.5,-1.41,-1.45,-1.15,-1.15,-.93,-1.48,-1.61,-1.44,-1.2,-1.71,-1.42,-1.57,-1.71,-1.5,-.81,-.84,-.7,-1.03,-1.25,-1.18,-1.21,-1.14,-1.24,-1.15,-.94,-1.26,-1.05,-.86,-.93,-.9,-1.2,-1.66,-1.81,-1.93,-1.89,-1.7,-1.85,-1.68,-1.65,-1.35,-1.26,-1.27,-1.35,-1.41,-1.16,-1.11,-1.1,-.88,-.73,-.7,-.6,-.69,-.02,-.43,-.44,-.31,-.09,-.45,-.25,-.24,-.04,-.09,-.19,-.11,-.08,-.42,-.39,-.46,-.59,-.6,-.17,.03,-.05,-.14,-.28,.35,.08,-.04,-.37,-.37,-.3,-.41,-.5,-.54,-.34,-.43,-.48,-.37,-.49,.18,-.27,-.22,-.53,-.79,-.76,-.76,-.61,-.47,-.56,-.67,-.77,-.94,-.88,-.86,-.72,-.42,-.05,-.01,-.22,-.27,-.34,-.35,-.45,-.47,-.42,-.53,-.31,-.51,-.58,-.64,-.47,-.33,-.02,-.06,-.05,-.34,-.28,-.42,-.35,-.42,-.52,-.54,-.41,-.53,-.73,-.74,-.82,-.82,-.72,-.63,-.62,-.37,-.45,-.44,-.36,-.46,-.3,-.6,-.3,-.27]);class Eclipses{constructor(t){function e(){g=!0,console.log("Eclipse load error called."),"function"==typeof L&&L()}function i(){g||(console.log("Load complete called."),"function"==typeof d&&d())}function s(){return b.length}function n(t){return b[t]}function a(t,i){var s=new XMLHttpRequest;s.open("GET",t,!0),s.onload=(t=>{if(200===s.status)i(s.response);else if(0===s.status){if(void 0!==s.response&&""!==s.response)return void i(s.response);console.log("Empty eclipse load response."),e()}else console.log("Eclipse load XHR status error: "+s.status),e()}),s.onerror=(t=>{console.log("Other request error."),e()}),s.send()}function h(){b.sort((t,e)=>t.maxEclipseDate.getTime()-e.maxEclipseDate.getTime())}function r(t,e,i){var s=36e5;if(isNaN(i)||(s=i),isNaN(t.getTime()))return!1;if(isNaN(e.getTime()))return!1;var n=t.getTime()-e.getTime();return n<=s&&n>=-1*s}function u(){console.log("Loading Besselian elements.");var t=SE1901();if(!(t=t.concat(SE2001())))return console.log("No eclipse elements found in javascript file."),!1;for(var e,i=0;i<t.length-27;i++)(e=new EclipseData).setMaxJulianDay(Number(t[i])),i++,e.besselianElements.t0=Number(t[i]),i++,e.besselianElements.tMin=Number(t[i]),i++,e.besselianElements.tMax=Number(t[i]),i++,e.besselianElements.dUTC=Number(t[i]),i++,e.besselianElements.dT=Number(t[i]),i++,e.besselianElements.x0=Number(t[i]),i++,e.besselianElements.x1=Number(t[i]),i++,e.besselianElements.x2=Number(t[i]),i++,e.besselianElements.x3=Number(t[i]),i++,e.besselianElements.y0=Number(t[i]),i++,e.besselianElements.y1=Number(t[i]),i++,e.besselianElements.y2=Number(t[i]),i++,e.besselianElements.y3=Number(t[i]),i++,e.besselianElements.d0=Number(t[i]),i++,e.besselianElements.d1=Number(t[i]),i++,e.besselianElements.d2=Number(t[i]),i++,e.besselianElements.m0=Number(t[i]),i++,e.besselianElements.m1=Number(t[i]),i++,e.besselianElements.m2=Number(t[i]),i++,e.besselianElements.l10=Number(t[i]),i++,e.besselianElements.l11=Number(t[i]),i++,e.besselianElements.l12=Number(t[i]),i++,e.besselianElements.l20=Number(t[i]),i++,e.besselianElements.l21=Number(t[i]),i++,e.besselianElements.l22=Number(t[i]),i++,e.besselianElements.tanF1=Number(t[i]),i++,e.besselianElements.tanF2=Number(t[i]),b.push(e);return t.length=0,h(),!0}function o(t){var e="",i="",s="";e=t.substr(0,4);var n=(i=t.substr(5,6))+", "+e+" "+(s=t.substr(13,9))+" GMT";return new Date(n)}function c(t){console.log("Loading cat");var a=t.match(/[^\r\n]+/g),h=0;if(0===s())return console.log("No eclipse loaded from catalog."),void e();for(var u=0;u<s();u++){for(var c=h;c<a.length;c++)if(a[c].length===VALID_LINE_LENGTH){var b=o(a[c].substr(DATE_START_IDX,DATE_STRING_LENGTH));if(isNaN(b.getTime()))console.log("Unable to parse date catalog line: "+c);else if("-"===a[c][DATE_START_IDX]&&b.setUTCFullYear(-1*b.getUTCFullYear()),r(b,n(u).maxEclipseDate)){l(a[c],u),m(a[c],u);break}}h=c}console.log("Load complete, TODO: remove data responded."),i()}function l(t,e){if(e>=0&&e<s()){var i=parseFloat(t.substr(LAT_START_IDX,LAT_LENGTH)),a=parseFloat(t.substr(LONG_START_IDX,LONG_LENGTH));"S"===t[LAT_START_IDX+LAT_LENGTH]&&(i*=-1),"W"===t[LONG_START_IDX+LONG_LENGTH]&&(a*=-1),n(e).midEclipsePoint.setPosition(i,a)}}function m(t,e){if(e>=0&&e<s())switch(t[ECLIPSE_TYPE_IDX]){case"P":n(e).type="Partial";break;case"A":n(e).type="Annular";break;case"T":n(e).type="Total";break;case"H":n(e).type="Hybrid";break;default:console.log("No eclipse type found.")}}var b=[],d=null,L=null,g=!1;this.loadEclipseElements=((t,i,s,n)=>{d=s,L=n,importScripts(i),u()?a(t,c):e()}),this.deleteEclipses=(()=>{b.length=0}),this.addEclipse=(t=>{b.push(new EclipseData(t))}),this.getEclipse=function(t){return!isNaN(t)&&t<this.getEclipseCount()?b[t]:null},this.getEclipseCount=(()=>b.length),this.getNextEclipseIdx=function(){var t=new Date;t.setUTCDate(t.getUTCDate()-2);for(var e=0;e<this.getEclipseCount()&&!(t<b[e].maxEclipseDate);e++);return e>=this.getEclipseCount()&&(e=this.getEclipseCount()-1)<0&&(e=0),e},this.getNextEclipse=function(){return b[this.getNextEclipseIdx()]},this.eclipseToJSON=(()=>JSON.stringify(b)),this.copyEclipsesIn=function(t){if(void 0!==t&&Array.isArray(t))for(var e=0;e<t.length;e++)this.addEclipse(t[e])},this.copyEclipsesIn(t)}}