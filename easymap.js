'use strict';class EasyMap{static get RADAR(){return'rad_rala'}static get VIS_SAT(){return'sat_vis'}static get IR_SAT(){return'sat_ir'}static get OFFLINE_MAP(){return'images/offline/{z}/{x}/{y}.jpg'}static get ONLINE_MAP(){return'https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}'}constructor(c,d,e){function g(pa){return 10>pa?'0'+pa:pa.toString()}function h(){var pa=new Date,qa=''+pa.getUTCFullYear()+g(pa.getUTCMonth()+1)+g(pa.getUTCDate())+g(pa.getUTCHours())+g(pa.getUTCMinutes());return qa}function k(){return p(EasyMap.RADAR,3,0.75)}function l(){return p(EasyMap.IR_SAT,1,I)}function m(){return p(EasyMap.VIS_SAT,2,I)}function n(pa){return'https://www.aviationweather.gov/gis/scripts/tc.php?product='+pa+'&date='+h()+'&x={x}&y={-y}&z={z}'}function o(pa){return new ol.source.XYZ({url:n(pa)})}function p(pa,qa,ra){var ta=new ol.layer.Tile({source:o(pa),opacity:ra});return ta.setZIndex(qa),ta.updateTimer=window.setInterval(function(){var ua=o(pa);ta.setSource(ua),ua.refresh(),console.log('WX '+pa+' layer updated.')},3e5),ta}function q(pa){return pa&&(window.clearInterval(pa.updateTimer),ka.removeLayer(pa),pa=null),pa}function r(pa){for(var qa=[],ra=0,sa=0,ta=0,ua=u().bottomLeft.longitude,va=0;va<pa.length;va++)0===va&&'number'==typeof ua&&(90<ua&&-90>pa[va].longitude?sa=360:-90>ua&&90<pa[va].longitude&&(sa=-360)),0<va&&0==sa&&(90<ra&&-90>pa[va].longitude?sa=360:-90>ra&&90<pa[va].longitude&&(sa=-360)),ta=pa[va].longitude+sa,360<ta&&(ta-=360),-360>ta&&(ta+=360),qa.push([ta,pa[va].latitude]),ra=pa[va].longitude;return qa}function s(pa,qa){var sa,ra=[];for(sa=0;sa<pa.length;sa+=qa)ra.push(pa.slice(sa,sa+qa));return ra}function t(){ia.on('tileloaderror',function(){X&&(P>=3?(P=0,X()):P++);var qa=ga.getZoom();console.log('Tile load error. Zoom: '+qa)})}function u(){var pa=ga.calculateExtent(ka.getSize()),qa=ol.proj.transform([pa[0],pa[1]],'EPSG:3857','EPSG:4326'),ra=ol.proj.transform([pa[2],pa[3]],'EPSG:3857','EPSG:4326');return{bottomLeft:new PositionObj(qa[1],qa[0]),topRight:new PositionObj(ra[1],ra[0])}}function v(pa){if(pa){if(Array.isArray(pa)){for(;0<pa.length;)ha.removeFeature(pa.pop());return pa}ha.removeFeature(pa)}return null}function w(pa){V&&(ba=window.setTimeout(function(){ba=null;var qa=ol.proj.toLonLat(pa.coordinate);V(new PositionObj(qa[1],qa[0]))},100))}const z={scene3DOnly:!0,contextOptions:{webgl:{alpha:!0,depth:!0,stencil:!1,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!1},allowTextureFilterAnisotropic:!1}},A=10,I=0.5;var K=null,L=null,M=null,N=20,O=1,P=0,Q=null,R=null,S=null,T=null,U=null,V=null,W=null,X=null,Y=null,Z=null,_=!1,aa=!0,ba=null,ca=null,da=!0,ea=!1,fa=ol.interaction.defaults({altShiftDragRotate:!1,pinchRotate:!1,shiftDragZoom:!1}),ga=new ol.View({center:ol.proj.fromLonLat([e.longitude,e.latitude]),zoom:d}),ha=new ol.source.Vector({wrapX:!0}),ia=new ol.source.OSM({url:EasyMap.OFFLINE_MAP}),ja=new ol.layer.Tile({source:ia}),ka=new ol.Map({target:c,layers:[ja],view:ga,controls:[new ol.control.Attribution({collapsible:!1,label:' ',collapseLabel:' '})],interactions:fa,loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,moveTolerance:A}),la=new ol.layer.Vector({source:ha,style:new ol.style.Style({stroke:new ol.style.Stroke({color:'black',width:2})}),updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:500});la.setZIndex(4),ka.addLayer(la);var ma=new olcs.OLCesium({map:ka,sceneOptions:z});ma.setTargetFrameRate(Number.POSITIVE_INFINITY);var na=u().bottomLeft.longitude,oa=u().topRight.longitude;t(),function(){var pa=$('.ol-attribution');pa.css('white-space','nowrap'),pa.children('ul').children('li').eq(0).remove()}(),this.addGreatCircle=function(pa,qa,ra){for(var sa=[],ta=new arc.GreatCircle({x:pa.longitude,y:pa.latitude},{x:qa.longitude,y:qa.latitude}),ua=ta.Arc(50,{offset:10}),va=0;va<ua.geometries.length;va++)for(var xa,wa=0;wa<ua.geometries[va].coords.length;wa++){if(xa=new PositionObj(ua.geometries[va].coords[wa][1],ua.geometries[va].coords[wa][0]),isNaN(xa.latitude)||isNaN(xa.longitude))return null;sa.push(xa)}if(1<sa.length){var ya=this.addPolyLine(sa,ra);return ya}return console.log('Not enough points created for great circle line.'),null},this.addPolyLine=function(pa,qa){var ra='black',sa=1;qa&&(qa.stroke_color&&(ra=qa.stroke_color),'number'==typeof qa.stroke_width&&(sa=qa.stroke_width));var ta=new ol.style.Style({stroke:new ol.style.Stroke({color:ra,width:sa})});if(pa){var ua=r(pa),va=new ol.geom.LineString(ua);va.transform('EPSG:4326','EPSG:3857');var wa=new ol.Feature({geometry:va});return wa.setStyle(ta),ha.addFeature(wa),wa.reDraw=function(){wa.setCoordinates(pa)},wa.setCoordinates=function(xa){var ya=r(xa),za=new ol.geom.LineString(ya);za.transform('EPSG:4326','EPSG:3857'),this.setGeometry(za)},wa}return null},this.addMultiPolyLine=function(pa,qa){var ra=[];if(pa)for(var sa=s(pa,100),ta=0;ta<sa.length;ta++)ta<sa.length-1&&sa[ta].push(sa[ta+1][0]),ra.push(this.addPolyLine(sa[ta],qa));return ra.reDraw=function(){for(var ua=0;ua<ra.length;ua++)ra[ua]&&ra[ua].reDraw()},ra.isValid=function(){return!!(1<ra.length)},ra},this.addPolygon=function(pa,qa){if(pa){var ra='rgba(0, 0, 0, .5)',sa='black',ta=0.1,ua=new ol.style.Fill;qa&&(qa.fill_color&&(ra=qa.fill_color),qa.stroke_color&&(sa=qa.stroke_color),'number'==typeof qa.stroke_width&&(ta=qa.stroke_width));var va=new ol.style.Style({stroke:new ol.style.Stroke({color:sa,width:ta}),fill:new ol.style.Fill({color:ra})}),wa=r(pa),xa=new ol.geom.LinearRing(wa);xa.transform('EPSG:4326','EPSG:3857');var ya=new ol.geom.Polygon;ya.appendLinearRing(xa);var za=new ol.Feature({geometry:ya});return za.setStyle(va),ha.addFeature(za),za.setCoordinates=function(Aa){var Ba=r(Aa),Ca=new ol.geom.LinearRing(Ba);Ca.transform('EPSG:4326','EPSG:3857');var Da=new ol.geom.Polygon;Da.appendLinearRing(Ca),this.setGeometry(Da)},za}return null},this.setRotation=function(pa){ga.rotate(pa)},this.enableGlobe=function(){ma.setEnabled(!0)},this.disableGlobe=function(){ma.setEnabled(!1),this.setRotation(0)},this.addMarker=function(pa,qa){var ra=new ol.style.Style({image:new ol.style.Icon({src:qa})}),sa=new ol.geom.Point([pa.longitude,pa.latitude]);sa.transform('EPSG:4326','EPSG:3857');var ta=new ol.Feature({geometry:sa});return ta.setStyle(ra),ha.addFeature(ta),ta.setLocation=function(ua){var va=new ol.geom.Point([ua.longitude,ua.latitude]);va.transform('EPSG:4326','EPSG:3857'),this.setGeometry(va)},ta},this.getCenter=function(){var pa=ol.proj.transform(ga.getCenter(),'EPSG:3857','EPSG:4326');return new PositionObj(pa[1],pa[0])};this.removeFeature=function(pa){return v(pa)},this.render=function(){ka.render()},this.clearMap=function(){ha.clear(!0)},this.onTileLoadError=function(pa){if(pa&&'function'==typeof pa)return void(X=pa);throw new Error('Input function for tile load error.')},ka.on('pointermove',function(pa){pa.dragging&&(!ca&&da?(da=!1,ca=window.setTimeout(function(){ca=null,da=!0,Z=null,Y=null,w(pa),console.log('TODO: Remove isoloated pointermove with new OL 4.2+?')},100)):(window.clearTimeout(ca),ca=null),Z=pa.frameState.time,Y=pa.coordinate,!Q&&(Q=pa.pixel),R=pa.pixel,T&&aa&&(aa=!1,T(pa)))}),ka.on('moveend',function(pa){da=!0,ca&&(window.clearTimeout(ca),ca=null);var qa=u().bottomLeft.longitude,ra=u().topRight.longitude;if(U&&(0<na&&0>qa?U(pa):0>na&&0<qa?U(pa):-180>na&&-180<qa?U(pa):-180<na&&-180>qa?U(pa):180<na&&180>qa?U(pa):180>na&&180<qa&&U(pa),0<oa&&0>ra?U(pa):0>oa&&0<ra?U(pa):-180>oa&&-180<ra?U(pa):-180<oa&&-180>ra?U(pa):180<oa&&180>ra?U(pa):180>oa&&180<ra&&U(pa)),na=qa,oa=ra,aa=!0,Q&&R&&S){var sa=0,ta=!1;if(!_){var ua=Q[0]-R[0],va=Q[1]-R[1];ua*=ua,va*=va,sa=Math.sqrt(ua+va)}else ta=!0,_=!1;if(pa.distance=Math.round(sa),Z){var wa=pa.frameState.time,xa=wa-Z;xa<250&&pa.distance<A&&null!==Y&&!ta&&(pa.coordinate=Y,console.log('TODO: Remove drag click call with OL 4.2+'),Z=null,Y=null,w(pa))}pa.distance>=A&&S(pa)}Q=null,R=null}),this.onDoubleClick=function(pa){W=pa,ka.on('doubleclick',W)},this.onClick=function(pa){V=pa,ka.on('click',w)},this.clickOff=function(){V&&(ka.un('click',w),V=null)},this.doubleClickOff=function(){W&&(ka.un('doubleclick',W),W=null)},this.onDragEnd=function(pa){S=pa},this.onDragStart=function(pa){T=pa},this.onRedrawCall=function(pa){U=pa},this.on=function(pa,qa,ra){return ka.on(pa,qa,ra)},this.onZoomEnd=function(pa,qa){return ga.on('change:resolution',function(){_=!0,ba&&(window.clearTimeout(ba),ba=null),ka.once('moveend',function(){pa();var sa=ga.getZoom();sa>N&&ga.setZoom(N),sa<O&&ga.setZoom(O)},qa)},qa)},this.updateSize=function(){ka.updateSize()},this.zoomIn=function(){ga.getZoom()<N&&ga.setZoom(ga.getZoom()+1)},this.zoomOut=function(){ga.getZoom()>O&&ga.setZoom(ga.getZoom()-1)},this.setSource=function(pa){ia=new ol.source.OSM({url:pa}),ja.setSource(ia),ia.refresh(),this.render();var qa=ma.getEnabled();ma=new olcs.OLCesium({map:ka,sceneOptions:z}),ma.setTargetFrameRate(Number.POSITIVE_INFINITY),ma.setEnabled(qa),t()},this.setOfflineMap=function(){ea=!1,this.setSource(EasyMap.OFFLINE_MAP),ia.setAttributions('<a href=\'https://nationalmap.gov/\' target=\'_blank\'>The USGS National Map</a>'),N=7,this.getZoom()>N&&this.setZoom(N),this.getZoom()<O&&this.setZoom(O),this.clearAllWx(),this.render()},this.setOnlineMap=function(){ea=!0,this.setSource(EasyMap.ONLINE_MAP),ia.setAttributions('&copy; Esri &mdash; Source: Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community'),N=20,this.getZoom()>N&&this.setZoom(N),this.getZoom()<O&&this.setZoom(O),this.render()},this.isMapOnline=function(){return ea},this.setCenter=function(pa){pa&&ga.setCenter(ol.proj.fromLonLat([pa.longitude,pa.latitude]))},this.setZoom=function(pa){if('number'==typeof pa)pa>N?ga.setZoom(N):pa<O?ga.setZoom(O):ga.setZoom(pa);else throw new Error('setZoom needs a number value input.')},this.getZoom=function(){return ga.getZoom()},this.getMaxZoom=function(){return N},this.getMinZoom=function(){return O},this.wxRadarOff=function(){K=q(K)},this.wxRadarOn=function(){this.wxRadarOff(),K=k(),ka.addLayer(K)},this.wxVisSatOff=function(){L=q(L)},this.wxVisSatOn=function(){this.wxVisSatOff(),L=m(),ka.addLayer(L)},this.wxIRSatOff=function(){M=q(M)},this.wxIRSatOn=function(){this.wxIRSatOff(),M=l(),ka.addLayer(M)},this.clearAllWx=function(){this.wxRadarOff(),this.wxVisSatOff(),this.wxIRSatOff()}}}