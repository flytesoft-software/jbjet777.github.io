'use strict';var D2R=Math.PI/180,R2D=180/Math.PI,Coord=function(a,b){this.lon=a,this.lat=b,this.x=D2R*a,this.y=D2R*b};Coord.prototype.view=function(){return(this.lon+'').slice(0,4)+','+(this.lat+'').slice(0,4)},Coord.prototype.antipode=function(){var a=-1*this.lat,b=0>this.lon?180+this.lon:-1*(180-this.lon);return new Coord(b,a)};var LineString=function(){this.coords=[],this.length=0};LineString.prototype.move_to=function(a){this.length++,this.coords.push(a)};var Arc=function(a){this.properties=a||{},this.geometries=[]};Arc.prototype.json=function(){if(0>=this.geometries.length)return{geometry:{type:'LineString',coordinates:null},type:'Feature',properties:this.properties};if(1==this.geometries.length)return{geometry:{type:'LineString',coordinates:this.geometries[0].coords},type:'Feature',properties:this.properties};for(var a=[],b=0;b<this.geometries.length;b++)a.push(this.geometries[b].coords);return{geometry:{type:'MultiLineString',coordinates:a},type:'Feature',properties:this.properties}},Arc.prototype.wkt=function(){for(var a='',b='LINESTRING(',d=function(n){b+=n[0]+' '+n[1]+','},e=0;e<this.geometries.length;e++){if(0===this.geometries[e].coords.length)return'LINESTRING(empty)';var g=this.geometries[e].coords;g.forEach(d),a+=b.substring(0,b.length-1)+')'}return a};var GreatCircle=function(a,b,d){if(!a||void 0===a.x||void 0===a.y)throw new Error('GreatCircle constructor expects two args: start and end objects with x and y properties');if(!b||void 0===b.x||void 0===b.y)throw new Error('GreatCircle constructor expects two args: start and end objects with x and y properties');this.start=new Coord(a.x,a.y),this.end=new Coord(b.x,b.y),this.properties=d||{};var e=this.start.x-this.end.x,g=this.start.y-this.end.y,n=Math.pow(Math.sin(g/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(e/2),2);if(this.g=2*Math.asin(Math.sqrt(n)),this.g==Math.PI)throw new Error('it appears '+a.view()+' and '+b.view()+' are \'antipodal\', e.g diametrically opposite, thus there is no single route but rather infinite');else if(isNaN(this.g))throw new Error('could not calculate great circle between '+a+' and '+b)};if(GreatCircle.prototype.interpolate=function(a){var b=Math.sin((1-a)*this.g)/Math.sin(this.g),d=Math.sin(a*this.g)/Math.sin(this.g),e=b*Math.cos(this.start.y)*Math.cos(this.start.x)+d*Math.cos(this.end.y)*Math.cos(this.end.x),g=b*Math.cos(this.start.y)*Math.sin(this.start.x)+d*Math.cos(this.end.y)*Math.sin(this.end.x),n=b*Math.sin(this.start.y)+d*Math.sin(this.end.y),o=R2D*Math.atan2(n,Math.sqrt(Math.pow(e,2)+Math.pow(g,2))),p=R2D*Math.atan2(g,e);return[p,o]},GreatCircle.prototype.Arc=function(a,b){var d=[];if(!a||2>=a)d.push([this.start.lon,this.start.lat]),d.push([this.end.lon,this.end.lat]);else for(var g=0;g<a;++g){var n=1/(a-1)*g,o=this.interpolate(n);d.push(o)}for(var p=!1,q=0,r=b&&b.offset?b.offset:10,s=180-r,t=-180+r,u=360-r,v=1;v<d.length;++v){var C=d[v-1][0],D=d[v][0],E=Math.abs(D-C);E>u&&(D>s&&C<t||C>s&&D<t)?p=!0:E>q&&(q=E)}var F=[];if(p&&q<r){var G=[];F.push(G);for(var I,H=0;H<d.length;++H)if(I=parseFloat(d[H][0]),0<H&&Math.abs(I-d[H-1][0])>u){var J=parseFloat(d[H-1][0]),K=parseFloat(d[H-1][1]),L=parseFloat(d[H][0]),M=parseFloat(d[H][1]);if(-180<J&&J<t&&180==L&&H+1<d.length&&-180<d[H-1][0]&&d[H-1][0]<t){G.push([-180,d[H][1]]),H++,G.push([d[H][0],d[H][1]]);continue}else if(J>s&&180>J&&-180==L&&H+1<d.length&&d[H-1][0]>s&&180>d[H-1][0]){G.push([180,d[H][1]]),H++,G.push([d[H][0],d[H][1]]);continue}if(J<t&&L>s){var N=J;J=L,L=N;var O=K;K=M,M=O}if(J>s&&L<t&&(L+=360),180>=J&&180<=L&&J<L){var P=(180-J)/(L-J),Q=P*M+(1-P)*K;G.push([d[H-1][0]>s?180:-180,Q]),G=[],G.push([d[H-1][0]>s?-180:180,Q]),F.push(G)}else G=[],F.push(G);G.push([I,d[H][1]])}else G.push([d[H][0],d[H][1]])}else{var R=[];F.push(R);for(var S=0;S<d.length;++S)R.push([d[S][0],d[S][1]])}for(var V,T=new Arc(this.properties),U=0;U<F.length;++U){V=new LineString,T.geometries.push(V);for(var W=F[U],X=0;X<W.length;++X)V.move_to(W[X])}return T},'undefined'!=typeof module&&'undefined'!=typeof module.exports)module.exports.Coord=Coord,module.exports.Arc=Arc,module.exports.GreatCircle=GreatCircle;else var arc={Coord:Coord,Arc:Arc,GreatCircle:GreatCircle};